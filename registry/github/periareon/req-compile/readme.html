<div id="readme" class="rst" data-path="README.rst"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">README for Req-Compile Python Requirements Compiler</h1><a id="user-content-readme-for-req-compile-python-requirements-compiler" class="anchor" aria-label="Permalink: README for Req-Compile Python Requirements Compiler" href="#readme-for-req-compile-python-requirements-compiler"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<a href="https://pypi.python.org/pypi/req-compile" rel="nofollow"><img alt="PyPI package version" src="https://camo.githubusercontent.com/1b3a04c95bcba3e1d78ac2837fb1536cebbf877809b493fec88260d632f6edef/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f7265712d636f6d70696c652e737667" data-canonical-src="https://img.shields.io/pypi/v/req-compile.svg" style="max-width: 100%;">
</a>
<a href="https://github.com/periareon/req-compile"><img alt="Github build status" src="https://github.com/periareon/req-compile/actions/workflows/build.yml/badge.svg" style="max-width: 100%;">
</a>
<a name="user-content-req-compile-python-requirements-compiler"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Req-Compile Python Requirements Compiler</h2><a id="user-content-req-compile-python-requirements-compiler" class="anchor" aria-label="Permalink: Req-Compile Python Requirements Compiler" href="#req-compile-python-requirements-compiler"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Req-Compile is a Python requirements compiler geared toward large Python projects. It allows you to:</p>
<ul dir="auto">
<li>Produce an output file consisting of fully constrained exact versions of your requirements</li>
<li>Identify sources of constraints on your requirements</li>
<li>Constrain your output requirements using requirements that will not be included in the output</li>
<li>Save distributions that are downloaded while compiling in a configurable location</li>
<li>Use a current solution as a source of requirements. In other words, you can easily compile a subset from an existing solution.</li>
</ul>
<a name="user-content-bazel-integration"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Bazel integration</h3><a id="user-content-bazel-integration" class="anchor" aria-label="Permalink: Bazel integration" href="#bazel-integration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Also supplied by this repository is the Bazel module <code>rules_req_compile</code>, which provides a binary
to compile a requirements solution and install third-party distributions from that solution. This
project differs from <code>rules_python</code> in that the URLs for the distributions are written to the
solution, enabling deterministic and repo-cacheable downloads and installs of third-party dependencies.</p>
<p dir="auto">To get started with Bazel, add the following to your <code>MODULE.bazel</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Find {version} on the req-compile GitHub releases page.
bazel_dep(name = &quot;rules_req_compile&quot;, version = &quot;{version}&quot;)

requirements = use_extension(&quot;//extensions:python.bzl&quot;, &quot;requirements&quot;)
requirements.parse(
    name = &quot;my_pip_deps&quot;,
    requirements_locks = {
        &quot;//3rdparty:requirements.linux.txt&quot;: &quot;@platforms//os:linux&quot;,
        &quot;//3rdparty:requirements.macos.txt&quot;: &quot;@platforms//os:macos&quot;,
        &quot;//3rdparty:requirements.windows.txt&quot;: &quot;@platforms//os:windows&quot;,
    },
)
use_repo(requirements, &quot;my_pip_deps&quot;)"><pre><span class="pl-c"># Find {version} on the req-compile GitHub releases page.</span>
<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_req_compile"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"{version}"</span>)

<span class="pl-s1">requirements</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"//extensions:python.bzl"</span>, <span class="pl-s">"requirements"</span>)
<span class="pl-s1">requirements</span>.<span class="pl-c1">parse</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_pip_deps"</span>,
    <span class="pl-s1">requirements_locks</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"//3rdparty:requirements.linux.txt"</span>: <span class="pl-s">"@platforms//os:linux"</span>,
        <span class="pl-s">"//3rdparty:requirements.macos.txt"</span>: <span class="pl-s">"@platforms//os:macos"</span>,
        <span class="pl-s">"//3rdparty:requirements.windows.txt"</span>: <span class="pl-s">"@platforms//os:windows"</span>,
    },
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">requirements</span>, <span class="pl-s">"my_pip_deps"</span>)</pre></div>
<a name="user-content-why-use-it"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Why use it?</h3><a id="user-content-why-use-it" class="anchor" aria-label="Permalink: Why use it?" href="#why-use-it"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong>pip</strong> and <strong>pip-tools</strong> are missing features and lack usability for some important workflows:</p>
<ul dir="auto">
<li>Using a previous solution as an input file to avoid hitting the network</li>
<li>pip-compile can't consider constraints that are not included in the final output. While pip accepts a constraints file, there is no way to stop at the "solving" phase, which would be used to push a fully solved solution to your repo</li>
<li>Track down where conflicting constraints originate</li>
<li>Treating source directories recursively as sources of requirements, like with --find-links</li>
<li>Configuring a storage location for downloaded distributions. Finding a fresh solution to a set of input requirements always requires downloading distributions</li>
</ul>
<p dir="auto">A common workflow that is difficult to achieve with other tools:</p>
<p dir="auto">You have a project with requirements <code>requirements.txt</code> and test requirements <code>test-requirements.txt</code>. You want
to produce a fully constrained output of <code>requirements.txt</code> to use to deploy your application. Easy, right? Just
compile <code>requirements.txt</code>. However, if your test requirements will in any way constrain packages you need,
even those needed transitively, it means you will have tested with different versions than you'll ship.</p>
<p dir="auto">For this reason, you can use Req-Compile to compile <code>requirements.txt</code> using <code>test-requirements.txt</code> as constraints.</p>
<a name="user-content-the-basics"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">The Basics</h3><a id="user-content-the-basics" class="anchor" aria-label="Permalink: The Basics" href="#the-basics"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<a name="user-content-install-and-run"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Install and run</h4><a id="user-content-install-and-run" class="anchor" aria-label="Permalink: Install and run" href="#install-and-run"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Req-Compile can be simply installed by running:</p>
<pre>pip install req-compile
</pre>
<p dir="auto">Two entrypoint scripts are provided:</p>
<pre>req-compile &lt;input reqfile1&gt; ... &lt;input_reqfileN&gt; [--constraints constraint_file] [repositories, such as --index-url https://...]
req-candidates [requirement] [repositories, such as --index-url https://...]
</pre>
<a name="user-content-producing-output-requirements"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Producing output requirements</h4><a id="user-content-producing-output-requirements" class="anchor" aria-label="Permalink: Producing output requirements" href="#producing-output-requirements"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To produce a fully constrained set of requirements for a given number of input requirements files, pass requirements
files to req-compile:</p>
<pre>&gt; cat requirements.txt
astroid &gt;= 2.0.0
isort &gt;= 4.2.5
mccabe

&gt; req-compile req-compile requirements.txt
astroid==2.9.0            # requirements.txt (&gt;=2.0.0)
isort==5.10.1             # requirements.txt (&gt;=4.2.5)
lazy-object-proxy==1.7.1  # astroid (&gt;=1.4.0)
mccabe==0.6.1             # requirements.txt
setuptools==60.0.1        # astroid (&gt;=20.0)
typed-ast==1.5.1          # astroid (&lt;2.0,&gt;=1.4.0)
typing_extensions==4.0.1  # astroid (&gt;=3.10)
wrapt==1.13.3             # astroid (&lt;1.14,&gt;=1.11)
</pre>
<p dir="auto">Output is always emitted to stdout. Possible inputs include:</p>
<pre>&gt; req-compile
&gt; req-compile .
# Compiles the current directory (looks for a setup.py or pyproject.toml)

&gt; req-compile subdir/project
# Compiles the project in the subdir/project directory

&gt; req-candidates --paths-only | req-compile
# Search for candidates and compile them piped in via stdin

&gt; echo flask | req-compile
# Compile the requirement 'flask' using the default remote index (PyPI)

&gt; req-compile . --extra test
# Compiles the current directory with the extra "test"
</pre>
<a name="user-content-specifying-source-of-distributions"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Specifying source of distributions</h4><a id="user-content-specifying-source-of-distributions" class="anchor" aria-label="Permalink: Specifying source of distributions" href="#specifying-source-of-distributions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Req-Compile supports obtaining python distributions from multiple sources, each of which can be specified more than once.
These are referred to as repositories. If a candidate can be found in a provided solution or source directory, the remaining
repositories will not be considered. This is important for "lazy" requirement updates (e.g. only updating what is necessary
to find a solution, and otherwise keep the existing solution) and ensure that source directories
take precedence over remote repositories.</p>
<p dir="auto">The following repositories can be specified:</p>
<ul dir="auto">
<li><p dir="auto"><code>--solution</code></p>
<p dir="auto">Load a previous solution and use it as a source of distributions. This will allow a full
recompilation of a working solution without requiring any other source. If the
solution file can't be found, a warning will be emitted but not cause a failure</p>
</li>
<li><p dir="auto"><code>--source</code></p>
<p dir="auto">Use a local filesystem with source python packages to compile from. This will search the entire
tree specified at the source directory, until an __init__.py is reached. <code>--remove-source</code> can
be supplied to remove results that were obtained from source directories. You may want to do
this if compiling for a project and only third party requirements compilation results need to be saved.</p>
</li>
<li><p dir="auto"><code>--find-links</code></p>
<p dir="auto">Read a directory to load distributions from. The directory can contain anything
a remote index would, wheels, zips, and source tarballs. This matches pip's command line.</p>
</li>
<li><p dir="auto"><code>--index-url</code></p>
<p dir="auto">URL of a remote index to search for packages in. When compiling, it's necessary to download
a package to determine its requirements. <code>--wheel-dir</code> can be supplied to specify where to save
these distributions. Otherwise they will be deleted after compilation is complete. When specified,
replaces the default index that is located in pip.conf/pip.ini on your system.</p>
</li>
<li><p dir="auto"><code>--extra-index-url</code></p>
<p dir="auto">Extra remote index to search. Same semantics as index-url, but searched afterward. Additionally,
does not replace the default index URL so it can be used as a supplemental source of requirements
without knowing (or recording in the solution) the default index URL.</p>
</li>
</ul>
<p dir="auto">All options can be repeated multiple times, with the resolution order within solution and source matching what
was passed on the commandline.</p>
<p dir="auto">By default, PyPI (<a href="https://pypi.org/" rel="nofollow">https://pypi.org/</a>) or the default pip index is added as a default repository. It can be removed by passing
<code>--no-index</code> on the commandline or passing a different index via <code>--index-url</code>.</p>
<a name="user-content-identifying-source-of-constraints"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Identifying source of constraints</h4><a id="user-content-identifying-source-of-constraints" class="anchor" aria-label="Permalink: Identifying source of constraints" href="#identifying-source-of-constraints"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Why did I just get version 1.11.0 of <code>six</code>? Find out by examining the output:</p>
<pre>six==1.11.0  # astroid, pathlib2, pymodbus (==1.11.0), pytest (&gt;=1.10.0), more_itertools (&lt;2.0.0,&gt;=1.0.0)
</pre>
<p dir="auto">In the above output, the (==1.11.0) indicates that pymodbus, the requirement name listed before the
parenthesis, specifically requested version 1.11.0 of six.</p>
<a name="user-content-constraining-output"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Constraining output</h4><a id="user-content-constraining-output" class="anchor" aria-label="Permalink: Constraining output" href="#constraining-output"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Constrain production outputs with test requirements using the <code>--constraints</code> flag. More than one file can be
passed:</p>
<pre>&gt; cat requirements.txt
astroid

&gt; cat test-requirements.txt
pylint&lt;1.6

&gt; req-compile requirements.txt --constraints test-requirements.txt
astroid==1.4.9            # pylint (&lt;1.5.0,&gt;=1.4.5), requirements.txt
lazy-object-proxy==1.7.1  # astroid
six==1.16.0               # astroid, pylint
wrapt==1.13.3             # astroid
</pre>
<p dir="auto">Note that astroid is constrained by <code>pylint</code>, even though <code>pylint</code> is not included in the output.</p>
<p dir="auto">If a passed constraints file is fully pinned, Req-Compile will not attempt to find a solution for
the requirements passed in the constraints files. This behavior only occurs if ALL of the requirements
listed in the constraints files are pinned. This is because pinning a single requirement may
still bring in transitive requirements that would affect the final solution. The heuristic of
checking that all requirements are pinned assumes that you are providing a full solution.</p>
<a name="user-content-advanced-features"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Advanced Features</h3><a id="user-content-advanced-features" class="anchor" aria-label="Permalink: Advanced Features" href="#advanced-features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<a name="user-content-compiling-a-constrained-subset"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Compiling a constrained subset</h4><a id="user-content-compiling-a-constrained-subset" class="anchor" aria-label="Permalink: Compiling a constrained subset" href="#compiling-a-constrained-subset"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Input can be supplied via stdin as well as via as through files. For example, to supply a full
solution through a second compilation in order to obtain a subset of requirements, the
following cmdline might be used:</p>
<pre>&gt; req-compile requirements.txt --constraints compiled-requirements.txt
</pre>
<p dir="auto">or, for example to consider two projects together:</p>
<pre>&gt; req-compile /some/other/project /myproject | req-compile /myproject --solution -
</pre>
<p dir="auto">which is equivalent to:</p>
<pre>&gt; req-compile /myproject --constraints /some/other/project
</pre>
<a name="user-content-resolving-constraint-conflicts"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Resolving constraint conflicts</h4><a id="user-content-resolving-constraint-conflicts" class="anchor" aria-label="Permalink: Resolving constraint conflicts" href="#resolving-constraint-conflicts"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Conflicts will automatically print the source of each conflicting requirement:</p>
<pre>&gt; cat projectreqs.txt
astroid&lt;1.6
pylint&gt;=1.5

&gt; req-compile projectreqs.txt
No version of astroid could possibly satisfy the following requirements (astroid&lt;1.6,&lt;3,&gt;=2.3.0):
  projectreqs.txt -&gt; astroid&lt;1.6
  projectreqs.txt -&gt; pylint 2.4.1 -&gt; astroid&lt;3,&gt;=2.3.0
</pre>
<a name="user-content-saving-distributions"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Saving distributions</h4><a id="user-content-saving-distributions" class="anchor" aria-label="Permalink: Saving distributions" href="#saving-distributions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Files downloading during the compile process can be saved for later install. This can optimize
the execution times of builds when a separate compile step is required:</p>
<pre>&gt; req-compile projectreqs.txt --wheel-dir .wheeldir &gt; compiledreqs.txt
&gt; pip install -r compiledreqs.txt --find-links .wheeldir --no-index
</pre>
<a name="user-content-cookbook"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Cookbook</h3><a id="user-content-cookbook" class="anchor" aria-label="Permalink: Cookbook" href="#cookbook"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Some useful patterns for projects are outlined below.</p>
<a name="user-content-compile-then-install"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Compile, then install</h4><a id="user-content-compile-then-install" class="anchor" aria-label="Permalink: Compile, then install" href="#compile-then-install"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">After requirements are compiled, the usual next step is to install them
into a virtualenv.</p>
<p dir="auto">A script for test might run:</p>
<pre>&gt; req-compile --extra test --solution compiled-requirements.txt --wheel-dir .wheeldir &gt; compiled-requirements.txt
&gt; pip-sync compiled-requirement.txt --find-links .wheeldir --no-index
or
&gt; pip install -r compiled-requirements.txt --find-links .wheeldir --no-index
</pre>
<p dir="auto">This would produce an environment containing all of the requirements and test requirements for the project
in the current directory (as defined by a setup.py). This is a <em>stable</em> set, in that only changes to
the requirements and constraints would produce a new output. To produce a totally fresh compilation,
don't pass in a previous solution.</p>
<p dir="auto">The find-links parameter to the sync or pip install will <em>reuse</em> the wheels already downloaded by Req-Compile during
the compilation phase. This will make the installation step entirely offline.</p>
<p dir="auto">When taking this environment to deploy, trim down the set to the install requirements:</p>
<pre>&gt; req-compile --solution compiled-requirements.txt --no-index &gt; install-requirements.txt
</pre>
<p dir="auto">install-requirements.txt will contain the pinned requirements that should be installed in your
target environment. The reason for this extra step is that you don't want to distribute
your test requirements, and you also want your installed requirements to be the same
versions that you've tested with. In order to get all of your explicitly declared
requirements and all of the transitive dependencies, you can use the prior solution to
extract a subset. Passing the <code>--no-index</code> makes it clear that this command will not
hit the remote index at all (though this would naturally be the case as solution files
take precedence over remote indexes in repository search order).</p>
<a name="user-content-compile-for-a-group-of-projects"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Compile for a group of projects</h4><a id="user-content-compile-for-a-group-of-projects" class="anchor" aria-label="Permalink: Compile for a group of projects" href="#compile-for-a-group-of-projects"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Req-Compile can discover requirements that are grouped together on the filesystem. The
<code>req-candidates</code> command will print discovered projects and with the <code>--paths-only</code> options
will dump their paths to stdout. This allows recursive discovery of projects that you
may want to compile together.</p>
<p dir="auto">For example, consider a filesystem with this layout:</p>
<pre>solution
  \_ utilities
  |   \_ network_helper
  |_ integrations
  |   \_ github
  \_ frameworks
      |_ neural_net
      \_ cluster
</pre>
<p dir="auto">In each of the leaf nodes, there is a setup.py and full python project. To compile these
together and ensure that their requirements will all install into the same environment:</p>
<pre>&gt; cd solution
&gt; req-candidates --paths-only
/home/user/projects/solution/utilities/network_helper
/home/user/projects/solution/integrations/github
/home/user/projects/solution/frameworks/neural_net
/home/user/projects/solution/frameworks/cluster

&gt; req-candidates --paths-only | req-compile --extra test --solution compiled-requirements.txt --wheel-dir .wheeldir &gt; compiled-requirements.txt
.. all reqs and all test reqs compiled together...
</pre>

</article></div>