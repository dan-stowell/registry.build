<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text">

<p dir="auto">
    <a target="_blank" rel="noopener noreferrer" href="logo.svg"><img src="logo.svg" alt="version_utils logo" title="logo" align="left" height="60" style="max-width: 100%; height: auto; max-height: 60px;"></a>
</p>

<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto"><code>version_utils</code></h1><a id="user-content-version_utils" class="anchor" aria-label="Permalink: version_utils" href="#version_utils"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="../../actions/workflows/pre-commit.yaml"><img src="../../actions/workflows/pre-commit.yaml/badge.svg" alt="pre-commit" style="max-width: 100%;"></a>
<a href="../../actions/workflows/ci.yaml"><img src="../../actions/workflows/ci.yaml/badge.svg" alt="CI" style="max-width: 100%;"></a></p>
<p dir="auto">Bazel module to work with version schemes and version requirement
specifications.</p>
<p dir="auto">It currently supports <a href="https://semver.org" rel="nofollow">semantic versions</a> and <a href="https://www.postgresql.org/support/versioning/" rel="nofollow">Postgres versions</a>, as well as
semantic version requirement specifications such as <a href="https://github.com/npm/node-semver?tab=readme-ov-file#ranges">NPM-style <code>node-semver</code>
<code>Ranges</code> syntax</a>.</p>
<p dir="auto">Ideally, it will eventually expand to support additional versions (e.g. <a href="https://www.debian.org/doc/debian-policy/ch-controlfields.html#version" rel="nofollow">Debian
versions</a> and <a href="https://www.debian.org/doc/debian-policy/ch-relationships.html#syntax-of-relationship-fields" rel="nofollow">Debian version requirements</a>).</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">ðŸ“¦ Install</h2><a id="user-content--install" class="anchor" aria-label="Permalink: ðŸ“¦ Install" href="#-install"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">First, make sure you are running Bazel with <a href="https://bazel.build/external/migration" rel="nofollow">Bzlmod</a>. Then, add the module as a
dependency in your <code>MODULE.bazel</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;version_utils&quot;, version = &quot;&lt;VERSION&gt;&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"version_utils"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"&lt;VERSION&gt;"</span>)</pre></div>
<details>
<summary><div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Non-registry overrides</h3><a id="user-content-non-registry-overrides" class="anchor" aria-label="Permalink: Non-registry overrides" href="#non-registry-overrides"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div></summary>
<p dir="auto">If you need to use a specific commit or version tag from the repo instead of a
version from the registry, add a <a href="https://bazel.build/external/module#non-registry_overrides" rel="nofollow">non-registry override</a> in your <code>MODULE.bazel</code>
file, e.g. <a href="https://bazel.build/rules/lib/globals/module#archive_override" rel="nofollow"><code>archive_override</code></a>:</p>


<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="REF = &quot;v&lt;VERSION&gt;&quot;  # NOTE: can be a repo tag or a commit hash

archive_override(
    module_name = &quot;version_utils&quot;,
    integrity = &quot;&quot;,  # TODO: copy the SRI hash that Bazel prints when fetching
    strip_prefix = &quot;bazel_version_utils-%s&quot; % REF.strip(&quot;v&quot;),
    urls = [&quot;https://github.com/jjmaestro/bazel_version_utils/archive/%s.tar.gz&quot; % REF],
)"><pre><span class="pl-c1">REF</span> <span class="pl-c1">=</span> <span class="pl-s">"v&lt;VERSION&gt;"</span>  <span class="pl-c"># NOTE: can be a repo tag or a commit hash</span>

<span class="pl-en">archive_override</span>(
    <span class="pl-s1">module_name</span> <span class="pl-c1">=</span> <span class="pl-s">"version_utils"</span>,
    <span class="pl-s1">integrity</span> <span class="pl-c1">=</span> <span class="pl-s">""</span>,  <span class="pl-c"># TODO: copy the SRI hash that Bazel prints when fetching</span>
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_version_utils-%s"</span> <span class="pl-c1">%</span> <span class="pl-c1">REF</span>.<span class="pl-c1">strip</span>(<span class="pl-s">"v"</span>),
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/jjmaestro/bazel_version_utils/archive/%s.tar.gz"</span> <span class="pl-c1">%</span> <span class="pl-c1">REF</span>],
)</pre></div>

<p dir="auto"><strong>NOTE</strong>:
<code>integrity</code> is intentionally empty so Bazel will warn and print the SRI hash of
the downloaded artifact. <strong>Leaving it empty is a security risk</strong>. Always verify
the contents of the downloaded artifact, copy the printed hash and update
<code>MODULE.bazel</code> accordingly.</p>
</details>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">ðŸš€ Getting Started</h2><a id="user-content--getting-started" class="anchor" aria-label="Permalink: ðŸš€ Getting Started" href="#-getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>version</code></h3><a id="user-content-version" class="anchor" aria-label="Permalink: version" href="#version"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This package provides extensions to work with different version schemes. It
currently supports two version schemes: <a href="https://semver.org" rel="nofollow">semantic versions</a> and <a href="https://www.postgresql.org/support/versioning/" rel="nofollow">Postgres
versions</a>.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">example: semantic versions</h4><a id="user-content-example-semantic-versions" class="anchor" aria-label="Permalink: example: semantic versions" href="#example-semantic-versions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A semantic version can be created by parsing a string:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@version_utils//version:semver.bzl&quot;, &quot;semver&quot;)

version = semver.parse(&quot;1.0.2-alpha+build.2025-01-15&quot;)

print(version.major, version.minor, version.patch)
# 1 0 2

print(version.prerelease)
# (&quot;alpha&quot;,)

print(version.build)
# (&quot;build&quot;, &quot;2025-01-15&quot;)

print(version.to_str())
# 1.0.2-alpha+build.2025-01-15"><pre><span class="pl-en">load</span>(<span class="pl-s">"@version_utils//version:semver.bzl"</span>, <span class="pl-s">"semver"</span>)

<span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">"1.0.2-alpha+build.2025-01-15"</span>)

<span class="pl-en">print</span>(<span class="pl-s1">version</span>.<span class="pl-c1">major</span>, <span class="pl-s1">version</span>.<span class="pl-c1">minor</span>, <span class="pl-s1">version</span>.<span class="pl-c1">patch</span>)
<span class="pl-c"># 1 0 2</span>

<span class="pl-en">print</span>(<span class="pl-s1">version</span>.<span class="pl-c1">prerelease</span>)
<span class="pl-c"># ("alpha",)</span>

<span class="pl-en">print</span>(<span class="pl-s1">version</span>.<span class="pl-c1">build</span>)
<span class="pl-c"># ("build", "2025-01-15")</span>

<span class="pl-en">print</span>(<span class="pl-s1">version</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.0.2-alpha+build.2025-01-15</span></pre></div>
<p dir="auto">It can also be created by specifying its named fields:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="version = semver.new(major = 1, minor = 0, patch = 2)

print(version.major, version.minor, version.patch)
# 1 0 2

version = semver.new(major = 1, minor = 0)
# Error in fail: Invalid semantic version minor/patch value: None"><pre><span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">new</span>(<span class="pl-s1">major</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>, <span class="pl-s1">minor</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>, <span class="pl-s1">patch</span> <span class="pl-c1">=</span> <span class="pl-c1">2</span>)

<span class="pl-en">print</span>(<span class="pl-s1">version</span>.<span class="pl-c1">major</span>, <span class="pl-s1">version</span>.<span class="pl-c1">minor</span>, <span class="pl-s1">version</span>.<span class="pl-c1">patch</span>)
<span class="pl-c"># 1 0 2</span>

<span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">new</span>(<span class="pl-s1">major</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>, <span class="pl-s1">minor</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>)
<span class="pl-c"># Error in fail: Invalid semantic version minor/patch value: None</span></pre></div>
<details>
<summary><div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Working with versions</h4><a id="user-content-working-with-versions" class="anchor" aria-label="Permalink: Working with versions" href="#working-with-versions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div></summary>
<p dir="auto">Versions can be compared:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="v1 = semver.parse('0.1.1')
v2 = semver.parse('0.1.2')
v3 = semver.parse('0.1.1-alpha.1')

res = v1.lt(v2)
print(res)
# True

res = v1.gt(v3)
print(res)
# True

res = v1.le(v3)
print(res)
# False"><pre><span class="pl-s1">v1</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">'0.1.1'</span>)
<span class="pl-s1">v2</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">'0.1.2'</span>)
<span class="pl-s1">v3</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">'0.1.1-alpha.1'</span>)

<span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-s1">v1</span>.<span class="pl-c1">lt</span>(<span class="pl-s1">v2</span>)
<span class="pl-en">print</span>(<span class="pl-s1">res</span>)
<span class="pl-c"># True</span>

<span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-s1">v1</span>.<span class="pl-c1">gt</span>(<span class="pl-s1">v3</span>)
<span class="pl-en">print</span>(<span class="pl-s1">res</span>)
<span class="pl-c"># True</span>

<span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-s1">v1</span>.<span class="pl-c1">le</span>(<span class="pl-s1">v3</span>)
<span class="pl-en">print</span>(<span class="pl-s1">res</span>)
<span class="pl-c"># False</span></pre></div>
<p dir="auto">Versions can be incremented ("bumped") in any of their version fields:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="version = semver.parse('1.0.0+build')

bumped = version.bump(&quot;patch&quot;)
print(bumped.to_str())
# 1.0.1

bumped = version.bump(&quot;minor&quot;)
print(bumped.to_str())
# 1.1.0

bumped = version.bump(&quot;major&quot;)
print(bumped.to_str())
# 2.0.0"><pre><span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">'1.0.0+build'</span>)

<span class="pl-s1">bumped</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">bump</span>(<span class="pl-s">"patch"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">bumped</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.0.1</span>

<span class="pl-s1">bumped</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">bump</span>(<span class="pl-s">"minor"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">bumped</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.1.0</span>

<span class="pl-s1">bumped</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">bump</span>(<span class="pl-s">"major"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">bumped</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 2.0.0</span></pre></div>
<p dir="auto">and can be truncated up to any of their version fields:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="version = semver.parse('1.2.3-pre.1+build.1')

truncated = version.truncate(&quot;build&quot;)
print(truncated.to_str())
# 1.2.3-pre.1+build.1

truncated = version.truncate(&quot;prerelease&quot;)
print(truncated.to_str())
# 1.2.3-pre.1

truncated = version.truncate(&quot;patch&quot;)
print(truncated.to_str())
# 1.2.3

truncated = version.truncate(&quot;minor&quot;)
print(truncated.to_str())
# 1.1.0

truncated = version.truncate(&quot;major&quot;)
print(truncated.to_str())
# 1.0.0"><pre><span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">'1.2.3-pre.1+build.1'</span>)

<span class="pl-s1">truncated</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">truncate</span>(<span class="pl-s">"build"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">truncated</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.2.3-pre.1+build.1</span>

<span class="pl-s1">truncated</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">truncate</span>(<span class="pl-s">"prerelease"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">truncated</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.2.3-pre.1</span>

<span class="pl-s1">truncated</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">truncate</span>(<span class="pl-s">"patch"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">truncated</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.2.3</span>

<span class="pl-s1">truncated</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">truncate</span>(<span class="pl-s">"minor"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">truncated</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.1.0</span>

<span class="pl-s1">truncated</span> <span class="pl-c1">=</span> <span class="pl-s1">version</span>.<span class="pl-c1">truncate</span>(<span class="pl-s">"major"</span>)
<span class="pl-en">print</span>(<span class="pl-s1">truncated</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 1.0.0</span></pre></div>
</details>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>spec</code>: Version Requirement Specifications</h3><a id="user-content-spec-version-requirement-specifications" class="anchor" aria-label="Permalink: spec: Version Requirement Specifications" href="#spec-version-requirement-specifications"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This package provides a <code>spec</code> extension to work with version requirement
specifications.</p>
<p dir="auto">It currently supports two syntaxes:</p>
<ul dir="auto">
<li><a href="docs/spec/internal/simple.md"><code>SYNTAX.SIMPLE</code></a>: an easy, natural requirement syntax somewhat inspired by
Python's <a href="https://peps.python.org/pep-0440/" rel="nofollow">PEP 440</a> (e.g. <code>&gt;=0.1.1,&lt;0.3.0</code>). This is the default.</li>
<li><a href="docs/spec/internal/npm.md"><code>SYNTAX.NPM</code></a>: the <a href="https://github.com/npm/node-semver?tab=readme-ov-file#ranges">NPM-style <code>node-semver</code> <code>Ranges</code> syntax</a> (e.g. <code>&gt;=0.1.1 &lt;0.1.3 || 2.x</code>).</li>
</ul>
<p dir="auto">To begin, create a new <code>Spec</code> <code>struct</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@version_utils//spec:spec.bzl&quot;, &quot;spec&quot;)

simple = spec.new(&quot;&gt;=0.1.0,&lt;0.4.0&quot;)

npm = spec.new(&quot;&gt;=0.1.0 &lt;0.3.0&quot;, syntax = spec.SYNTAX.NPM)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@version_utils//spec:spec.bzl"</span>, <span class="pl-s">"spec"</span>)

<span class="pl-s1">simple</span> <span class="pl-c1">=</span> <span class="pl-s1">spec</span>.<span class="pl-c1">new</span>(<span class="pl-s">"&gt;=0.1.0,&lt;0.4.0"</span>)

<span class="pl-s1">npm</span> <span class="pl-c1">=</span> <span class="pl-s1">spec</span>.<span class="pl-c1">new</span>(<span class="pl-s">"&gt;=0.1.0 &lt;0.3.0"</span>, <span class="pl-s1">syntax</span> <span class="pl-c1">=</span> <span class="pl-s1">spec</span>.<span class="pl-c1">SYNTAX</span>.<span class="pl-c1">NPM</span>)</pre></div>
<p dir="auto">The <code>Spec</code> <code>struct</code> has three methods:</p>
<ul dir="auto">
<li><code>spec.match</code>: checks whether the given version satisfies the version
requirement specification:</li>
</ul>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="version = semver.parse(&quot;0.2.0&quot;)

print(simple.match(version))
# True

version = semver.parse(&quot;0.4.0&quot;)

print(simple.match(version))
# False"><pre><span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">"0.2.0"</span>)

<span class="pl-en">print</span>(<span class="pl-s1">simple</span>.<span class="pl-c1">match</span>(<span class="pl-s1">version</span>))
<span class="pl-c"># True</span>

<span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">"0.4.0"</span>)

<span class="pl-en">print</span>(<span class="pl-s1">simple</span>.<span class="pl-c1">match</span>(<span class="pl-s1">version</span>))
<span class="pl-c"># False</span></pre></div>
<ul dir="auto">
<li><code>spec.filter</code>: filters the versions in the iterable of versions that match
the version requirements:</li>
</ul>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="versions = [semver.parse(&quot;0.%d.0&quot; % i) for i in range(6)]

for v in simple.filter(versions):
    print(v.to_str())
# 0.1.0
# 0.2.0
# 0.3.0

for v in npm.filter(versions):
    print(v.to_str())
# 0.1.0
# 0.2.0"><pre><span class="pl-s1">versions</span> <span class="pl-c1">=</span> [<span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">"0.%d.0"</span> <span class="pl-c1">%</span> <span class="pl-s1">i</span>) <span class="pl-k">for</span> <span class="pl-s1">i</span> <span class="pl-c1">in</span> <span class="pl-en">range</span>(<span class="pl-c1">6</span>)]

<span class="pl-k">for</span> <span class="pl-s1">v</span> <span class="pl-c1">in</span> <span class="pl-s1">simple</span>.<span class="pl-c1">filter</span>(<span class="pl-s1">versions</span>):
    <span class="pl-en">print</span>(<span class="pl-s1">v</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 0.1.0</span>
<span class="pl-c"># 0.2.0</span>
<span class="pl-c"># 0.3.0</span>

<span class="pl-k">for</span> <span class="pl-s1">v</span> <span class="pl-c1">in</span> <span class="pl-s1">npm</span>.<span class="pl-c1">filter</span>(<span class="pl-s1">versions</span>):
    <span class="pl-en">print</span>(<span class="pl-s1">v</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 0.1.0</span>
<span class="pl-c"># 0.2.0</span></pre></div>
<ul dir="auto">
<li><code>spec.select</code>: selects the highest version from an iterable of versions that
matches the version requirements:</li>
</ul>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="versions = [semver.parse(&quot;0.%d.0&quot; % i) for i in range(6)]

v = npm.select(versions)

print(v.to_str())
# 0.2.0"><pre><span class="pl-s1">versions</span> <span class="pl-c1">=</span> [<span class="pl-s1">semver</span>.<span class="pl-c1">parse</span>(<span class="pl-s">"0.%d.0"</span> <span class="pl-c1">%</span> <span class="pl-s1">i</span>) <span class="pl-k">for</span> <span class="pl-s1">i</span> <span class="pl-c1">in</span> <span class="pl-en">range</span>(<span class="pl-c1">6</span>)]

<span class="pl-s1">v</span> <span class="pl-c1">=</span> <span class="pl-s1">npm</span>.<span class="pl-c1">select</span>(<span class="pl-s1">versions</span>)

<span class="pl-en">print</span>(<span class="pl-s1">v</span>.<span class="pl-c1">to_str</span>())
<span class="pl-c"># 0.2.0</span></pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">ðŸ“„ <a href="docs/README.md">Docs</a></h2><a id="user-content--docs" class="anchor" aria-label="Permalink: ðŸ“„ Docs" href="#-docs"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For more details about each component, check the documentation:</p>
<ul dir="auto">
<li><a href="docs/version/semver.md"><code>version/semver</code></a>: for <a href="https://semver.org" rel="nofollow">semantic versions</a>.</li>
<li><a href="docs/version/pgver.md"><code>version/pgver</code></a>: for <a href="https://www.postgresql.org/support/versioning/" rel="nofollow">Postgres versions</a>.</li>
<li><a href="docs/spec/spec.md"><code>spec/spec</code></a>: for version requirement specifications.</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">ðŸ’¡ Contributing</h2><a id="user-content--contributing" class="anchor" aria-label="Permalink: ðŸ’¡ Contributing" href="#-contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Please feel free to open <a href="../../issues">issues</a> and <a href="../../pulls">PRs</a>, contributions are always welcome!
See <a href="CONTRIBUTING.md">CONTRIBUTING.md</a> for more info on how to work with this repo.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">ðŸ«¶ Acknowledgements</h2><a id="user-content--acknowledgements" class="anchor" aria-label="Permalink: ðŸ«¶ Acknowledgements" href="#-acknowledgements"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This Bazel module began as a Starlark port of <a href="https://github.com/rbarrois/python-semanticversion">python-semanticversion</a>. Credit
and thanks to its original author, <a href="https://github.com/rbarrois">@rbarrois</a>!</p>
</article></div>