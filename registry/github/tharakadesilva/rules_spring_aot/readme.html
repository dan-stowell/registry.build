<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Bazel rules for Spring AOT</h1><a id="user-content-bazel-rules-for-spring-aot" class="anchor" aria-label="Permalink: Bazel rules for Spring AOT" href="#bazel-rules-for-spring-aot"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel rules for building Spring applications with Ahead-of-Time (AOT) compilation support. These rules enable you to leverage Spring's AOT processing capabilities within your Bazel build, resulting in faster startup times and reduced memory footprint for your Spring applications.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Features</h2><a id="user-content-features" class="anchor" aria-label="Permalink: Features" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>ðŸš€ <strong>Faster Startup</strong>: Pre-process Spring beans and configurations at build time</li>
<li>ðŸ’¾ <strong>Reduced Memory</strong>: Lower runtime memory usage through AOT optimizations</li>
<li>ðŸ”§ <strong>Native Image Support</strong>: Essential for GraalVM native image compilation</li>
<li>ðŸ“¦ <strong>Seamless Integration</strong>: Works with existing Bazel Java rules</li>
<li>ðŸ”„ <strong>Reproducible Builds</strong>: Consistent AOT processing across environments</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using Bazel Modules (Bzlmod)</h3><a id="user-content-using-bazel-modules-bzlmod" class="anchor" aria-label="Permalink: Using Bazel Modules (Bzlmod)" href="#using-bazel-modules-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add to your <code>MODULE.bazel</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;rules_spring_aot&quot;, version = &quot;0.1.0&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_spring_aot"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.1.0"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using WORKSPACE</h3><a id="user-content-using-workspace" class="anchor" aria-label="Permalink: Using WORKSPACE" href="#using-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">From the release you wish to use:
<a href="https://github.com/tharakadesilva/rules_spring_aot/releases">https://github.com/tharakadesilva/rules_spring_aot/releases</a>
copy the WORKSPACE snippet into your <code>WORKSPACE</code> file.</p>
<p dir="auto">To use a commit rather than a release, you can point at any SHA of the repo.</p>
<p dir="auto">For example to use commit <code>abc123</code>:</p>
<ol dir="auto">
<li>Replace <code>url = "https://github.com/tharakadesilva/rules_spring_aot/releases/download/v0.1.0/rules_spring_aot-v0.1.0.tar.gz"</code> with a GitHub-provided source archive like <code>url = "https://github.com/tharakadesilva/rules_spring_aot/archive/abc123.tar.gz"</code></li>
<li>Replace <code>strip_prefix = "rules_spring_aot-0.1.0"</code> with <code>strip_prefix = "rules_spring_aot-abc123"</code></li>
<li>Update the <code>sha256</code>. The easiest way to do this is to comment out the line, then Bazel will
print a message with the correct value.</li>
</ol>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Quick Start</h2><a id="user-content-quick-start" class="anchor" aria-label="Permalink: Quick Start" href="#quick-start"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1. Basic Spring Boot Application with AOT</h3><a id="user-content-1-basic-spring-boot-application-with-aot" class="anchor" aria-label="Permalink: 1. Basic Spring Boot Application with AOT" href="#1-basic-spring-boot-application-with-aot"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_spring_aot//spring_aot:defs.bzl&quot;, &quot;spring_aot_library&quot;)
load(&quot;@rules_java//java:defs.bzl&quot;, &quot;java_library&quot;, &quot;java_binary&quot;)

# Define your Spring Boot application
java_library(
    name = &quot;my-app-lib&quot;,
    srcs = glob([&quot;src/main/java/**/*.java&quot;]),
    runtime_deps = [
        &quot;@maven//:org_springframework_boot_spring_boot_starter_web&quot;,
    ],
    deps = [
        # ... other dependencies
    ],
)

# Apply AOT processing
# Creates a java_library containing all AOT-generated classes and resources
spring_aot_library(
    name = &quot;my-app-aot&quot;,
    target = &quot;:my-app-lib&quot;,
    main_class = &quot;com.example.MyApplication&quot;,
    group_id = &quot;com.example&quot;,
    artifact_id = &quot;my-app&quot;,
)

# Create executable JAR
# Produces a standard JAR with improved startup time (faster than regular Spring Boot, slower than native)
java_binary(
    name = &quot;my-app&quot;,
    main_class = &quot;com.example.MyApplication&quot;,
    runtime_deps = [&quot;:my-app-aot&quot;],
    jvm_flags = [&quot;-Dspring.aot.enabled=true&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_spring_aot//spring_aot:defs.bzl"</span>, <span class="pl-s">"spring_aot_library"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@rules_java//java:defs.bzl"</span>, <span class="pl-s">"java_library"</span>, <span class="pl-s">"java_binary"</span>)

<span class="pl-c"># Define your Spring Boot application</span>
<span class="pl-en">java_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my-app-lib"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"src/main/java/**/*.java"</span>]),
    <span class="pl-s1">runtime_deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@maven//:org_springframework_boot_spring_boot_starter_web"</span>,
    ],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-c"># ... other dependencies</span>
    ],
)

<span class="pl-c"># Apply AOT processing</span>
<span class="pl-c"># Creates a java_library containing all AOT-generated classes and resources</span>
<span class="pl-en">spring_aot_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my-app-aot"</span>,
    <span class="pl-s1">target</span> <span class="pl-c1">=</span> <span class="pl-s">":my-app-lib"</span>,
    <span class="pl-s1">main_class</span> <span class="pl-c1">=</span> <span class="pl-s">"com.example.MyApplication"</span>,
    <span class="pl-s1">group_id</span> <span class="pl-c1">=</span> <span class="pl-s">"com.example"</span>,
    <span class="pl-s1">artifact_id</span> <span class="pl-c1">=</span> <span class="pl-s">"my-app"</span>,
)

<span class="pl-c"># Create executable JAR</span>
<span class="pl-c"># Produces a standard JAR with improved startup time (faster than regular Spring Boot, slower than native)</span>
<span class="pl-en">java_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my-app"</span>,
    <span class="pl-s1">main_class</span> <span class="pl-c1">=</span> <span class="pl-s">"com.example.MyApplication"</span>,
    <span class="pl-s1">runtime_deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":my-app-aot"</span>],
    <span class="pl-s1">jvm_flags</span> <span class="pl-c1">=</span> [<span class="pl-s">"-Dspring.aot.enabled=true"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">2. Native Image with GraalVM</h3><a id="user-content-2-native-image-with-graalvm" class="anchor" aria-label="Permalink: 2. Native Image with GraalVM" href="#2-native-image-with-graalvm"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="https://github.com/sgammon/rules_graalvm">rules_graalvm</a> for setup instructions.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_spring_aot//spring_aot:defs.bzl&quot;, &quot;spring_aot_library&quot;)
load(&quot;@rules_graalvm//graalvm:defs.bzl&quot;, &quot;native_image&quot;)

# ... (previous definitions)

# Build native executable
native_image(
    name = &quot;my-app-native&quot;,
    main_class = &quot;com.example.MyApplication&quot;,
    native_image_tool = &quot;@graalvm//:native-image&quot;,
    deps = [&quot;:my-app-aot&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_spring_aot//spring_aot:defs.bzl"</span>, <span class="pl-s">"spring_aot_library"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@rules_graalvm//graalvm:defs.bzl"</span>, <span class="pl-s">"native_image"</span>)

<span class="pl-c"># ... (previous definitions)</span>

<span class="pl-c"># Build native executable</span>
<span class="pl-en">native_image</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my-app-native"</span>,
    <span class="pl-s1">main_class</span> <span class="pl-c1">=</span> <span class="pl-s">"com.example.MyApplication"</span>,
    <span class="pl-s1">native_image_tool</span> <span class="pl-c1">=</span> <span class="pl-s">"@graalvm//:native-image"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":my-app-aot"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Requirements</h2><a id="user-content-requirements" class="anchor" aria-label="Permalink: Requirements" href="#requirements"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Bazel 8.3 or higher</li>
<li>Java 17 or higher</li>
<li>Spring Boot 3.0 or higher (requires AOT support)
<ul dir="auto">
<li><strong>Note</strong>: <code>org.springframework.boot/spring-boot</code> must be present in the target java_library's classpath</li>
</ul>
</li>
<li>GraalVM (optional, for native image builds)</li>
<li><strong>Platform</strong>: Linux (Ubuntu; Debian needs testing) and macOS only (Windows is not supported)</li>
</ul>
</article></div>