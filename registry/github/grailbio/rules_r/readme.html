<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">R Rules for Bazel <a href="https://github.com/grailbio/rules_r/actions/workflows/tests.yml"><img src="https://github.com/grailbio/rules_r/actions/workflows/tests.yml/badge.svg" alt="Tests" style="max-width: 100%;"></a></h1><a id="user-content-r-rules-for-bazel-" class="anchor" aria-label="Permalink: R Rules for Bazel " href="#r-rules-for-bazel-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">General Information</h4><a id="user-content-general-information" class="anchor" aria-label="Permalink: General Information" href="#general-information"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="#overview">Overview</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#external-packages">External Packages</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#known-issues">Known Issues</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Rules</h4><a id="user-content-rules" class="anchor" aria-label="Permalink: Rules" href="#rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="#r_pkg">r_pkg</a></li>
<li><a href="#r_library">r_library</a></li>
<li><a href="#r_unit_test">r_unit_test</a></li>
<li><a href="#r_pkg_test">r_pkg_test</a></li>
<li><a href="#r_binary">r_binary</a></li>
<li><a href="#r_test">r_test</a></li>
<li><a href="#r_markdown">r_markdown</a></li>
<li><a href="#r_toolchain">r_toolchain</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Repository Rules</h4><a id="user-content-repository-rules" class="anchor" aria-label="Permalink: Repository Rules" href="#repository-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="#r_repository">r_repository</a></li>
<li><a href="#r_repository_list">r_repository_list</a></li>
<li><a href="#r_rules_dependencies">r_rules_dependencies</a></li>
<li><a href="#r_coverage_dependencies">r_coverage_dependencies</a></li>
<li><a href="#r_register_toolchains">r_register_toolchains</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Container Rules</h4><a id="user-content-container-rules" class="anchor" aria-label="Permalink: Container Rules" href="#container-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="R/container/README.md#r_library_image">r_library_image</a></li>
<li><a href="R/container/README.md#r_binary_image">r_binary_image</a></li>
</ul>
<p dir="auto"><a name="user-content-overview"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Overview</h2><a id="user-content-overview" class="anchor" aria-label="Permalink: Overview" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">These rules are used for building <a href="https://cran.r-project.org" rel="nofollow">R</a> packages with Bazel. Although R has an
excellent package management system, there is no continuous build and
integration system for entire R package repositories. An advantage of using
Bazel, over a custom solution of tracking the package dependency graph and
triggering builds accordingly on each commit, is that R packages can be built
and tested as part of one build system in multi-language monorepos.</p>
<p dir="auto">These rules are mature for production use.</p>
<p dir="auto"><a name="user-content-getting-started"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Getting started</h2><a id="user-content-getting-started" class="anchor" aria-label="Permalink: Getting started" href="#getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The following assumes that you are familiar with how to use Bazel in general.</p>
<p dir="auto">To begin, you can add the following or equivalent to your WORKSPACE file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

# Change master to the git tag you want.
http_archive(
    name = &quot;rules_r&quot;,
    strip_prefix = &quot;rules_r-master&quot;,
    urls = [&quot;https://github.com/grailbio/rules_r/archive/master.tar.gz&quot;],
)

load(&quot;@rules_r//R:dependencies.bzl&quot;, &quot;r_register_toolchains&quot;, &quot;r_rules_dependencies&quot;)

r_rules_dependencies()

r_register_toolchains()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-c"># Change master to the git tag you want.</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_r"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_r-master"</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/grailbio/rules_r/archive/master.tar.gz"</span>],
)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_r//R:dependencies.bzl"</span>, <span class="pl-s">"r_register_toolchains"</span>, <span class="pl-s">"r_rules_dependencies"</span>)

<span class="pl-en">r_rules_dependencies</span>()

<span class="pl-en">r_register_toolchains</span>()</pre></div>
<p dir="auto">You can load the rules in your BUILD file like so:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_r//R:defs.bzl&quot;,
     &quot;r_pkg&quot;, &quot;r_library&quot;, &quot;r_unit_test&quot;, &quot;r_pkg_test&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_r//R:defs.bzl"</span>,
     <span class="pl-s">"r_pkg"</span>, <span class="pl-s">"r_library"</span>, <span class="pl-s">"r_unit_test"</span>, <span class="pl-s">"r_pkg_test"</span>)</pre></div>
<p dir="auto">Advanced users can also set up <a href="gazelle">Gazelle</a> to maintain the BUILD files
for the R packages in their repo automatically.</p>
<p dir="auto"><a name="user-content-configuration"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Configuration</h2><a id="user-content-configuration" class="anchor" aria-label="Permalink: Configuration" href="#configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The following software must be installed on your system:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="1. bazel (v5.0.0 or above)
2. R (4.1.2 or above; should be locatable using the `PATH` environment variable)"><pre class="notranslate"><code>1. bazel (v5.0.0 or above)
2. R (4.1.2 or above; should be locatable using the `PATH` environment variable)
</code></pre></div>
<p dir="auto"><strong>NOTE</strong>: After re-installing or upgrading R, please reset the registered
toolchain with <code>bazel sync --configure</code> to rebuild your packages with the new
installation.</p>
<p dir="auto"><strong>NOTE</strong>: It is possible to use R from a bazel package instead of a system
installation. See the toolchain <code>r-toolchain-nix</code> in the tests directory as an
example.</p>
<p dir="auto">For each package, you can also specify a different Makevars file that can be
used to have finer control over native code compilation. The site-wide
Makevars files are configured by default in the toolchains, and these define
the compiler toolchain to use and the flags needed for these toolchains for
reproducible builds.</p>
<p dir="auto">For <em>macOS</em>, this setup will help you cover the requirements for a large number
of packages:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="brew install gcc pkg-config icu4c openssl"><pre class="notranslate"><code>brew install gcc pkg-config icu4c openssl
</code></pre></div>
<p dir="auto">For <em>Ubuntu</em>, this (or equivalent for other Unix systems) helps:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="apt-get install pkgconf libssl-dev libxml2-dev libcurl4-openssl-dev"><pre class="notranslate"><code>apt-get install pkgconf libssl-dev libxml2-dev libcurl4-openssl-dev
</code></pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Note</h4><a id="user-content-note" class="anchor" aria-label="Permalink: Note" href="#note"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For no interference from other packages during the build (possibly other
versions installed manually by the user), it is recommended that packages other
than those with recommended priority be installed in the directory pointed to
by <code>R_LIBS_USER</code>. The Bazel build process will then be able to hide all the
other packages from R by setting a different value for <code>R_LIBS_USER</code>.</p>
<p dir="auto">When moving to Bazel for installing R packages on your system, we recommend
cleaning up existing machines:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="sudo Rscript \
  -e 'options(&quot;repos&quot;=&quot;https://cloud.r-project.org&quot;)' \
  -e 'lib &lt;- c(.Library, .Library.site)' \
  -e 'non_base_pkgs &lt;- installed.packages(lib.loc=lib, priority=c(&quot;recommended&quot;, &quot;NA&quot;))[, &quot;Package&quot;]' \
  -e 'remove.packages(non_base_pkgs, lib=lib)'

# If not set up already, create the directory for R_LIBS_USER.
Rscript \
  -e 'dir.create(Sys.getenv(&quot;R_LIBS_USER&quot;), recursive=TRUE, showWarnings=FALSE)'"><pre class="notranslate"><code>sudo Rscript \
  -e 'options("repos"="https://cloud.r-project.org")' \
  -e 'lib &lt;- c(.Library, .Library.site)' \
  -e 'non_base_pkgs &lt;- installed.packages(lib.loc=lib, priority=c("recommended", "NA"))[, "Package"]' \
  -e 'remove.packages(non_base_pkgs, lib=lib)'

# If not set up already, create the directory for R_LIBS_USER.
Rscript \
  -e 'dir.create(Sys.getenv("R_LIBS_USER"), recursive=TRUE, showWarnings=FALSE)'
</code></pre></div>
<p dir="auto">For more details on how R searches different paths for packages, see
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/libPaths.html" rel="nofollow">libPaths</a>.</p>
<p dir="auto"><a name="user-content-external-packages"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">External packages</h2><a id="user-content-external-packages" class="anchor" aria-label="Permalink: External packages" href="#external-packages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To depend on external packages from CRAN and other remote repos, you can define the
packages as a CSV with three columns -- Package, Version, and sha256. Then use
<a href="#r_repository_list">r_repository_list</a> rule to define R repositories for each
package. For packages not in a CRAN like repo (e.g. github), you can use
<a href="#r_repository">r_repository</a> rule directly. For packages on your local system
but outside your main repository, you will have to use <code>local_repository</code> with
a saved BUILD file. Same for VCS repositories.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="load(&quot;@rules_r//R:repositories.bzl&quot;, &quot;r_repository&quot;, &quot;r_repository_list&quot;)

# R packages with non-standard sources.
r_repository(
    name = &quot;R_plotly&quot;,
    sha256 = &quot;24c848fa2cbb6aed6a59fa94f8c9b917de5b777d14919268e88bff6c4562ed29&quot;,
    strip_prefix = &quot;plotly-a60510e4bbce5c6bed34ef6439d7a48cb54cad0a&quot;,
    urls = [
        &quot;https://github.com/ropensci/plotly/archive/a60510e4bbce5c6bed34ef6439d7a48cb54cad0a.tar.gz&quot;,
    ],
)

# R packages with standard sources.
# See below for an example of how to generate the CSV package_list.
r_repository_list(
    name = &quot;r_repositories_bzl&quot;,
    build_file_overrides = &quot;@myrepo//third-party/R:build_file_overrides.csv&quot;,
    package_list = &quot;@myrepo//third-party/R:packages.csv&quot;,
    remote_repos = {
        &quot;BioCsoft&quot;: &quot;https://bioconductor.org/packages/3.14/bioc&quot;,
        &quot;BioCann&quot;: &quot;https://bioconductor.org/packages/3.14/data/annotation&quot;,
        &quot;BioCexp&quot;: &quot;https://bioconductor.org/packages/3.14/data/experiment&quot;,
        &quot;CRAN&quot;: &quot;https://cloud.r-project.org&quot;,
    },
)

load(&quot;@r_repositories_bzl//:r_repositories.bzl&quot;, &quot;r_repositories&quot;)

r_repositories()"><pre class="notranslate"><code>load("@rules_r//R:repositories.bzl", "r_repository", "r_repository_list")

# R packages with non-standard sources.
r_repository(
    name = "R_plotly",
    sha256 = "24c848fa2cbb6aed6a59fa94f8c9b917de5b777d14919268e88bff6c4562ed29",
    strip_prefix = "plotly-a60510e4bbce5c6bed34ef6439d7a48cb54cad0a",
    urls = [
        "https://github.com/ropensci/plotly/archive/a60510e4bbce5c6bed34ef6439d7a48cb54cad0a.tar.gz",
    ],
)

# R packages with standard sources.
# See below for an example of how to generate the CSV package_list.
r_repository_list(
    name = "r_repositories_bzl",
    build_file_overrides = "@myrepo//third-party/R:build_file_overrides.csv",
    package_list = "@myrepo//third-party/R:packages.csv",
    remote_repos = {
        "BioCsoft": "https://bioconductor.org/packages/3.14/bioc",
        "BioCann": "https://bioconductor.org/packages/3.14/data/annotation",
        "BioCexp": "https://bioconductor.org/packages/3.14/data/experiment",
        "CRAN": "https://cloud.r-project.org",
    },
)

load("@r_repositories_bzl//:r_repositories.bzl", "r_repositories")

r_repositories()
</code></pre></div>
<p dir="auto">The list of all external R packages configured this way can be obtained from
your shell with</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ bazel query 'filter(&quot;:R_&quot;, //external:*)'"><pre class="notranslate"><code>$ bazel query 'filter(":R_", //external:*)'
</code></pre></div>
<p dir="auto"><strong>NOTE</strong>: Periods ('.') in the package names are replaced with underscores
('_') because bazel does not allow periods in repository names.</p>
<p dir="auto">To generate and maintain a CSV file containing all your external dependencies
for use with <code>r_repository_list</code>, you can use the functions in the script
<code>repo_management.R</code>.</p>
<p dir="auto">For example:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="script=&quot;/path/to/rules_r/scripts/repo_management.R&quot;
package_list_csv=&quot;/path/to/output/csv/file&quot;
packages=&quot;comma-separated list of packages you want to add to the local cache&quot;
bioc_version=&quot;bioc_version to use, e.g. 3.11&quot;

# This will be the cache directory for a local copy of all the packages.
# The output CSV will always reflect the state of this directory.
local_r_repo=&quot;${HOME}/.cache/r-repo&quot;

Rscript - &lt;&lt;EOF
source('${script}')
pkgs &lt;- strsplit('${packages}', ',')[[1]]
# Set ForceDownload to TRUE when switching R or Bioc versions.
# options(&quot;ForceDownload&quot; = TRUE)
# Keep in sync with r_repository_list in WORKSPACE.
options(repos = c(
    BioCsoft = &quot;https://bioconductor.org/packages/${bioc_version}/bioc&quot;,
    BioCann = &quot;https://bioconductor.org/packages/${bioc_version}/data/annotation&quot;,
    BioCexp = &quot;https://bioconductor.org/packages/${bioc_version}/data/experiment&quot;,
    CRAN = &quot;https://cloud.r-project.org&quot;)
)
addPackagesToRepo(pkgs, repo_dir = '${local_r_repo}')
packageList('${local_r_repo}', '${package_list_csv}')
EOF"><pre>script=<span class="pl-s"><span class="pl-pds">"</span>/path/to/rules_r/scripts/repo_management.R<span class="pl-pds">"</span></span>
package_list_csv=<span class="pl-s"><span class="pl-pds">"</span>/path/to/output/csv/file<span class="pl-pds">"</span></span>
packages=<span class="pl-s"><span class="pl-pds">"</span>comma-separated list of packages you want to add to the local cache<span class="pl-pds">"</span></span>
bioc_version=<span class="pl-s"><span class="pl-pds">"</span>bioc_version to use, e.g. 3.11<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> This will be the cache directory for a local copy of all the packages.</span>
<span class="pl-c"><span class="pl-c">#</span> The output CSV will always reflect the state of this directory.</span>
local_r_repo=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">${HOME}</span>/.cache/r-repo<span class="pl-pds">"</span></span>

Rscript - <span class="pl-s"><span class="pl-k">&lt;&lt;</span><span class="pl-k">EOF</span></span>
<span class="pl-s">source('<span class="pl-smi">${script}</span>')</span>
<span class="pl-s">pkgs &lt;- strsplit('<span class="pl-smi">${packages}</span>', ',')[[1]]</span>
<span class="pl-s"># Set ForceDownload to TRUE when switching R or Bioc versions.</span>
<span class="pl-s"># options("ForceDownload" = TRUE)</span>
<span class="pl-s"># Keep in sync with r_repository_list in WORKSPACE.</span>
<span class="pl-s">options(repos = c(</span>
<span class="pl-s">    BioCsoft = "https://bioconductor.org/packages/<span class="pl-smi">${bioc_version}</span>/bioc",</span>
<span class="pl-s">    BioCann = "https://bioconductor.org/packages/<span class="pl-smi">${bioc_version}</span>/data/annotation",</span>
<span class="pl-s">    BioCexp = "https://bioconductor.org/packages/<span class="pl-smi">${bioc_version}</span>/data/experiment",</span>
<span class="pl-s">    CRAN = "https://cloud.r-project.org")</span>
<span class="pl-s">)</span>
<span class="pl-s">addPackagesToRepo(pkgs, repo_dir = '<span class="pl-smi">${local_r_repo}</span>')</span>
<span class="pl-s">packageList('<span class="pl-smi">${local_r_repo}</span>', '<span class="pl-smi">${package_list_csv}</span>')</span>
<span class="pl-s"><span class="pl-k">EOF</span></span></pre></div>
<p dir="auto"><a name="user-content-examples"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Examples</h2><a id="user-content-examples" class="anchor" aria-label="Permalink: Examples" href="#examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Some examples are available in the tests directory of this repo.</p>
<ul dir="auto">
<li>See <a href="tests/packages/exampleA">tests/packages/exampleA</a> for a barebones R package.</li>
<li>See <a href="tests/packages/exampleB">tests/packages/exampleB</a> for a barebones R package that depends on another package.</li>
<li>See <a href="tests/packages/exampleC">tests/packages/exampleC</a> for an R package that depends on external R packages and
user native code libraries.</li>
<li>See <a href="tests/packages/exampleD">tests/packages/exampleD</a> for an R package that depends on external R packages which
have been built with bazel provided native code libraries instead of a system requirement.</li>
</ul>
<p dir="auto">Also see <a href="scripts">Razel scripts</a> that provide utility functions to generate <code>BUILD</code> files
and <code>WORKSPACE</code> rules.</p>
<p dir="auto"><a name="user-content-contributing"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contributing</h2><a id="user-content-contributing" class="anchor" aria-label="Permalink: Contributing" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Contributions are most welcome. Please submit a pull request giving the owners
of this github repo access to your branch for minor style related edits, etc. We recommend
opening an issue first to discuss the nature of your change before beginning work on it.</p>
<p dir="auto"><a name="user-content-known-issues"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Known Issues</h2><a id="user-content-known-issues" class="anchor" aria-label="Permalink: Known Issues" href="#known-issues"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Please check open issues at the github repo.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Rules</h1><a id="user-content-rules-1" class="anchor" aria-label="Permalink: Rules" href="#rules-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a name="user-content-r_pkg"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_pkg</h2><a id="user-content-r_pkg" class="anchor" aria-label="Permalink: r_pkg" href="#r_pkg"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_pkg(srcs, pkg_name, deps, cc_deps, build_args, install_args, config_override,
      roclets, roclets_deps, makevars, env_vars, inst_files, tools, build_tools,
      metadata)"><pre><span class="pl-en">r_pkg</span>(<span class="pl-s1">srcs</span>, <span class="pl-s1">pkg_name</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">cc_deps</span>, <span class="pl-s1">build_args</span>, <span class="pl-s1">install_args</span>, <span class="pl-s1">config_override</span>,
      <span class="pl-s1">roclets</span>, <span class="pl-s1">roclets_deps</span>, <span class="pl-s1">makevars</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">inst_files</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">build_tools</span>,
      <span class="pl-s1">metadata</span>)</pre></div>
<p dir="auto">Rule to install the package and its transitive dependencies in the Bazel
sandbox, so it can be depended upon by other package builds.</p>
<p dir="auto">The builds produced from this rule are tested to be byte-for-byte reproducible
with the same R installation. For native code compilation, the compiler flags
for reproducibility are defined in the default site Makevars file in the local
toolchain. If using your own toolchain, ensure that your site Makevars file has
the right flags.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Implicit output targets</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code><i>name</i>.bin.tar.gz</code></td>
      <td>
        Binary archive of the package.
      </td>
    </tr>
    <tr>
      <td><code><i>name</i>.tar.gz</code></td>
      <td>
        Source archive of the package.
      </td>
    </tr>
    <tr>
      <td><code><i>name</i>.so</code></td>
      <td>
        Shared archive of package native code; empty file if package does not
        have native code.
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>srcs</code></td>
      <td>
        <p dir="auto"><code>List of files, required</code></p>
        <p dir="auto">Source files to be included for building the package.</p>
      </td>
    </tr>
    <tr>
      <td><code>pkg_name</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">Name of the package if different from the target name.</p>
      </td>
    </tr>
    <tr>
      <td><code>deps</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">R package dependencies of type `r_pkg` or `r_library`.</p>
      </td>
    </tr>
    <tr>
      <td><code>cc_deps</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">cc_library dependencies for this package.</p>
      </td>
    </tr>
    <tr>
      <td><code>build_args</code></td>
      <td>
        <p dir="auto"><code>List of strings; default ["--no-build-vignettes", "--no-manual"]</code></p>
        <p dir="auto">Additional arguments to supply to R CMD build. Note that building
           vignettes is disabled by default to not require Tex installation for
           users. In order to build vignettes, override this attribute, and ensure
           that the relevant binaries are available in your system default
           PATH (usually /usr/bin and /usr/local/bin)</p>
      </td>
    </tr>
    <tr>
      <td><code>install_args</code></td>
      <td>
        <p dir="auto"><code>List of strings; optional</code></p>
        <p dir="auto">Additional arguments to supply to R CMD INSTALL.</p>
      </td>
    </tr>
    <tr>
      <td><code>config_override</code></td>
      <td>
        <p dir="auto"><code>File; optional</code></p>
        <p dir="auto">Replace the package configure script with this file.</p>
      </td>
    </tr>
    <tr>
      <td><code>roclets</code></td>
      <td>
        <p dir="auto"><code>List of strings; optional</code></p>
        <p dir="auto">roclets to run before installing the package. If this is non-empty,
           then you must specify roclets_deps as the R package you want to
           use for running roclets. The runtime code will check if devtools
           is available and use `devtools::document`, failing which, it will
           check if roxygen2 is available and use `roxygen2::roxygenize`.</p>
      </td>
    </tr>
    <tr>
      <td><code>roclets_deps</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">roxygen2 or devtools dependency for running roclets.</p>
      </td>
    </tr>
    <tr>
      <td><code>makevars</code></td>
      <td>
        <p dir="auto"><code>File; optional</code></p>
        <p dir="auto">Additional Makevars file supplied as R_MAKEVARS_USER.</p>
      </td>
    </tr>
    <tr>
      <td><code>env_vars</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Extra environment variables to define for building the package.</p>
      </td>
    </tr>
    <tr>
      <td><code>inst_files</code></td>
      <td>
        <p dir="auto"><code>Label keyed Dictionary; optional</code></p>
        <p dir="auto">Files to be bundled with the package through the inst directory.
           The values of the dictionary will specify the package relative
           destination path. For example, '' will bundle the files to the top level
           directory, and 'mydir' will bundle all files into a directory mydir.</p>
      </td>
    </tr>
    <tr>
      <td><code>tools</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Executables that code in this package will try to find in the system.</p>
      </td>
    </tr>
    <tr>
      <td><code>build_tools</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Executables that native code compilation will try to find in the system.</p>
      </td>
    </tr>
    <tr>
      <td><code>metadata</code></td>
      <td>
        <p dir="auto"><code>String keyed Dictionary; optional</code></p>
        <p dir="auto">Metadata key-value pairs to add to the DESCRIPTION file before building.
           When text is enclosed within `{}`, bazel volatile and stable status
           files will be used to substitute the text. Inclusion of these files in
           the build has consequences on local and remote caching. Also see `stamp`.</p>
      </td>
    </tr>
    <tr>
      <td><code>stamp</code></td>
      <td>
        <p dir="auto"><code>Integer; default -1</code></p>
        <p dir="auto">Same behavior as the stamp attribute in cc_binary rule.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_library"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_library</h2><a id="user-content-r_library" class="anchor" aria-label="Permalink: r_library" href="#r_library"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_library(pkgs, library_path)"><pre><span class="pl-en">r_library</span>(<span class="pl-s1">pkgs</span>, <span class="pl-s1">library_path</span>)</pre></div>
<p dir="auto">Executable rule to install the given packages and all dependencies to a user
provided or system default R library. Run the target with --help for usage
information.</p>
<p dir="auto">The rule used to provide a tar archive of the library as an implicit output.
That feature is now it's own rule -- <code>r_library_tar</code>. See documentation for
<a href="R/internal/library.bzl">r_library_tar rule</a> and <a href="R/container/README.md">example</a> usage for
container_image rule.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>pkgs</code></td>
      <td>
        <p dir="auto"><code>List of labels, required</code></p>
        <p dir="auto">Package (and dependencies) to install.</p>
      </td>
    </tr>
    <tr>
      <td><code>library_path</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">If different from system default, default library location for installation.
        For runtime overrides, use bazel run [target] -- -l [path].</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_unit_test"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_unit_test</h2><a id="user-content-r_unit_test" class="anchor" aria-label="Permalink: r_unit_test" href="#r_unit_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_unit_test(pkg, suggested_deps, env_vars, tools, data)"><pre><span class="pl-en">r_unit_test</span>(<span class="pl-s1">pkg</span>, <span class="pl-s1">suggested_deps</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">data</span>)</pre></div>
<p dir="auto">Rule to keep all deps in the sandbox, and run the provided R test scripts.</p>
<p dir="auto">When run with <code>bazel coverage</code>, this rule will also produce a coverage report
in Cobertura XML format. The coverage report will contain coverage for R code
in the package, and C/C++ code in the <code>src</code> directory of R packages.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>pkg</code></td>
      <td>
        <p dir="auto"><code>Label; required</code></p>
        <p dir="auto">R package (of type r_pkg) to test.</p>
      </td>
    </tr>
    <tr>
      <td><code>suggested_deps</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">R package dependencies of type `r_pkg` or `r_library`.</p>
      </td>
    </tr>
    <tr>
      <td><code>env_vars</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Extra environment variables to define before running the test.</p>
      </td>
    </tr>
    <tr>
      <td><code>tools</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Executables to be made available to the test.</p>
      </td>
    </tr>
    <tr>
      <td><code>data</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Data to be made available to the test.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_pkg_test"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_pkg_test</h2><a id="user-content-r_pkg_test" class="anchor" aria-label="Permalink: r_pkg_test" href="#r_pkg_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_pkg_test(pkg, suggested_deps, check_args, env_vars, tools, data)"><pre><span class="pl-en">r_pkg_test</span>(<span class="pl-s1">pkg</span>, <span class="pl-s1">suggested_deps</span>, <span class="pl-s1">check_args</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">data</span>)</pre></div>
<p dir="auto">Rule to keep all deps of the package in the sandbox, build a source archive
of this package, and run R CMD check on the package source archive in the
sandbox.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>pkg</code></td>
      <td>
        <p dir="auto"><code>Label; required</code></p>
        <p dir="auto">R package (of type r_pkg) to test.</p>
      </td>
    </tr>
    <tr>
      <td><code>suggested_deps</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">R package dependencies of type `r_pkg` or `r_library`.</p>
      </td>
    </tr>
    <tr>
      <td><code>check_args</code></td>
      <td>
        <p dir="auto"><code>List of strings; default ["--no-build-vignettes, "--no-manual"]</code></p>
        <p dir="auto">Additional arguments to supply to R CMD build. Note that building
           vignettes is disabled by default to not require Tex installation for
           users. In order to build vignettes, override this attribute, and ensure
           that the relevant binaries are available in your system default
           PATH (usually /usr/bin and /usr/local/bin)</p>
      </td>
    </tr>
    <tr>
      <td><code>env_vars</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Extra environment variables to define before running the test.</p>
      </td>
    </tr>
    <tr>
      <td><code>tools</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Executables to be made available to the test.</p>
      </td>
    </tr>
    <tr>
      <td><code>data</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Data to be made available to the test.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_binary"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_binary</h2><a id="user-content-r_binary" class="anchor" aria-label="Permalink: r_binary" href="#r_binary"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_binary(name, src, deps, data, env_vars, tools, rscript_args, script_args)"><pre><span class="pl-en">r_binary</span>(<span class="pl-s1">name</span>, <span class="pl-s1">src</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">data</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">rscript_args</span>, <span class="pl-s1">script_args</span>)</pre></div>
<p dir="auto">Build a wrapper shell script for running an executable which will have all the
specified R packages available.</p>
<p dir="auto">The target can be executed standalone, with <code>bazel run</code>, or called from other
executables if <code>RUNFILES_DIR</code> is exported in the environment with
the runfiles of the root executable.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>src</code></td>
      <td>
        <p dir="auto"><code>File; required</code></p>
        <p dir="auto">An Rscript interpreted file, or file with executable permissions.</p>
      </td>
    </tr>
    <tr>
      <td><code>deps</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Dependencies of type <code>r_binary</code>, <code>r_pkg</code>,
           or <code>r_library</code>.</p>
      </td>
    </tr>
    <tr>
      <td><code>data</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Files needed by this rule at runtime.</p>
      </td>
    </tr>
    <tr>
      <td><code>env_vars</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Extra environment variables to define before running the binary.</p>
      </td>
    </tr>
    <tr>
      <td><code>tools</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Executables to be made available to the binary.</p>
      </td>
    </tr>
    <tr>
      <td><code>rscript_args</code></td>
      <td>
        <p dir="auto"><code>List of strings; optional</code></p>
        <p dir="auto">If src file does not have executable permissions, arguments for the
           Rscript interpreter. We recommend using the shebang line and giving
           your script execute permissions instead of using this.</p>
      </td>
    </tr>
    <tr>
      <td><code>script_args</code></td>
      <td>
        <p dir="auto"><code>List of strings; optional</code></p>
        <p dir="auto">A list of arguments to pass to the src script.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_test"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_test</h2><a id="user-content-r_test" class="anchor" aria-label="Permalink: r_test" href="#r_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_test(name, src, deps, data, env_vars, tools, rscript_args, script_args)"><pre><span class="pl-en">r_test</span>(<span class="pl-s1">name</span>, <span class="pl-s1">src</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">data</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">rscript_args</span>, <span class="pl-s1">script_args</span>)</pre></div>
<p dir="auto">This is identical to <a href="#r_binary">r_binary</a> but is run as a test.</p>
<p dir="auto"><a name="user-content-r_markdown"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_markdown</h2><a id="user-content-r_markdown" class="anchor" aria-label="Permalink: r_markdown" href="#r_markdown"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_markdown(name, src, deps, data, env_vars, tools, rscript_args, script_args,
render_function=&quot;rmarkdown::render&quot;, input_argument=&quot;input&quot;, output_dir_argument=&quot;output_dir&quot;,
render_args)"><pre><span class="pl-en">r_markdown</span>(<span class="pl-s1">name</span>, <span class="pl-s1">src</span>, <span class="pl-s1">deps</span>, <span class="pl-s1">data</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">rscript_args</span>, <span class="pl-s1">script_args</span>,
<span class="pl-s1">render_function</span><span class="pl-c1">=</span><span class="pl-s">"rmarkdown::render"</span>, <span class="pl-s1">input_argument</span><span class="pl-c1">=</span><span class="pl-s">"input"</span>, <span class="pl-s1">output_dir_argument</span><span class="pl-c1">=</span><span class="pl-s">"output_dir"</span>,
<span class="pl-s1">render_args</span>)</pre></div>
<p dir="auto">This rule renders an R markdown through generating a stub to call the render
function. The render function and the argument names for the function are
default set for <code>rmarkdown::render</code> but can be customized. Note that
<code>render_args</code> will need to be quoted appropriately if set. This rule can be
used wherever an <a href="#r_binary">r_binary</a> rule can be used.</p>
<p dir="auto">If arguments are given on the command line when running the target, flags of
the form --arg=value are passed as keyword arguments to the render
function. The values can be arbitrary R expressions, and strings will need to
be quoted. The last argument without the prefix <code>--</code> will be the output
directory, else the output directory will be the default output
directory of the render function, typically the same directory as the input
file.</p>
<p dir="auto"><a name="user-content-r_toolchain"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_toolchain</h2><a id="user-content-r_toolchain" class="anchor" aria-label="Permalink: r_toolchain" href="#r_toolchain"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_toolchain(r, rscript, version, args, makevars_site, env_vars, tools, files, system_state_file)"><pre><span class="pl-en">r_toolchain</span>(<span class="pl-s1">r</span>, <span class="pl-s1">rscript</span>, <span class="pl-s1">version</span>, <span class="pl-s1">args</span>, <span class="pl-s1">makevars_site</span>, <span class="pl-s1">env_vars</span>, <span class="pl-s1">tools</span>, <span class="pl-s1">files</span>, <span class="pl-s1">system_state_file</span>)</pre></div>
<p dir="auto">Toolchain to specify the tools and environment for performing build actions.
Also see <a href="#r_register_toolchains">r_register_toolchains</a> for how
to configure the default registered toolchains.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>r</code></td>
      <td>
        <p dir="auto"><code>String; default R</code></p>
        <p dir="auto">Absolute path to R, or name of R executable; the search path will include the directories for tools attribute.</p>
      </td>
    </tr>
    <tr>
      <td><code>rscript</code></td>
      <td>
        <p dir="auto"><code>String; default Rscript</code></p>
        <p dir="auto">Absolute path to Rscript, or name of Rscript executable; the search path will include the directories for tools attribute.</p>
      </td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">If provided, ensure version of R matches this string in x.y form. This version check is
           performed in the `r_pkg` and `r_binary` (and by extension, `r_test` and `r_markdown`)
           rules. For stronger guarantees, perform this version check when generating the
           `system_state_file` (see attribute below).</p>
      </td>
    </tr>
    <tr>
      <td><code>args</code></td>
      <td>
        <p dir="auto"><code>List of strings; default ["--no-save", "--no-site-file", "--no-environ"]</code></p>
        <p dir="auto">Arguments to R and Rscript, in addition to `--slave --no-restore --no-init-file`.</p>
      </td>
    </tr>
    <tr>
      <td><code>makevars_site</code></td>
      <td>
        <p dir="auto"><code>Label; optional</code></p>
        <p dir="auto">Site-wide Makevars file.</p>
      </td>
    </tr>
    <tr>
      <td><code>env_vars</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Environment variables for BUILD actions.</p>
      </td>
    </tr>
    <tr>
      <td><code>tools</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Additional tools to make available in PATH.</p>
      </td>
    </tr>
    <tr>
      <td><code>files</code></td>
      <td>
        <p dir="auto"><code>List of labels; optional</code></p>
        <p dir="auto">Additional files available to the BUILD actions.</p>
      </td>
    </tr>
    <tr>
      <td><code>system_state_file</code></td>
      <td>
        <p dir="auto"><code>Label; optional</code></p>
        <p dir="auto">A file that captures your system state. Use it to rebuild all R packages whenever the
           contents of this file change. This is ideally generated by a repository_rule with
           `configure = True`, so that a call to `bazel sync --configure` resets this file.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Repository Rules</h1><a id="user-content-repository-rules-1" class="anchor" aria-label="Permalink: Repository Rules" href="#repository-rules-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a name="user-content-r_repository"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_repository</h2><a id="user-content-r_repository" class="anchor" aria-label="Permalink: r_repository" href="#r_repository"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_repository(urls, strip_prefix, type, sha256, build_file, rscript)"><pre><span class="pl-en">r_repository</span>(<span class="pl-s1">urls</span>, <span class="pl-s1">strip_prefix</span>, <span class="pl-s1">type</span>, <span class="pl-s1">sha256</span>, <span class="pl-s1">build_file</span>, <span class="pl-s1">rscript</span>)</pre></div>
<p dir="auto">Repository rule in place of <code>new_http_archive</code> that can run razel to generate
the BUILD file automatically. See section on
<a href="#external-packages">external packages</a> and <a href="scripts">Razel scripts</a>.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>urls</code></td>
      <td>
        <p dir="auto"><code>List of strings; required</code></p>
        <p dir="auto">URLs from which the package source archive can be fetched.</p>
      </td>
    </tr>
    <tr>
      <td><code>strip_prefix</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">The prefix to strip from all file paths in the archive.</p>
      </td>
    </tr>
    <tr>
      <td><code>type</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">Type of the archive file (zip, tgz, etc.).</p>
      </td>
    </tr>
    <tr>
      <td><code>sha256</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">sha256 checksum of the archive to verify.</p>
      </td>
    </tr>
    <tr>
      <td><code>build_file</code></td>
      <td>
        <p dir="auto"><code>File; optional</code></p>
        <p dir="auto">Optional BUILD file for this repo. If not provided, one will be generated.</p>
      </td>
    </tr>
    <tr>
      <td><code>razel_args</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Other arguments to supply to buildify function in razel.</p>
      </td>
    </tr>
    <tr>
      <td><code>rscript</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">Name, path or label (must start with `@` or `//`) of the interpreter to use
           for running the razel script.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_repository_list"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_repository_list</h2><a id="user-content-r_repository_list" class="anchor" aria-label="Permalink: r_repository_list" href="#r_repository_list"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="r_repository_list(package_list, build_file_overrides, remote_repos, other_args, rscript)"><pre><span class="pl-en">r_repository_list</span>(<span class="pl-s1">package_list</span>, <span class="pl-s1">build_file_overrides</span>, <span class="pl-s1">remote_repos</span>, <span class="pl-s1">other_args</span>, <span class="pl-s1">rscript</span>)</pre></div>
<p dir="auto">Repository rule that will generate a bzl file containing a macro, to be called
as <code>r_repositories()</code>, for <code>r_repository</code> definitions for packages in
<code>package_list</code> CSV. See section on <a href="#external-packages">external packages</a>.</p>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>package_list</code></td>
      <td>
        <p dir="auto"><code>File; required</code></p>
        <p dir="auto">CSV containing packages with name, version and sha256; with a header.</p>
      </td>
    </tr>
    <tr>
      <td><code>build_file_overrides</code></td>
      <td>
        <p dir="auto"><code>File; optional</code></p>
        <p dir="auto">CSV containing package name and BUILD file path; with a header.</p>
      </td>
    </tr>
    <tr>
      <td><code>remote_repos</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Repos to use for fetching the archives.</p>
      </td>
    </tr>
    <tr>
      <td><code>other_args</code></td>
      <td>
        <p dir="auto"><code>Dictionary; optional</code></p>
        <p dir="auto">Other arguments to supply to generateWorkspaceMacro function in razel.</p>
      </td>
    </tr>
    <tr>
      <td><code>rscript</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">Name, path or label (must start with `@` or `//`) of the interpreter to use
           for running the razel script.</p>
      </td>
    </tr>
    <tr>
      <td><code>r_version</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">If provided, ensure version of R matches this string in x.y form.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><a name="user-content-r_rules_dependencies"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_rules_dependencies</h2><a id="user-content-r_rules_dependencies" class="anchor" aria-label="Permalink: r_rules_dependencies" href="#r_rules_dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_r//R:dependencies.bzl&quot;, &quot;r_rules_dependencies&quot;)

r_rules_dependencies()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_r//R:dependencies.bzl"</span>, <span class="pl-s">"r_rules_dependencies"</span>)

<span class="pl-en">r_rules_dependencies</span>()</pre></div>
<p dir="auto">Repository rule that provides repository definitions for dependencies of the
BUILD system. One such dependency is the site-wide Makevars file.</p>
<p dir="auto"><a name="user-content-r_coverage_dependencies"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_coverage_dependencies</h2><a id="user-content-r_coverage_dependencies" class="anchor" aria-label="Permalink: r_coverage_dependencies" href="#r_coverage_dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_r//R:dependencies.bzl&quot;, &quot;r_coverage_dependencies&quot;)

r_coverage_dependencies()

load(&quot;@r_coverage_deps_bzl//:r_repositories.bzl&quot;, coverage_deps = &quot;r_repositories&quot;)

coverage_deps()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_r//R:dependencies.bzl"</span>, <span class="pl-s">"r_coverage_dependencies"</span>)

<span class="pl-en">r_coverage_dependencies</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@r_coverage_deps_bzl//:r_repositories.bzl"</span>, <span class="pl-s1">coverage_deps</span> <span class="pl-c1">=</span> <span class="pl-s">"r_repositories"</span>)

<span class="pl-en">coverage_deps</span>()</pre></div>
<p dir="auto">Repository rule that provides repository definitions for dependencies in
computing code coverage for unit tests. Not needed if users already have
a repository definition for the <a href="https://github.com/r-lib/covr">covr</a> package.</p>
<p dir="auto"><a name="user-content-r_register_toolchains"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">r_register_toolchains</h2><a id="user-content-r_register_toolchains" class="anchor" aria-label="Permalink: r_register_toolchains" href="#r_register_toolchains"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_r//R:dependencies.bzl&quot;, &quot;r_register_toolchains&quot;)

r_register_toolchains(r_home, strict, makevars_site, version, args, tools)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_r//R:dependencies.bzl"</span>, <span class="pl-s">"r_register_toolchains"</span>)

<span class="pl-en">r_register_toolchains</span>(<span class="pl-s1">r_home</span>, <span class="pl-s1">strict</span>, <span class="pl-s1">makevars_site</span>, <span class="pl-s1">version</span>, <span class="pl-s1">args</span>, <span class="pl-s1">tools</span>)</pre></div>
<p dir="auto">Repository rule that generates and registers a platform independent toolchain
of type <a href="#r_toolchain">r_toolchain</a> based on the user's system and
environment. If you want to register your own toolchain for specific platforms,
register them before calling this function in your WORKSPACE file to give them
preference.</p>
<p dir="auto"><strong>NOTE</strong>: These toolchains read your system state and cache the findings for
future runs. Whenever you install a new R version, or if you want to reset the
toolchain for any reason, run:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel sync --configure"><pre>bazel sync --configure</pre></div>
<markdown-accessiblity-table><table>
  
    
    
  
  <thead>
    <tr>
      <th colspan="2">Attributes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>r_home</code></td>
      <td>
        <p dir="auto"><code>String, optional</code></p>
        <p dir="auto">A path to `R_HOME` (as returned from `R RHOME`). If not specified,
           the rule looks for R and Rscript in `PATH`. The environment variable
           `BAZEL_R_HOME` takes precendence over this value.</p>
      </td>
    </tr>
    <tr>
      <td><code>strict</code></td>
      <td>
        <p dir="auto"><code>Bool; default True</code></p>
        <p dir="auto">Fail if R is not found on the host system.</p>
      </td>
    </tr>
    <tr>
      <td><code>makevars_site</code></td>
      <td>
        <p dir="auto"><code>Bool; default True</code></p>
        <p dir="auto">Generate a site-wide Makevars file.</p>
      </td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>
        <p dir="auto"><code>String; optional</code></p>
        <p dir="auto">version attribute value for r_toolchain.</p>
      </td>
    </tr>
    <tr>
      <td><code>args</code></td>
      <td>
        <p dir="auto"><code>List of strings; default ["--no-save", "--no-site-file", "--no-environ"]</code></p>
        <p dir="auto">args attribute value for r_toolchain.</p>
      </td>
    </tr>
    <tr>
      <td><code>tools</code></td>
      <td>
        <p dir="auto"><code>List of strings; optional</code></p>
        <p dir="auto">tools attribute value for r_toolchain.</p>
      </td>
    </tr>
  </tbody>
</table></markdown-accessiblity-table>
</article></div>