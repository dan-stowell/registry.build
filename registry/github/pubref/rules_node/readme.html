<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><markdown-accessiblity-table><table><tbody><tr>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/698997ec666df8e94ad0e75e11d592faf9af9f1a94ed321091cb80324966761f/68747470733a2f2f62617a656c2e6275696c642f696d616765732f62617a656c2d69636f6e2e737667"><img src="https://camo.githubusercontent.com/698997ec666df8e94ad0e75e11d592faf9af9f1a94ed321091cb80324966761f/68747470733a2f2f62617a656c2e6275696c642f696d616765732f62617a656c2d69636f6e2e737667" height="120" data-canonical-src="https://bazel.build/images/bazel-icon.svg" style="max-width: 100%;"></a></td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/a31757ade2dceba533090fd771e9476f831735ff858babaef1dbbddfcb9c3c4c/68747470733a2f2f6e6f64656a732e6f72672f7374617469632f696d616765732f6c6f676f2e737667"><img src="https://camo.githubusercontent.com/a31757ade2dceba533090fd771e9476f831735ff858babaef1dbbddfcb9c3c4c/68747470733a2f2f6e6f64656a732e6f72672f7374617469632f696d616765732f6c6f676f2e737667" height="120" data-canonical-src="https://nodejs.org/static/images/logo.svg" style="max-width: 100%;"></a></td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/2daa1c6c77eb75c54bfab57691417bb2b5dcf224aea3c3fbf2c620e66edb218e/68747470733a2f2f7961726e706b672e636f6d2f6173736574732f666561747572652d73706565642e706e67"><img src="https://camo.githubusercontent.com/2daa1c6c77eb75c54bfab57691417bb2b5dcf224aea3c3fbf2c620e66edb218e/68747470733a2f2f7961726e706b672e636f6d2f6173736574732f666561747572652d73706565642e706e67" height="120" data-canonical-src="https://yarnpkg.com/assets/feature-speed.png" style="max-width: 100%;"></a></td>
</tr><tr>
<td>Bazel</td>
<td>NodeJs</td>
<td>Yarn</td>
</tr></tbody></table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto"><code>rules_node</code> <a href="https://travis-ci.org/pubref/rules_node" rel="nofollow"><img src="https://camo.githubusercontent.com/55ed9930f708057a47aa6333cf74522bcbe142a5079e01785ec80061075076c6/68747470733a2f2f7472617669732d63692e6f72672f7075627265662f72756c65735f6e6f64652e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/pubref/rules_node.svg?branch=master" style="max-width: 100%;"></a></h1><a id="user-content-rules_node-" class="anchor" aria-label="Permalink: rules_node" href="#rules_node-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Rules</h1><a id="user-content-rules" class="anchor" aria-label="Permalink: Rules" href="#rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="right">Rule</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right"><a href="#node_repositories">node_repositories</a></td>
<td align="left">Install node toolchain.</td>
</tr>
<tr>
<td align="right"><a href="#yarn_modules">yarn_modules</a></td>
<td align="left">Install a set node module dependencies using yarn.</td>
</tr>
<tr>
<td align="right"><a href="#node_module">node_module</a></td>
<td align="left">Define a node module from a set of source files (having an optional main (or index) entry point).</td>
</tr>
<tr>
<td align="right"><a href="#node_binary">node_binary</a></td>
<td align="left">Run a node module.</td>
</tr>
<tr>
<td align="right"><a href="#node_test">node_test</a></td>
<td align="left">Run a node binary as a bazel test.</td>
</tr>
<tr>
<td align="right"><a href="#mocha_test">mocha_test</a></td>
<td align="left">Run a mocha test script.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<markdown-accessiblity-table><table><tbody><tr>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/4672930da520cc1cf19efe3bbfced02f2297543c61262054e7571d156c1a28a3/68747470733a2f2f7777772e6b65726e656c2e6f72672f7468656d652f696d616765732f6c6f676f732f7475782e706e67"><img src="https://camo.githubusercontent.com/4672930da520cc1cf19efe3bbfced02f2297543c61262054e7571d156c1a28a3/68747470733a2f2f7777772e6b65726e656c2e6f72672f7468656d652f696d616765732f6c6f676f732f7475782e706e67" height="48" data-canonical-src="https://www.kernel.org/theme/images/logos/tux.png" style="max-width: 100%;"></a></td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/b40fd093a67efc4894272a69d4314a2804619b719a89984f347fec25c9f43010/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f662f66612f4170706c655f6c6f676f5f626c61636b2e737667"><img src="https://camo.githubusercontent.com/b40fd093a67efc4894272a69d4314a2804619b719a89984f347fec25c9f43010/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f662f66612f4170706c655f6c6f676f5f626c61636b2e737667" height="48" data-canonical-src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg" style="max-width: 100%;"></a></td>
<td><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/49aa08b1bfe4b51f5f88bc99e62ed7beddf983507a68eee1890dbb21ec352e30/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f352f35662f57696e646f77735f6c6f676f5f2d5f323031322e737667"><img src="https://camo.githubusercontent.com/49aa08b1bfe4b51f5f88bc99e62ed7beddf983507a68eee1890dbb21ec352e30/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f352f35662f57696e646f77735f6c6f676f5f2d5f323031322e737667" height="48" data-canonical-src="https://upload.wikimedia.org/wikipedia/commons/5/5f/Windows_logo_-_2012.svg" style="max-width: 100%;"></a></td>
</tr></tbody></table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">node_repositories</h2><a id="user-content-node_repositories" class="anchor" aria-label="Permalink: node_repositories" href="#node_repositories"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">WORKSPACE rule that downloads and configures node based on your
operating system.  Includes <code>node</code> (8.15.1) and <code>yarn</code> (1.0.1).</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="RULES_NODE_COMMIT = '...' # Update to current HEAD
RULES_NODE_SHA256 = '...'

http_archive(
    name = &quot;org_pubref_rules_node&quot;,
    url = &quot;https://github.com/pubref/rules_node/archive/%s.zip&quot; % RULES_NODE_COMMIT,
    strip_prefix = &quot;rules_node-%s&quot; % RULES_NODE_COMMIT,
    sha256 = RULES_NODE_SHA256,
)

load(&quot;@org_pubref_rules_node//node:rules.bzl&quot;, &quot;node_repositories&quot;)

node_repositories()"><pre><span class="pl-c1">RULES_NODE_COMMIT</span> <span class="pl-c1">=</span> <span class="pl-s">'...'</span> <span class="pl-c"># Update to current HEAD</span>
<span class="pl-v">RULES_NODE_SHA256</span> <span class="pl-c1">=</span> <span class="pl-s">'...'</span>

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"org_pubref_rules_node"</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/pubref/rules_node/archive/%s.zip"</span> <span class="pl-c1">%</span> <span class="pl-c1">RULES_NODE_COMMIT</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_node-%s"</span> <span class="pl-c1">%</span> <span class="pl-c1">RULES_NODE_COMMIT</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-v">RULES_NODE_SHA256</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@org_pubref_rules_node//node:rules.bzl"</span>, <span class="pl-s">"node_repositories"</span>)

<span class="pl-en">node_repositories</span>()</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">yarn_modules</h2><a id="user-content-yarn_modules" class="anchor" aria-label="Permalink: yarn_modules" href="#yarn_modules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Install a set of module dependencies into a <code>yarn_modules</code> folder as
an external workspace.  Requires either a <code>package.json</code> file or
<code>deps</code> as input.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# In WORKSPACE
load(&quot;@org_pubref_rules_node//node:rules.bzl&quot;, &quot;yarn_modules&quot;)

# Use a package.json file as input. Location of the package json
# is arbitrary.
yarn_modules(
    name = &quot;yarn_modules&quot;,
    package_json = &quot;//:package.json&quot;,
)

# Shortcut form without a separate package.json file
yarn_modules(
    name = &quot;yarn_modules&quot;,
    deps = {
        &quot;react&quot;: &quot;15.3.2&quot;,
        &quot;react-dom&quot;: &quot;15.3.2&quot;,
    },
)"><pre><span class="pl-c"># In WORKSPACE</span>
<span class="pl-en">load</span>(<span class="pl-s">"@org_pubref_rules_node//node:rules.bzl"</span>, <span class="pl-s">"yarn_modules"</span>)

<span class="pl-c"># Use a package.json file as input. Location of the package json</span>
<span class="pl-c"># is arbitrary.</span>
<span class="pl-en">yarn_modules</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"yarn_modules"</span>,
    <span class="pl-s1">package_json</span> <span class="pl-c1">=</span> <span class="pl-s">"//:package.json"</span>,
)

<span class="pl-c"># Shortcut form without a separate package.json file</span>
<span class="pl-en">yarn_modules</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"yarn_modules"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"react"</span>: <span class="pl-s">"15.3.2"</span>,
        <span class="pl-s">"react-dom"</span>: <span class="pl-s">"15.3.2"</span>,
    },
)</pre></div>
<p dir="auto">How It Works:</p>
<ol dir="auto">
<li>
<p dir="auto">Create an external workspace <code>@yarn_modules</code> at <code>$(bazel info output_base)/external/yarn_modules</code>.</p>
</li>
<li>
<p dir="auto">Invoke <code>yarn install</code> to create a <code>node_modules</code> folder and
populate it with the necessary dependencies.</p>
</li>
<li>
<p dir="auto">Read the generated <code>yarn.lock</code> file, parse it, and write out a
<code>@yarn_modules//:BUILD</code> file.  This file contains a <code>node_module</code>
rule foreach entry in the <code>yarn.lock</code> file, a <code>node_module</code> rule
with the special name <code>_all_</code>, and a <code>node_binary</code> rule foreach
executable script in the <code>node_modules/.bin</code> folder.</p>
</li>
</ol>
<blockquote>
<p dir="auto">Note 1: You can inspect all the targets by running <code>bazel query @yarn_modules//:*</code>.</p>
</blockquote>
<blockquote>
<p dir="auto">Note 2: The workspace name <code>yarn_modules</code> is arbitrary, choose
whatever you like (<em>other than</em> <code>node_modules</code> itself, that one
doesn't work).</p>
</blockquote>
<p dir="auto">At this point you can use these rule targets as <code>deps</code> for your
<code>node_module</code> rules.  <em>Example</em>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_module(
    name = &quot;my_module&quot;,
    package_json = &quot;package.json&quot;,
    srcs = glob([&quot;**/*.js&quot;]),
    deps = [
        &quot;@yarn_modules//:_all_&quot;,
    ],
)"><pre><span class="pl-en">node_module</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_module"</span>,
    <span class="pl-s1">package_json</span> <span class="pl-c1">=</span> <span class="pl-s">"package.json"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"**/*.js"</span>]),
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@yarn_modules//:_all_"</span>,
    ],
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">yarn_module attributes</h3><a id="user-content-yarn_module-attributes" class="anchor" aria-label="Permalink: yarn_module attributes" href="#yarn_module-attributes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th>Type</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>optional</td>
<td><code>label</code></td>
<td><code>package_json</code></td>
<td>A <code>package.json</code> file containing the dependencies that should be installed.</td>
</tr>
<tr>
<td>optional</td>
<td><code>string_dict</code></td>
<td><code>deps</code></td>
<td>A mapping of <code>name</code> --&gt; <code>version</code> for the dependencies that should be installed.</td>
</tr>
<tr>
<td>optional</td>
<td><code>string_list</code></td>
<td><code>post_install</code></td>
<td>A list of command-line arguments that should be invoked after the <code>yarn install</code> step.  See <a href="https://github.com/pubref/rules_node/issues/55" data-hovercard-type="issue" data-hovercard-url="/pubref/rules_node/issues/55/hovercard">#55</a>.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<blockquote>
<p dir="auto">Either <code>package_json</code> or <code>deps</code> must be present, but not both.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">node_module</h2><a id="user-content-node_module" class="anchor" aria-label="Permalink: node_module" href="#node_module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">BUILD file rule that creates a folder which conforms to the nodejs
<a href="https://nodejs.org/api/modules.html#modules_folders_as_modules" rel="nofollow">Folders as Modules</a>
packaging structure.  <em>Example</em>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_module(
    name = &quot;my_module&quot;,
    main = &quot;index.js&quot;,
    srcs = [
        &quot;lib/util.js&quot;,
        &quot;lib/math.js&quot;,
    ],
    version = &quot;1.2.0&quot;,
    description = &quot;Example node module&quot;,
    deps = [
        &quot;@yarn_modules//:lodash&quot;,
        &quot;@yarn_modules//:fs-extra&quot;,
    ],"><pre><span class="pl-s1">node_module</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_module"</span>,
    <span class="pl-s1">main</span> <span class="pl-c1">=</span> <span class="pl-s">"index.js"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"lib/util.js"</span>,
        <span class="pl-s">"lib/math.js"</span>,
    ],
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.2.0"</span>,
    <span class="pl-s1">description</span> <span class="pl-c1">=</span> <span class="pl-s">"Example node module"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@yarn_modules//:lodash"</span>,
        <span class="pl-s">"@yarn_modules//:fs-extra"</span>,
    ],</pre></div>
<p dir="auto">When used in a <code>node_binary</code> rule, this ultimately materializes to:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="node_modules/my_module
node_modules/my_module/package.json
node_modules/my_module/index.js
node_modules/my_module/lib/util.js
node_modules/my_module/lib/math.js
node_modules/lodash
node_modules/fs-extra"><pre class="notranslate"><code>node_modules/my_module
node_modules/my_module/package.json
node_modules/my_module/index.js
node_modules/my_module/lib/util.js
node_modules/my_module/lib/math.js
node_modules/lodash
node_modules/fs-extra
</code></pre></div>
<p dir="auto">When used by other <code>node_module</code> rules, you can import the module as:</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="const myModule = require(&quot;my_module&quot;);"><pre><span class="pl-k">const</span> <span class="pl-s1">myModule</span> <span class="pl-c1">=</span> <span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">"my_module"</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<p dir="auto">There are three basic ways to create a <code>node_module</code> rule:</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1. Creating a <code>node_module</code> with a <code>package.json</code> file</h3><a id="user-content-1-creating-a-node_module-with-a-packagejson-file" class="anchor" aria-label="Permalink: 1. Creating a node_module with a package.json file" href="#1-creating-a-node_module-with-a-packagejson-file"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_module(
    name = &quot;my_module_1&quot;,
    package_json = &quot;package.json&quot;, # label to the 'package.json' file to use directly
)"><pre><span class="pl-en">node_module</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_module_1"</span>,
    <span class="pl-s1">package_json</span> <span class="pl-c1">=</span> <span class="pl-s">"package.json"</span>, <span class="pl-c"># label to the 'package.json' file to use directly</span>
)</pre></div>
<p dir="auto">In this scenario, assumes the package.json file has an entry that
specifies the <code>main</code> entrypoint (or not, if you follow the
<a href="https://nodejs.org/api/modules.html#modules_file_modules" rel="nofollow">Files as Modules</a>
pattern).</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">2. Creating a <code>node_module</code> with a label to the <code>main</code> entrypoint source file</h3><a id="user-content-2-creating-a-node_module-with-a-label-to-the-main-entrypoint-source-file" class="anchor" aria-label="Permalink: 2. Creating a node_module with a label to the main entrypoint source file" href="#2-creating-a-node_module-with-a-label-to-the-main-entrypoint-source-file"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_module(
    name = &quot;my_module_2&quot;,
    main = &quot;app.js&quot;, # label to the entrypoint file for the module
    version = &quot;1.0.0&quot;, # optional arguments to populate the generated package.json file
    ...
)"><pre><span class="pl-en">node_module</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_module_2"</span>,
    <span class="pl-s1">main</span> <span class="pl-c1">=</span> <span class="pl-s">"app.js"</span>, <span class="pl-c"># label to the entrypoint file for the module</span>
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.0.0"</span>, <span class="pl-c"># optional arguments to populate the generated package.json file</span>
    ...
)</pre></div>
<p dir="auto">In this scenario, a <code>package.json</code> file will be generated for the
module that specifies the file you provide to the <code>main</code> attribute.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">3. Creating a <code>node_module</code> with a label to the <code>index.js</code> entrypoint source file</h3><a id="user-content-3-creating-a-node_module-with-a-label-to-the-indexjs-entrypoint-source-file" class="anchor" aria-label="Permalink: 3. Creating a node_module with a label to the index.js entrypoint source file" href="#3-creating-a-node_module-with-a-label-to-the-indexjs-entrypoint-source-file"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_module(
    name = &quot;my_module_3&quot;,
    index = &quot;index.js&quot;, # label to the 'index.js' file to use as the index
)"><pre><span class="pl-en">node_module</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_module_3"</span>,
    <span class="pl-s1">index</span> <span class="pl-c1">=</span> <span class="pl-s">"index.js"</span>, <span class="pl-c"># label to the 'index.js' file to use as the index</span>
)</pre></div>
<blockquote>
<p dir="auto">In this scenario, no <code>package.json</code> file is generated.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Module dependencies</h3><a id="user-content-module-dependencies" class="anchor" aria-label="Permalink: Module dependencies" href="#module-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Build up a dependency tree via the <code>deps</code> attribute:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="node_module(
    name = &quot;my_module_3&quot;,
    ...
    deps = [
        &quot;@yarn_modules//:_all_&quot;, # special token '_all_' to have access to all modules
        &quot;:my_module_1&quot;,
    ],
)"><pre class="notranslate"><code>node_module(
    name = "my_module_3",
    ...
    deps = [
        "@yarn_modules//:_all_", # special token '_all_' to have access to all modules
        ":my_module_1",
    ],
)
</code></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Core node_module attributes</h3><a id="user-content-core-node_module-attributes" class="anchor" aria-label="Permalink: Core node_module attributes" href="#core-node_module-attributes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">optional</td>
<td align="left"><code>label</code></td>
<td align="left"><code>package_json</code></td>
<td align="left"><code>None</code></td>
<td align="left">Explicitly name a <code>package.json</code> file to use for the module.</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>label</code></td>
<td align="left"><code>main</code></td>
<td align="left"><code>None</code></td>
<td align="left">Source file named in the generated package.json <code>main</code> property.</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>label</code></td>
<td align="left"><code>index</code></td>
<td align="left"><code>None</code></td>
<td align="left">Source file to be used as the index file (supresses generation of a <code>package.json</code> file).</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>label_list</code></td>
<td align="left"><code>srcs</code></td>
<td align="left"><code>[]</code></td>
<td align="left">Source files to be included in the module.</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>label_list</code></td>
<td align="left"><code>deps</code></td>
<td align="left"><code>[]</code></td>
<td align="left"><code>node_module</code> rule dependencies.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">node_module attributes that affect the name of the module</h3><a id="user-content-node_module-attributes-that-affect-the-name-of-the-module" class="anchor" aria-label="Permalink: node_module attributes that affect the name of the module" href="#node_module-attributes-that-affect-the-name-of-the-module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For reference, by default a <code>node_module</code> rule <code>//src/js:my_module</code>
generates <code>node_modules/src/js/my_module</code>.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>namespace</code></td>
<td align="left"><code>None</code></td>
<td align="left">See <sup>1</sup></td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>module_name</code></td>
<td align="left"><code>${ctx.label.package}/{ctx.label.name}</code></td>
<td align="left">See <sup>2</sup></td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>separator</code></td>
<td align="left"><code>/</code></td>
<td align="left">See <sup>3</sup></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><sup>1</sup> Use to scope the module with some organization prefix.  <em>Example</em>: <code>namespace = '@foo'</code> generates <code>node_modules/@foo/src/js/my_module</code>.</p>
<p dir="auto"><sup>2</sup> Override the module name.  <em>Example</em>: <code>name = 'barbaz'</code> with namespace (above) generates <code>node_modules/@foo/barbaz</code></p>
<p dir="auto"><sup>3</sup> <em>Example</em>: <code>separator = '-'</code> generates <code>node_modules/src-js-my_module</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">node_module attributes that affect the generated <code>package.json</code></h3><a id="user-content-node_module-attributes-that-affect-the-generated-packagejson" class="anchor" aria-label="Permalink: node_module attributes that affect the generated package.json" href="#node_module-attributes-that-affect-the-generated-packagejson"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">These are only relevant if you don't explicitly name a <code>package.json</code> file.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>version</code></td>
<td align="left"><code>1.0.0</code></td>
<td align="left">Version string</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>url</code></td>
<td align="left"><code>None</code></td>
<td align="left">Url where the module tgz archive was resolved</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>sha1</code></td>
<td align="left"><code>None</code></td>
<td align="left">Sha1 hash of of the resolved tgz archive</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>description</code></td>
<td align="left"><code>None</code></td>
<td align="left">Module description</td>
</tr>
<tr>
<td align="right">optional</td>
<td align="left"><code>string_dict</code></td>
<td align="left"><code>executables</code></td>
<td align="left"><code>None</code></td>
<td align="left">A mapping from binary name to internal node module path.  Example <code>executables = { 'foo': 'bin/foo' }</code>.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">node_module attributes that affect the relative path of files included in the module</h3><a id="user-content-node_module-attributes-that-affect-the-relative-path-of-files-included-in-the-module" class="anchor" aria-label="Permalink: node_module attributes that affect the relative path of files included in the module" href="#node_module-attributes-that-affect-the-relative-path-of-files-included-in-the-module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="right"></th>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">optional</td>
<td align="left"><code>string</code></td>
<td align="left"><code>layout</code></td>
<td align="left"><code>relative</code></td>
<td align="left">Changes the way files are included in the module.  One of <code>relative</code> or <code>workspace</code>.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Consider a file with the label <code>//src/js/my_module/app.js</code>.  With
<code>layout = 'relative'</code> (the default), the location of the file becomes
<code>node_modules/src/js/my_module/app.js</code> (skylark: <code>file.short_path</code>
relative to <code>module_name</code>).  Under <code>layout = 'workspace'</code>, the it
becomes <code>node_modules/src/js/my_module/src/js/my_module/app.js</code>
(skylark: <code>file.path</code>).  This is relevant only for protocol buffers
where the generated sources import their own dependencies relative to
the workspace, which needs to be preserved in the generated module.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">node_binary</h2><a id="user-content-node_binary" class="anchor" aria-label="Permalink: node_binary" href="#node_binary"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>node_binary</code> rule writes a script to execute a module entrypoint.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@org_pubref_rules_node//node:rules.bzl&quot;, &quot;node_binary&quot;)

node_binary(
    name = &quot;foo&quot;,
    entrypoint = &quot;:my_module_1&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@org_pubref_rules_node//node:rules.bzl"</span>, <span class="pl-s">"node_binary"</span>)

<span class="pl-en">node_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">entrypoint</span> <span class="pl-c1">=</span> <span class="pl-s">":my_module_1"</span>,
)</pre></div>
<p dir="auto">In example above, we're specifying the name of a <code>node_module</code> to
use as the entrypoint.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_binary(
    name = &quot;foo&quot;,
    main = &quot;foo.js&quot;,
    deps = [
        &quot;:my_module_1
    ],
)"><pre><span class="pl-en">node_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">main</span> <span class="pl-c1">=</span> <span class="pl-s">"foo.js"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        ":<span class="pl-s1">my_module_1</span>
    ],
)</pre></div>
<p dir="auto">In this second example, we're specifying the name of a file to use as
the entrypoint (under the hood, it will just build a <code>node_module</code>
(called <code>foo_module</code>) for your single <code>main</code> foo.js file entrypoint,
becoming equivalent to the first example).</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="node_binary(
    name = &quot;foo&quot;,
    entrypoint = &quot;:my_module_2&quot;,
    executable = &quot;baz&quot;,
)"><pre><span class="pl-en">node_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">entrypoint</span> <span class="pl-c1">=</span> <span class="pl-s">":my_module_2"</span>,
    <span class="pl-s1">executable</span> <span class="pl-c1">=</span> <span class="pl-s">"baz"</span>,
)</pre></div>
<p dir="auto">In this third example (above), we're specifying the name of the node
module to start with (<code>my_module_2</code>) and the name of the executable
within <code>my_module_2</code> to run (<code>baz</code>).  In this case the <code>node_module</code>
rule definition for <code>my_module_2</code> must have a <code>string_dict</code> with an
entry for <code>baz</code> (like <code>executables = { 'baz': 'bin/baz' }</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Output structure of files generated for a <code>node_binary</code> rule</h3><a id="user-content-output-structure-of-files-generated-for-a-node_binary-rule" class="anchor" aria-label="Permalink: Output structure of files generated for a node_binary rule" href="#output-structure-of-files-generated-for-a-node_binary-rule"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A <code>node_binary</code> rule named <code>foo</code> will create a folder having exactly
two entries:</p>
<ol dir="auto">
<li>An executable shell script named <code>foo</code>.</li>
<li>A folder which bundles up all the needed files in <code>foo_files/</code>.</li>
</ol>
<p dir="auto">Within <code>foo_files/</code>, there will also be exactly two entries:</p>
<ol dir="auto">
<li>The <code>node</code> executable itself.</li>
<li>The <code>node_modules/</code> folder with all the built/copied modules
(including the entrypoint module).</li>
</ol>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Building a deployable bundle</h3><a id="user-content-building-a-deployable-bundle" class="anchor" aria-label="Permalink: Building a deployable bundle" href="#building-a-deployable-bundle"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To generate a tarred/gzipped archive of the above example that you can
ship as a single 'executable' self-contained package, invoke <code>$ bazel build :{target}_deploy.tar.gz</code>.  This is similar in intent to the java
<code>{target}_deploy.jar</code> implicit build rule.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ bazel build :foo_deploy
Target //:foo_deploy.tar.gz up-to-date:
  bazel-bin/foo_bundle.tgz
$ du -h bazel-bin/foo_bundle.tgz
33M bazel-bin/foo_bundle.tgz"><pre>$ bazel build :foo_deploy
Target //:foo_deploy.tar.gz up-to-date:
  bazel-bin/foo_bundle.tgz
$ du -h bazel-bin/foo_bundle.tgz
33M bazel-bin/foo_bundle.tgz</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">node_test</h2><a id="user-content-node_test" class="anchor" aria-label="Permalink: node_test" href="#node_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>node_test</code> rule is identical to node_binary, but sets the <code>test = True</code> flag such that it can be used as a bazel test.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">mocha_test</h2><a id="user-content-mocha_test" class="anchor" aria-label="Permalink: mocha_test" href="#mocha_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Runs a mocha test identified by the start script given in <code>main</code> or
module given in <code>entrypoint</code>.</p>
<blockquote>
<p dir="auto">Note: The mocha_test rule depends on <code>@mocha_modules//:_all_</code>, so
you'll need to add this dependency in your <code>WORKSPACE</code> file:</p>
</blockquote>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="yarn_modules(
    name = &quot;mocha_modules&quot;,
    deps = {
        &quot;mocha&quot;: &quot;3.5.3&quot;,
    }
)"><pre><span class="pl-en">yarn_modules</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"mocha_modules"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"mocha"</span>: <span class="pl-s">"3.5.3"</span>,
    }
)</pre></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mocha_test(
    name = &quot;test&quot;,
    main = &quot;test.js&quot;,
)"><pre><span class="pl-en">mocha_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"test"</span>,
    <span class="pl-s1">main</span> <span class="pl-c1">=</span> <span class="pl-s">"test.js"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Conclusion</h2><a id="user-content-conclusion" class="anchor" aria-label="Permalink: Conclusion" href="#conclusion"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">That's it!  Please refer to the various workspaces in <code>tests/</code> and the
source for more detail.</p>
</article></div>