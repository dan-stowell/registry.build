<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Pybind11 bindings for the Abseil C++ Common Libraries</h1><a id="user-content-pybind11-bindings-for-the-abseil-c-common-libraries" class="anchor" aria-label="Permalink: Pybind11 bindings for the Abseil C++ Common Libraries" href="#pybind11-bindings-for-the-abseil-c-common-libraries"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Github-CI:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="left">OS \ Build system</th>
<th align="center">Bazel</th>
<th align="center">CMake</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Linux (<code>amd64</code>)</td>
<td align="center"><a href="./../../actions/workflows/amd64_linux_bazel.yml"><img src="./../../actions/workflows/amd64_linux_bazel.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
<td align="center"><a href="./../../actions/workflows/amd64_linux_cmake.yml"><img src="./../../actions/workflows/amd64_linux_cmake.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
</tr>
<tr>
<td align="left">MacOS (<code>amd64</code>)</td>
<td align="center"><a href="./../../actions/workflows/amd64_macos_bazel.yml"><img src="./../../actions/workflows/amd64_macos_bazel.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
<td align="center"><a href="./../../actions/workflows/amd64_macos_cmake.yml"><img src="./../../actions/workflows/amd64_macos_cmake.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
</tr>
<tr>
<td align="left">MacOS (<code>arm64</code>)</td>
<td align="center"><a href="./../../actions/workflows/arm64_macos_bazel.yml"><img src="./../../actions/workflows/arm64_macos_bazel.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
<td align="center"><a href="./../../actions/workflows/arm64_macos_cmake.yml"><img src="./../../actions/workflows/arm64_macos_cmake.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
</tr>
<tr>
<td align="left">Windows (<code>amd64</code>)</td>
<td align="center"><a href="./../../actions/workflows/amd64_windows_bazel.yml"><img src="./../../actions/workflows/amd64_windows_bazel.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
<td align="center"><a href="./../../actions/workflows/amd64_windows_cmake.yml"><img src="./../../actions/workflows/amd64_windows_cmake.yml/badge.svg" alt="Build Status" style="max-width: 100%; height: auto;"></a></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Overview</h2><a id="user-content-overview" class="anchor" aria-label="Permalink: Overview" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">These adapters make Abseil types work with Pybind11 bindings. For more
information on using Pybind11, see
g3doc/third_party/pybind11/google3_utils/README.md.</p>
<p dir="auto">To use the converters listed below, just include the header
in the .cc file with your bindings:</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#include &quot;pybind11_abseil/absl_casters.h&quot;"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">"</span>pybind11_abseil/absl_casters.h<span class="pl-pds">"</span></span></pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">pybind11_abseil can be built with Bazel or CMake. Instructions for both are below.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Bazel</h3><a id="user-content-bazel" class="anchor" aria-label="Permalink: Bazel" href="#bazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In your BUILD file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@pybind11_bazel//:build_defs.bzl&quot;, &quot;pybind_extension&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@pybind11_bazel//:build_defs.bzl"</span>, <span class="pl-s">"pybind_extension"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Bzlmod</h4><a id="user-content-bzlmod" class="anchor" aria-label="Permalink: Bzlmod" href="#bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can depend on the Bazel module and dependencies via one of the following
commands in your MODULE.bazel:</p>
<p dir="auto">To depend on a release:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(
    name = &quot;pybind11_abseil&quot;,
    version = &quot;&lt;selected_version&gt;&quot;,
)"><pre><span class="pl-en">bazel_dep</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_abseil"</span>,
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"&lt;selected_version&gt;"</span>,
)</pre></div>
<p dir="auto">To depend on floating <code>master</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="http_archive = use_repo_rule(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

http_archive(
  name = &quot;pybind11_bazel&quot;,
  strip_prefix = &quot;pybind11_bazel-master&quot;,
  urls = [&quot;https://github.com/pybind/pybind11_bazel/archive/refs/heads/master.tar.gz&quot;],
)

http_archive(
  name = &quot;pybind11&quot;,
  build_file = &quot;@pybind11_bazel//:pybind11-BUILD.bazel&quot;,
  strip_prefix = &quot;pybind11-master&quot;,
  urls = [&quot;https://github.com/pybind/pybind11/archive/refs/heads/master.tar.gz&quot;],
)

http_archive(
  name = &quot;pybind11_abseil&quot;,
  strip_prefix = &quot;pybind11_abseil-master&quot;,
  urls = [&quot;https://github.com/pybind/pybind11_abseil/archive/refs/heads/master.tar.gz&quot;],
)"><pre><span class="pl-s1">http_archive</span> <span class="pl-c1">=</span> <span class="pl-en">use_repo_rule</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_bazel"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_bazel-master"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11_bazel/archive/refs/heads/master.tar.gz"</span>],
)

<span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11"</span>,
  <span class="pl-s1">build_file</span> <span class="pl-c1">=</span> <span class="pl-s">"@pybind11_bazel//:pybind11-BUILD.bazel"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11-master"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11/archive/refs/heads/master.tar.gz"</span>],
)

<span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_abseil"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_abseil-master"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11_abseil/archive/refs/heads/master.tar.gz"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">WORKSPACE</h4><a id="user-content-workspace" class="anchor" aria-label="Permalink: WORKSPACE" href="#workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel workspace support is deprecated and will be removed at a later date.</p>
<p dir="auto">You will need to depend on <code>pybind11</code>, <code>pybind11_bazel</code>(see
<a href="https://github.com/pybind/pybind11_bazel#installation">doc</a>, and on
<code>pybind11_abseil</code>), e.g.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="http_archive(
  name = &quot;pybind11_bazel&quot;,
  strip_prefix = &quot;pybind11_bazel-master&quot;,
  urls = [&quot;https://github.com/pybind/pybind11_bazel/archive/refs/heads/master.tar.gz&quot;],
)

http_archive(
  name = &quot;pybind11&quot;,
  build_file = &quot;@pybind11_bazel//:pybind11-BUILD.bazel&quot;,
  strip_prefix = &quot;pybind11-master&quot;,
  urls = [&quot;https://github.com/pybind/pybind11/archive/refs/heads/master.tar.gz&quot;],
)

http_archive(
  name = &quot;pybind11_abseil&quot;,
  strip_prefix = &quot;pybind11_abseil-master&quot;,
  urls = [&quot;https://github.com/pybind/pybind11_abseil/archive/refs/heads/master.tar.gz&quot;],
)"><pre><span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_bazel"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_bazel-master"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11_bazel/archive/refs/heads/master.tar.gz"</span>],
)

<span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11"</span>,
  <span class="pl-s1">build_file</span> <span class="pl-c1">=</span> <span class="pl-s">"@pybind11_bazel//:pybind11-BUILD.bazel"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11-master"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11/archive/refs/heads/master.tar.gz"</span>],
)

<span class="pl-en">http_archive</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_abseil"</span>,
  <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"pybind11_abseil-master"</span>,
  <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/pybind/pybind11_abseil/archive/refs/heads/master.tar.gz"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">CMake</h3><a id="user-content-cmake" class="anchor" aria-label="Permalink: CMake" href="#cmake"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In your project, add a FetchContent for pybind11_abseil. This will also fetch
the appropriate versions of Abseil and pybind11 which your project can use
(eliminating the need for submoduling Abseil or using find_package).</p>
<p dir="auto">Add the following to your CMakeLists.txt:</p>
<div class="highlight highlight-source-cmake notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="include(FetchContent)
FetchContent_Declare {
  pybind11_abseil
  GIT_REPOSITORY https://github.com/pybind/pybind11_abseil.git
  GIT_TAG master
}
FetchContent_MakeAvailable(pybind11 abseil-cpp pybind11_abseil)"><pre><span class="pl-c1">include</span>(<span class="pl-s">FetchContent</span>)
<span class="pl-s">FetchContent_Declare</span> <span class="pl-s">{</span>
  <span class="pl-en">pybind11_abseil</span>
  <span class="pl-s">GIT_REPOSITORY</span> <span class="pl-s">https://github.com/pybind/pybind11_abseil.git</span>
  <span class="pl-s">GIT_TAG</span> <span class="pl-en">master</span>
<span class="pl-s">}</span>
<span class="pl-en">FetchContent_MakeAvailable</span>(<span class="pl-s">pybind11</span> <span class="pl-s">abseil-cpp</span> <span class="pl-s">pybind11_abseil</span>)</pre></div>
<p dir="auto">To install the package so that it is accessible from system Python, run cmake
with the flag <code>-DCMAKE_INSTALL_PYDIR</code> set to a directory on your PYTHONPATH and
subsequently run <code>make install</code>. This also works on projects that include
pybind11_abseil via FetchContent.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::Duration</h2><a id="user-content-abslduration" class="anchor" aria-label="Permalink: absl::Duration" href="#abslduration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>absl::Duration</code> objects are converted to/ from python datetime.timedelta objects.
Therefore, C code cannot mutate any datetime.timedelta objects from python.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::Time</h2><a id="user-content-absltime" class="anchor" aria-label="Permalink: absl::Time" href="#absltime"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>absl::Time</code> objects are converted to/from python datetime.datetime objects.
Additionally, datetime.date objects can be converted to <code>absl::Time</code> objects.
C code cannot mutate any datetime.datetime objects from python.</p>
<p dir="auto">Python date objects effectively truncate the time to 0 (i.e., midnight).
Python time objects are not supported because <code>absl::Time</code> would implicitly
assume a year, which could be confusing.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Time zones</h3><a id="user-content-time-zones" class="anchor" aria-label="Permalink: Time zones" href="#time-zones"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Python <code>datetime</code> objects include timezone information, while
<code>absl::Time</code> does not. When converting from Python to C++, if a timezone is
specified then it will be used to determine the <code>absl::Time</code> instant. If no
timezone is specified by the Python <code>datetime</code> object, the local timezone is
assumed.</p>
<p dir="auto">When converting back from C++ to Python, the resultant time will be presented in
the local timezone and the <code>tzinfo</code> property set on the <code>datetime</code> object to
reflect that. This means that the caller may receive a datetime formatted
in a different timezone to the one they passed in. To handle this safely, the
caller should take care to check the <code>tzinfo</code> of any returned <code>datetime</code>s.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::CivilTime</h2><a id="user-content-abslciviltime" class="anchor" aria-label="Permalink: absl::CivilTime" href="#abslciviltime"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>absl::CivilTime</code> objects are converted to/from Python datetime.datetime
objects. Fractional Python datetime components are truncated when converting to
less granular C++ types, and time zone information is ignored.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::Span</h2><a id="user-content-abslspan" class="anchor" aria-label="Permalink: absl::Span" href="#abslspan"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Loading</h3><a id="user-content-loading" class="anchor" aria-label="Permalink: Loading" href="#loading"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Some python types can be loaded (Python-&gt;C++) without copying or converting the
list, while some require copying/ converting the list. The non-converting load
methods will be tried first, and, if the span elements are const, the converting
load methods will be tried next.</p>
<p dir="auto">Arguments cast to a span with <em>non-const</em> elements can never be copied/converted.
To prevent an argument cast to a span with <em>const</em> elements from being copied or
converted, mark it as <code>noconvert()</code> (see go/pybind11-non-converting-arguments).</p>
<p dir="auto">The following python types can be loaded <em>without</em> copying or converting:</p>
<ul dir="auto">
<li>Numpy array (or anything else that supports <a href="https://docs.python.org/3/c-api/buffer.htm" rel="nofollow">buffer protocol</a>) =&gt; <code>Span&lt;{const or non-const} T&gt;</code>
if <em>all</em> of the following conditions are satisfied:
<ul dir="auto">
<li>The buffer is 1-D.</li>
<li>T is a numeric type.</li>
<li>The array dtype matches T exactly.</li>
<li>If T is not const, the buffer allows writing.</li>
<li>The stride does not indicate to skip elements or go in reverse order.</li>
</ul>
</li>
<li><a href="https://pybind11.readthedocs.io/en/stable/advanced/cast/stl.html#making-opaque-types" rel="nofollow">Opaque</a> <code>std::vector&lt;T&gt;</code> =&gt; <code>Span&lt;{const or non-const} T&gt;</code>.
<ul dir="auto">
<li>T can be any type, including converted or pointer types, but must
match exactly between C++ and python.</li>
<li>Opaque vectors are <em>not</em> currently compatible with the smart holder.</li>
</ul>
</li>
</ul>
<p dir="auto">The following python types must be copied/converted to be loaded:</p>
<ul dir="auto">
<li>Python sequence of elements that require conversion (numbers, strings,
datetimes, etc) =&gt; <code>Span&lt;const T&gt;</code>.
<ul dir="auto">
<li>The elements will be copied/ converted, so that conversion must be legal.</li>
<li>T <em>cannot</em> be a pointer.</li>
</ul>
</li>
<li>Python sequence of elements that do <em>not</em> require conversion (ie, classes
wrapped with py::class_) =&gt; <code>Span&lt;const T&gt;</code> (elements <em>will</em> be copied) or
<code>Span&lt;{const or non-const} T* const&gt;</code> (elements will <em>not</em> be copied).</li>
</ul>
<p dir="auto">Specifically, this conversion will <em>fail</em> if any of the following are true:</p>
<ul dir="auto">
<li><code>noconvert()</code> was specified (see go/pybind11-non-converting-arguments).</li>
<li>The element conversion is not allowed (eg, floating point to integer).</li>
<li>The sequence is being loaded into a <code>Span&lt;{non-const} T&gt;</code> or
<code>Span&lt;{const or non-const} T* {non-const}&gt;</code>.</li>
<li>The elements require conversion <em>and</em> the sequence is being loaded into a
<code>Span&lt;T*&gt;</code> (regardless of any <code>const</code>s; the element caster which owns the
converted value would be destroyed before <code>load</code> is complete, resulting in
dangling references).</li>
<li>The span is nested (ie, <code>absl::Span&lt;absl::Span&lt;T&gt;&gt;</code>, regardless of any <code>const</code>s).</li>
</ul>
<p dir="auto">Note: These failure conditions only apply to <em>converted</em> python types.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Casting</h3><a id="user-content-casting" class="anchor" aria-label="Permalink: Casting" href="#casting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Spans are cast (C++-&gt;Python) with the standard list caster, which always
converts the list. This could be changed in the future (eg, using
<a href="https://pybind11.readthedocs.io/en/stable/advanced/pycpp/numpy.html#buffer-protocol" rel="nofollow">buffer protocol</a>
) but generally using spans as return values is not recommended.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::string_view</h2><a id="user-content-abslstring_view" class="anchor" aria-label="Permalink: absl::string_view" href="#abslstring_view"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Supported exactly the same way pybind11 supports <code>std::string_view</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::optional</h2><a id="user-content-absloptional" class="anchor" aria-label="Permalink: absl::optional" href="#absloptional"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Supported exactly the same way pybind11 supports <code>std::optional</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::flat_hash_map and absl::btree_map</h2><a id="user-content-abslflat_hash_map-and-abslbtree_map" class="anchor" aria-label="Permalink: absl::flat_hash_map and absl::btree_map" href="#abslflat_hash_map-and-abslbtree_map"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Supported exactly the same way pybind11 supports <code>std::map</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::flat_hash_set</h2><a id="user-content-abslflat_hash_set" class="anchor" aria-label="Permalink: absl::flat_hash_set" href="#abslflat_hash_set"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Supported exactly the same way pybind11 supports <code>std::set</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">absl::Status[Or]</h2><a id="user-content-abslstatusor" class="anchor" aria-label="Permalink: absl::Status[Or]" href="#abslstatusor"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use the Status[Or] casters:</p>
<ol dir="auto">
<li>Include the header file <code>pybind11_abseil/status_casters.h</code>
in the .cc file with your bindings.</li>
<li>Call <code>pybind11::google::ImportStatusModule();</code> in your <code>PYBIND11_MODULE</code>
definition.</li>
</ol>
<p dir="auto">(For use outside google3:
The path used for the <code>status</code> module may be changed by altering the value of
<code>PYBIND11_ABSEIL_STATUS_MODULE_PATH</code> defined in <code>import_status_module.h</code>.)</p>
<p dir="auto">By default, an ok status will be converted into <code>None</code>, and a non-ok status will
raise a <code>status.StatusNotOk</code> exception. This has a <code>status</code> attribute which can
be used to access the status object and check the code/ message.</p>
<p dir="auto">To get a <code>status.Status</code> object rather than having an exception thrown, pass
either the <code>Status</code> object or a function returning a <code>Status</code> to
<code>pybind11::google::DoNotThrowStatus</code> before casting or binding. This works with
references and pointers to <code>absl::Status</code> objects too.</p>
<p dir="auto">It isn't possible to specify separate return value policies for a <code>StatusOr</code>
object and its payload. Since <code>StatusOr</code> is processed and not ever actually
represented in Python, the return value policy applies to the payload. E.g., if
you return a <code>StatusOr&lt;MyObject*&gt;</code> (note the <code>*</code> is inside the <code>StatusOr</code>) with
a take_ownership return val policy and the status is OK (i.e., it has a payload)
, Python will take ownership of that payload and free it when it is garbage
collected.</p>
<p dir="auto">However, if you return a <code>StatusOr&lt;MyObject&gt;*</code> (note: the <code>*</code> is outside the
<code>StatusOr</code> rather than inside it now) with a <code>take_ownership</code> return val policy,
Python does not take ownership of the <code>StatusOr</code> and will not free it (because
again, that policy applies to <code>MyObject</code>, not <code>StatusOr</code>).</p>
<p dir="auto">See <code>status_utils.cc</code> in this directory for details about what methods are
available in wrapped <code>absl::Status</code> objects.</p>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#include &quot;pybind11_abseil/status_casters.h&quot;

absl::Status StatusReturningFunction() {
  return absl::Status(...);
}

pybind11::object StatusHandlingFunction() {
  return pybind11::cast(pybind11::google::DoNotThrowStatus(StatusReturningFunction()));
}

PYBIND11_MODULE(test_bindings, m) {
  pybind11::google::ImportStatusModule();

  m.def(&quot;return_status&quot;, &amp;StatusReturningFunction,
        &quot;Return None if StatusCode is OK, otherwise raise an error.&quot;);
  m.def(&quot;make_status&quot;, google::DoNotThrowStatus(&amp;StatusReturningFunction),
        &quot;Return a wrapped status object without raising an error.&quot;);
  m.def(&quot;status_handling_function&quot;, &amp;StatusHandlingFunction,
        &quot;Same effect as make_status, but cast is done internally.&quot;);
};"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">"</span>pybind11_abseil/status_casters.h<span class="pl-pds">"</span></span>

absl::Status <span class="pl-en">StatusReturningFunction</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">absl::Status</span>(...);
}

pybind11::object <span class="pl-en">StatusHandlingFunction</span>() {
  <span class="pl-k">return</span> <span class="pl-c1">pybind11::cast</span>(<span class="pl-c1">pybind11::google::DoNotThrowStatus</span>(<span class="pl-c1">StatusReturningFunction</span>()));
}

<span class="pl-en">PYBIND11_MODULE</span>(test_bindings, m) {
  <span class="pl-c1">pybind11::google::ImportStatusModule</span>();

  m.<span class="pl-c1">def</span>(<span class="pl-s"><span class="pl-pds">"</span>return_status<span class="pl-pds">"</span></span>, &amp;StatusReturningFunction,
        <span class="pl-s"><span class="pl-pds">"</span>Return None if StatusCode is OK, otherwise raise an error.<span class="pl-pds">"</span></span>);
  m.<span class="pl-c1">def</span>(<span class="pl-s"><span class="pl-pds">"</span>make_status<span class="pl-pds">"</span></span>, <span class="pl-c1">google::DoNotThrowStatus</span>(&amp;StatusReturningFunction),
        <span class="pl-s"><span class="pl-pds">"</span>Return a wrapped status object without raising an error.<span class="pl-pds">"</span></span>);
  m.<span class="pl-c1">def</span>(<span class="pl-s"><span class="pl-pds">"</span>status_handling_function<span class="pl-pds">"</span></span>, &amp;StatusHandlingFunction,
        <span class="pl-s"><span class="pl-pds">"</span>Same effect as make_status, but cast is done internally.<span class="pl-pds">"</span></span>);
};</pre></div>
<p dir="auto">Python:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="from pybind11_abseil import status
import test_bindings

my_status = make_status()
if my_status.code():
  ...

try:
  return_status()
except status.StatusNotOk as e:
  print(e.status)"><pre><span class="pl-k">from</span> <span class="pl-s1">pybind11_abseil</span> <span class="pl-k">import</span> <span class="pl-s1">status</span>
<span class="pl-k">import</span> <span class="pl-s1">test_bindings</span>

<span class="pl-s1">my_status</span> <span class="pl-c1">=</span> <span class="pl-en">make_status</span>()
<span class="pl-k">if</span> <span class="pl-s1">my_status</span>.<span class="pl-c1">code</span>():
  ...

<span class="pl-k">try</span>:
  <span class="pl-en">return_status</span>()
<span class="pl-k">except</span> <span class="pl-s1">status</span>.<span class="pl-c1">StatusNotOk</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
  <span class="pl-en">print</span>(<span class="pl-s1">e</span>.<span class="pl-c1">status</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">absl::StatusOr</h3><a id="user-content-abslstatusor-1" class="anchor" aria-label="Permalink: absl::StatusOr" href="#abslstatusor-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>absl::StatusOr</code> objects behave exactly like <code>absl::Status</code> objects, except:</p>
<ul dir="auto">
<li>There is no support for passing <code>StatusOr</code> objects. You can only return them.</li>
<li>Instead of returning None or a wrapped status with OK, this casts and
returns the payload when there is no error.</li>
</ul>
<p dir="auto">As with <code>absl::Status</code>, the default behavior is to throw an error when casting
a non-ok status. You may pass a <code>StatusOr</code> object or <code>StatusOr</code> returning
function to <code>pybind11::google::DoNotThrowStatus</code> in exactly the same way as with
<code>absl::Status</code> to change this behavior.</p>
<p dir="auto"><code>absl::StatusOr</code> objects must be returned by value (not reference or pointer).
Why? Because the implementation takes advantage of the fact that python is a
dynamically typed language to cast and return the payload <em>or</em> the
<code>absl::Status</code> object (or raise an exeception). Python has no concept of a
<code>absl::StatusOr</code> object, so it's also impossible to apply the
return_value_policy to a <code>absl::StatusOr</code>. Therefore returning a reference or
pointer to a <code>absl::StatusOr</code> is meaningless.</p>
<p dir="auto">Pointers <em>can</em> be used as the payload type, and the return_value_policy will
be applied to the payload if the status is OK. However, references cannot be
used as the payload type, because that's a restriction on <code>absl::StatusOr</code> in
general, not pybind11 (see <a href="https://yaqs/5903163345338368" rel="nofollow">https://yaqs/5903163345338368</a>).</p>
<p dir="auto">This can handle any type of payload that pybind knows about. unique_ptrs (i.e.,
<code>absl::StatusOr&lt;std::unique_ptr&lt;...&gt;&gt;</code>) to wrapped classes or structs (i.e., any
type which you created bindings for using <code>pybind11::class_&lt;...&gt;</code>) can be used,
but unique_ptrs to converted types (e.g., <code>int</code>, <code>string</code>, <code>absl::Time</code>,
<code>absl::Duration</code>, etc.) cannot be used.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">absl::StatusCode</h3><a id="user-content-abslstatuscode" class="anchor" aria-label="Permalink: absl::StatusCode" href="#abslstatuscode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>status</code> module provides <code>pybind11::enum_</code> bindings for <code>absl::StatusCode</code>.
These use python constant style, e.g. <code>status.StatusCode.OK</code>,
<code>status.StatusCode.CANCELLED</code>, etc.</p>
<p dir="auto">Warning: Pybind enums are their own type, and will never compare equally to
integers due to being a different type, regardless of their value. In particular
, note that the <a href="http://google3/util/task/status.proto" rel="nofollow">status proto</a>
<code>code</code> field is an integer, so it will never directly compare as equal to a
<code>StatusCode</code>. To fix this, convert an integer to a <code>StatusCode</code> or vice-versa.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="status_code = 0  # An integer.

if status_code == status.StatusCode.OK:  # Wrong: always evaluates to false.
  ...

if status.StatusCode(status_code) == status.StatusCode.OK:  # Correct.
  ...

if status_code == int(status.StatusCode.OK):  # Also correct.
  ..."><pre><span class="pl-s1">status_code</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>  <span class="pl-c"># An integer.</span>

<span class="pl-k">if</span> <span class="pl-s1">status_code</span> <span class="pl-c1">==</span> <span class="pl-s1">status</span>.<span class="pl-c1">StatusCode</span>.<span class="pl-c1">OK</span>:  <span class="pl-c"># Wrong: always evaluates to false.</span>
  ...

<span class="pl-k">if</span> <span class="pl-s1">status</span>.<span class="pl-c1">StatusCode</span>(<span class="pl-s1">status_code</span>) <span class="pl-c1">==</span> <span class="pl-s1">status</span>.<span class="pl-c1">StatusCode</span>.<span class="pl-c1">OK</span>:  <span class="pl-c"># Correct.</span>
  ...

<span class="pl-k">if</span> <span class="pl-s1">status_code</span> <span class="pl-c1">==</span> <span class="pl-en">int</span>(<span class="pl-s1">status</span>.<span class="pl-c1">StatusCode</span>.<span class="pl-c1">OK</span>):  <span class="pl-c"># Also correct.</span>
  ...</pre></div>
</article></div>