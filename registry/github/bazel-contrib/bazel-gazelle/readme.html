<div id="readme" class="rst" data-path="README.rst"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Gazelle build file generator</h1><a id="user-content-gazelle-build-file-generator" class="anchor" aria-label="Permalink: Gazelle build file generator" href="#gazelle-build-file-generator"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle is a build file generator for Bazel projects. It can create new
BUILD.bazel files for a project that follows language conventions, and it can
update existing build files to include new sources, dependencies, and
options. Gazelle natively supports Go and protobuf, and it may be <a href="extend.md">extended</a>
to support new languages and custom rule sets.</p>
<p dir="auto">Gazelle may be run by Bazel using the <a href="#bazel-rule">gazelle rule</a>, or it may be installed
and run as a command line tool. Gazelle can also generate build files for
external repositories as part of the <a href="repository.md#go_repository">go_repository</a> rule.</p>
<p dir="auto"><em>Gazelle is under active development. Its interface and the rules it generates
may change. Gazelle is not an official Google product.</em></p>
<p dir="auto">Mailing list: <a href="https://groups.google.com/forum/#!forum/bazel-go-discuss" rel="nofollow">bazel-go-discuss</a></p>
<p dir="auto">Slack: <a href="https://bazelbuild.slack.com/archives/CDBP88Z0D" rel="nofollow">#go on Bazel Slack</a>, <a href="https://gophers.slack.com/archives/C1SCQE54N" rel="nofollow">#bazel on Go Slack</a></p>
<p dir="auto"><em>rules_go and Gazelle are getting community maintainers! If you are a regular
user of either project and are interested in helping out with development,
code reviews, and issue triage, please drop by our Slack channels (linked above)
and say hello!</em></p>
<div id="user-content-contents" dir="auto">
<p dir="auto"><strong>Contents</strong></p>
<ul dir="auto">
<li><a href="#supported-languages" id="user-content-id3">Supported languages</a></li>
<li><a href="#setup" id="user-content-id4">Setup</a><ul dir="auto">
<li><a href="#bzlmod" id="user-content-id5">Bzlmod</a></li>
<li><a href="#workspace" id="user-content-id6">WORKSPACE</a></li>
<li><a href="#running-gazelle-with-go" id="user-content-id7">Running Gazelle with Go</a></li>
</ul>
</li>
<li><a href="#compatibility-with-go" id="user-content-id8">Compatibility with Go</a></li>
<li><a href="#compatibility-with-rules-go" id="user-content-id9">Compatibility with rules_go</a></li>
<li><a href="#usage" id="user-content-id10">Usage</a><ul dir="auto">
<li><a href="#command-line" id="user-content-id11">Command line</a></li>
<li><a href="#bazel-rule" id="user-content-id12">Bazel rule</a></li>
<li><a href="#fix-and-update" id="user-content-id13"><code>fix</code> and <code>update</code></a></li>
<li><a href="#update-repos" id="user-content-id14"><code>update-repos</code></a></li>
<li><a href="#directives" id="user-content-id15">Directives</a></li>
<li><a href="#keep-comments" id="user-content-id16">Keep comments</a></li>
</ul>
</li>
<li><a href="#dependency-resolution" id="user-content-id17">Dependency resolution</a></li>
<li><a href="#fix-command-transformations" id="user-content-id18">Fix command transformations</a></li>
</ul>
</div>
<p dir="auto"><strong>See also:</strong></p>
<ul dir="auto">
<li><a href="Design.rst">Architecture of Gazelle</a></li>
<li><a href="repository.md">Repository rules</a><ul dir="auto">
<li><a href="repository.md#go_repository">go_repository</a></li>
</ul>
</li>
<li><a href="extend.md">Extending Gazelle</a></li>
<li><a href="https://github.com/bazelbuild/rules_go/blob/master/proto/core.rst#avoiding-conflicts">Avoiding conflicts with proto rules</a></li>
</ul>
<a name="user-content-supported-languages"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id3">Supported languages</a></h2><a id="user-content-supported-languages" class="anchor" aria-label="Permalink: Supported languages" href="#supported-languages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle can generate Bazel BUILD files for many languages:</p>
<ul dir="auto">
<li><p dir="auto">Go</p>
<p dir="auto">Go supported is included here in bazel-gazelle, see below.</p>
</li>
<li><p dir="auto">Haskell</p>
<p dir="auto">Tweag's <a href="https://github.com/tweag/rules_haskell">rules_haskell</a> has two extensions: <a href="https://github.com/tweag/gazelle_cabal">gazelle_cabal</a>, for generating rules from Cabal files
and <a href="https://github.com/tweag/gazelle_haskell_modules">gazelle_haskell_modules</a> for even more fine-grained build definitions.</p>
</li>
<li><p dir="auto">Java</p>
<p dir="auto">bazel-contrib's <a href="https://github.com/bazel-contrib/rules_jvm">rules_jvm</a> extensions include <a href="https://github.com/bazel-contrib/rules_jvm/tree/main/java/gazelle">a gazelle extension</a> for
generating <code>java_library</code>, <code>java_binary</code>, <code>java_test</code>, and <code>java_test_suite</code> rules.</p>
</li>
<li><p dir="auto">JavaScript / TypeScript</p>
<p dir="auto">Aspect provides <a href="https://github.com/aspect-build/aspect-cli/blob/main/gazelle/js/">JavaScript and TypeScript Support</a> in aspect-cli (also usable separately).</p>
<p dir="auto">BenchSci's <a href="https://github.com/benchsci/rules_nodejs_gazelle">rules_nodejs_gazelle</a> supports generating ts_project, js_library, jest_test,
and web_asset rules, and is able to support module bundlers like Webpack and Next.js</p>
</li>
<li><p dir="auto">Kotlin</p>
<p dir="auto">Aspect Build provides some <a href="https://github.com/aspect-build/aspect-cli/blob/main/gazelle/kotlin/">Kotlin Support</a> in the repo of their aspect-cli (also usable separately).
Still under development, please check the README for currently available features.</p>
</li>
<li><p dir="auto">Protocol Buffers</p>
<p dir="auto">Support for the proto_library rule, as well as go_proto_library is in this repository, see below.
Other language-specific proto rules are not supported here.
<a href="https://github.com/stackb/rules_proto">stackb/rules_proto</a> is a good resource for these rules.</p>
</li>
<li><p dir="auto">Python</p>
<p dir="auto"><a href="https://github.com/bazelbuild/rules_python">rules_python</a> has an extension for generating <code>py_library</code>, <code>py_binary</code>, and <code>py_test</code> rules.</p>
</li>
<li><p dir="auto">R</p>
<p dir="auto"><a href="https://github.com/grailbio/rules_r">rules_r</a> has an extension for generating rules for R package builds and tests.</p>
</li>
<li><p dir="auto">Rust</p>
<p dir="auto"><a href="https://github.com/Calsign/gazelle_rust">gazelle_rust</a> is an extension for generating <a href="https://github.com/bazelbuild/rules_rust">rules_rust</a> targets.</p>
</li>
<li><p dir="auto">Starlark</p>
<p dir="auto"><a href="https://github.com/bazelbuild/bazel-skylib">bazel-skylib</a> has an extension for generating <code>bzl_library</code> rules. See <a href="https://github.com/bazelbuild/bazel-skylib/tree/master/gazelle/bzl">bazel_skylib/gazelle/bzl</a>.</p>
</li>
<li><p dir="auto">Swift</p>
<p dir="auto"><a href="https://github.com/cgrindel/rules_swift_package_manager">rules_swift_package_manager</a> has an extension for generating <code>swift_library</code>, <code>swift_binary</code>, and
<code>swift_test</code> rules. It also includes facilities for resolving, downloading and building external Swift
packages for a Bazel workspace.</p>
</li>
</ul>
<p dir="auto">If you know of an extension which could be linked here, please <a href="https://github.com/bazelbuild/bazel-gazelle/edit/master/README.rst">open a PR</a>!</p>
<p dir="auto">More languages can be added by <a href="extend.md">Extending Gazelle</a>.
Chat with us in the <code>#gazelle</code> channel on <a href="https://slack.bazel.build" rel="nofollow">Bazel Slack</a> if you'd like to discuss your design.</p>
<p dir="auto">If you've written your own extension, please consider open-sourcing it for
use by the rest of the community.
Note that such extensions belong in a language-specific repository, not in bazel-gazelle.
See discussion in <a href="https://github.com/bazelbuild/bazel-gazelle/issues/1030" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/bazel-gazelle/issues/1030/hovercard">#1030</a>.</p>
<a name="user-content-setup"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id4">Setup</a></h2><a id="user-content-setup" class="anchor" aria-label="Permalink: Setup" href="#setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<a name="user-content-bzlmod"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id5">Bzlmod</a></h3><a id="user-content-bzlmod" class="anchor" aria-label="Permalink: Bzlmod" href="#bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See the <a href="https://github.com/bazel-contrib/rules_go/blob/master/docs/go/core/bzlmod.md">Go Bzlmod docs</a>.</p>
<p dir="auto">The full documentation for the <code>go_deps</code> extension is in <a href="extensions.md#go_deps">extensions.md</a>.</p>
<a name="user-content-workspace"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id6">WORKSPACE</a></h3><a id="user-content-workspace" class="anchor" aria-label="Permalink: WORKSPACE" href="#workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use Gazelle in a new project, add the <code>bazel_gazelle</code> repository and its
dependencies to your WORKSPACE file and call <code>gazelle_dependencies</code>. It
should look like this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

http_archive(
    name = &quot;io_bazel_rules_go&quot;,
    integrity = &quot;sha256-M6zErg9wUC20uJPJ/B3Xqb+ZjCPn/yxFF3QdQEmpdvg=&quot;,
    urls = [
        &quot;https://mirror.bazel.build/github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip&quot;,
        &quot;https://github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip&quot;,
    ],
)

http_archive(
    name = &quot;bazel_gazelle&quot;,
    integrity = &quot;sha256-12v3pg/YsFBEQJDfooN6Tq+YKeEWVhjuNdzspcvfWNU=&quot;,
    urls = [
        &quot;https://mirror.bazel.build/github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz&quot;,
        &quot;https://github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz&quot;,
    ],
)


load(&quot;@io_bazel_rules_go//go:deps.bzl&quot;, &quot;go_register_toolchains&quot;, &quot;go_rules_dependencies&quot;)
load(&quot;@bazel_gazelle//:deps.bzl&quot;, &quot;gazelle_dependencies&quot;, &quot;go_repository&quot;)

############################################################
# Define your own dependencies here using go_repository.
# Else, dependencies declared by rules_go/gazelle will be used.
# The first declaration of an external repository &quot;wins&quot;.
############################################################

go_rules_dependencies()

go_register_toolchains(version = &quot;1.20.5&quot;)

gazelle_dependencies()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"io_bazel_rules_go"</span>,
    <span class="pl-s1">integrity</span> <span class="pl-c1">=</span> <span class="pl-s">"sha256-M6zErg9wUC20uJPJ/B3Xqb+ZjCPn/yxFF3QdQEmpdvg="</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://mirror.bazel.build/github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip"</span>,
        <span class="pl-s">"https://github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip"</span>,
    ],
)

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_gazelle"</span>,
    <span class="pl-s1">integrity</span> <span class="pl-c1">=</span> <span class="pl-s">"sha256-12v3pg/YsFBEQJDfooN6Tq+YKeEWVhjuNdzspcvfWNU="</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://mirror.bazel.build/github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz"</span>,
        <span class="pl-s">"https://github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz"</span>,
    ],
)


<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_go//go:deps.bzl"</span>, <span class="pl-s">"go_register_toolchains"</span>, <span class="pl-s">"go_rules_dependencies"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@bazel_gazelle//:deps.bzl"</span>, <span class="pl-s">"gazelle_dependencies"</span>, <span class="pl-s">"go_repository"</span>)

<span class="pl-c">############################################################</span>
<span class="pl-c"># Define your own dependencies here using go_repository.</span>
<span class="pl-c"># Else, dependencies declared by rules_go/gazelle will be used.</span>
<span class="pl-c"># The first declaration of an external repository "wins".</span>
<span class="pl-c">############################################################</span>

<span class="pl-en">go_rules_dependencies</span>()

<span class="pl-en">go_register_toolchains</span>(<span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.20.5"</span>)

<span class="pl-en">gazelle_dependencies</span>()</pre></div>
<p dir="auto"><code>gazelle_dependencies</code> supports optional argument <code>go_env</code> (dict-mapping)
to set project specific go environment variables. If you are using a
WORKSPACE.bazel file, you will need to specify that using:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gazelle_dependencies(go_repository_default_config = &quot;//:WORKSPACE.bazel&quot;)"><pre><span class="pl-en">gazelle_dependencies</span>(<span class="pl-s1">go_repository_default_config</span> <span class="pl-c1">=</span> <span class="pl-s">"//:WORKSPACE.bazel"</span>)</pre></div>
<p dir="auto">Add the code below to the BUILD or BUILD.bazel file in the root directory
of your repository.</p>
<p dir="auto"><strong>Important:</strong> For Go projects, replace the string after <code>prefix</code> with
the portion of your import path that corresponds to your repository.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_gazelle//:def.bzl&quot;, &quot;gazelle&quot;)

# gazelle:prefix github.com/example/project
gazelle(name = &quot;gazelle&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_gazelle//:def.bzl"</span>, <span class="pl-s">"gazelle"</span>)

<span class="pl-c"># gazelle:prefix github.com/example/project</span>
<span class="pl-en">gazelle</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle"</span>)</pre></div>
<p dir="auto">After adding this code, you can run Gazelle with Bazel.</p>
<pre>$ bazel run //:gazelle
</pre>
<p dir="auto">This will generate new BUILD.bazel files for your project. You can run the same
command in the future to update existing BUILD.bazel files to include new source
files or options.</p>
<p dir="auto">You can write other <code>gazelle</code> rules to run alternate commands like <code>update-repos</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gazelle(
    name = &quot;gazelle-update-repos&quot;,
    args = [
        &quot;-from_file=go.mod&quot;,
        &quot;-to_macro=deps.bzl%go_dependencies&quot;,
        &quot;-prune&quot;,
    ],
    command = &quot;update-repos&quot;,
)"><pre><span class="pl-en">gazelle</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle-update-repos"</span>,
    <span class="pl-s1">args</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"-from_file=go.mod"</span>,
        <span class="pl-s">"-to_macro=deps.bzl%go_dependencies"</span>,
        <span class="pl-s">"-prune"</span>,
    ],
    <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">"update-repos"</span>,
)</pre></div>
<p dir="auto">You can also pass additional arguments to Gazelle after a <code>--</code> argument.</p>
<pre>$ bazel run //:gazelle -- update-repos -from_file=go.mod -to_macro=deps.bzl%go_dependencies
</pre>
<p dir="auto">After running <code>update-repos</code>, you might want to run <code>bazel run //:gazelle</code> again, as the
<code>update-repos</code> command can affect the output of a normal run of Gazelle.</p>
<p dir="auto">To verify that all BUILD files are update-to-date, you can use the <code>gazelle_test</code> rule.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_gazelle//:def.bzl&quot;, &quot;gazelle_test&quot;)

gazelle_test(
    name = &quot;gazelle_test&quot;,
    workspace = &quot;//:BUILD.bazel&quot;, # a file in the workspace root, where the gazelle will be run
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_gazelle//:def.bzl"</span>, <span class="pl-s">"gazelle_test"</span>)

<span class="pl-en">gazelle_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle_test"</span>,
    <span class="pl-s1">workspace</span> <span class="pl-c1">=</span> <span class="pl-s">"//:BUILD.bazel"</span>, <span class="pl-c"># a file in the workspace root, where the gazelle will be run</span>
)</pre></div>
<p dir="auto">However, please note that gazelle_test cannot be cached.</p>
<a name="user-content-running-gazelle-with-go"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id7">Running Gazelle with Go</a></h3><a id="user-content-running-gazelle-with-go" class="anchor" aria-label="Permalink: Running Gazelle with Go" href="#running-gazelle-with-go"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you have a Go toolchain installed, you can install Gazelle with the
command below:</p>
<pre>go install github.com/bazelbuild/bazel-gazelle/cmd/gazelle@latest
</pre>
<p dir="auto">Make sure to re-run this command to upgrade Gazelle whenever you upgrade
rules_go in your repository.</p>
<p dir="auto">To generate BUILD.bazel files in a new project, run the command below, replacing
the prefix with the portion of your import path that corresponds to your
repository.</p>
<pre>gazelle -go_prefix github.com/example/project
</pre>
<p dir="auto">Most of Gazelle's command-line arguments can be expressed as special comments
in build files. See <a href="#directives">Directives</a> below. You may want to copy this line into
your root build files to avoid having to type <code>-go_prefix</code> every time.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:prefix github.com/example/project"><pre><span class="pl-c"># gazelle:prefix github.com/example/project</span></pre></div>
<a name="user-content-compatibility-with-go"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id8">Compatibility with Go</a></h2><a id="user-content-compatibility-with-go" class="anchor" aria-label="Permalink: Compatibility with Go" href="#compatibility-with-go"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle is compatible with supported releases of Go, per the
<a href="https://golang.org/doc/devel/release.html#policy" rel="nofollow">Go Release Policy</a>. The Go Team officially supports the current and previous
minor releases. Older releases are not supported and don't receive bug fixes
or security updates.</p>
<p dir="auto">Gazelle may use language and library features from the oldest supported release.</p>
<a name="user-content-compatibility-with-rules-go"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id9">Compatibility with rules_go</a></h2><a id="user-content-compatibility-with-rules_go" class="anchor" aria-label="Permalink: Compatibility with rules_go" href="#compatibility-with-rules_go"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle generates build files that use features in newer versions of
<code>rules_go</code>. Newer versions of Gazelle <em>may</em> generate build files that work
with older versions of <code>rules_go</code>, but check the table below to ensure
you're using a compatible version.</p>
<markdown-accessiblity-table><table>





<thead valign="bottom">
<tr><th><strong>Gazelle version</strong></th>
<th><strong>Minimum rules_go version</strong></th>
<th><strong>Maximum rules_go version</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td>0.8</td>
<td>0.8</td>
<td>n/a</td>
</tr>
<tr><td>0.9</td>
<td>0.9</td>
<td>n/a</td>
</tr>
<tr><td>0.10</td>
<td>0.9</td>
<td>0.11</td>
</tr>
<tr><td>0.11</td>
<td>0.11</td>
<td>0.24</td>
</tr>
<tr><td>0.12</td>
<td>0.11</td>
<td>0.24</td>
</tr>
<tr><td>0.13</td>
<td>0.13</td>
<td>0.24</td>
</tr>
<tr><td>0.14</td>
<td>0.13</td>
<td>0.24</td>
</tr>
<tr><td>0.15</td>
<td>0.13</td>
<td>0.24</td>
</tr>
<tr><td>0.16</td>
<td>0.13</td>
<td>0.24</td>
</tr>
<tr><td>0.17</td>
<td>0.13</td>
<td>0.24</td>
</tr>
<tr><td>0.18</td>
<td>0.19</td>
<td>0.24</td>
</tr>
<tr><td>0.19</td>
<td>0.19</td>
<td>0.24</td>
</tr>
<tr><td>0.20</td>
<td>0.20</td>
<td>0.24</td>
</tr>
<tr><td>0.21</td>
<td>0.20</td>
<td>0.24</td>
</tr>
<tr><td>0.22</td>
<td>0.20</td>
<td>0.24</td>
</tr>
<tr><td>0.23</td>
<td>0.26</td>
<td>0.28</td>
</tr>
<tr><td>0.24</td>
<td>0.29</td>
<td>0.40</td>
</tr>
<tr><td>0.25</td>
<td>0.29</td>
<td>0.40</td>
</tr>
<tr><td>0.26</td>
<td>0.29</td>
<td>0.40</td>
</tr>
<tr><td>0.27</td>
<td>0.29</td>
<td>0.40</td>
</tr>
<tr><td>0.28</td>
<td>0.35</td>
<td>0.40</td>
</tr>
<tr><td>0.29</td>
<td>0.35</td>
<td>0.40</td>
</tr>
<tr><td>0.30</td>
<td>0.35</td>
<td>0.40</td>
</tr>
<tr><td>0.31</td>
<td>0.35</td>
<td>0.40</td>
</tr>
<tr><td>0.32</td>
<td><strong>0.41</strong></td>
<td>n/a</td>
</tr>
<tr><td>0.33</td>
<td>0.41</td>
<td>n/a</td>
</tr>
<tr><td>0.34</td>
<td>0.41</td>
<td>n/a</td>
</tr>
<tr><td>0.35</td>
<td>0.41</td>
<td>n/a</td>
</tr>
<tr><td>0.36</td>
<td>0.41</td>
<td>n/a</td>
</tr>
<tr><td>0.37</td>
<td>0.41</td>
<td>n/a</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<a name="user-content-usage"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id10">Usage</a></h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<a name="user-content-command-line"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id11">Command line</a></h3><a id="user-content-command-line" class="anchor" aria-label="Permalink: Command line" href="#command-line"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<pre>gazelle &lt;command&gt; [flags...] [package-dirs...]
</pre>
<p dir="auto">The first argument to Gazelle may be one of the commands below. If no command
is specified, <code>update</code> is assumed. The remaining arguments are specific
to each command and are documented below.</p>
<dl>
<dt><a href="#fix-and-update">update</a></dt>
<dd>Scans sources files, then generates and updates build files.</dd>
<dt><a href="#fix-and-update">fix</a></dt>
<dd>Same as the <code>update</code> command, but it also fixes deprecated usage of rules.</dd>
<dt><a href="#update-repos">update-repos</a></dt>
<dd>Adds and updates repository rules in the WORKSPACE file.</dd>
</dl>
<a name="user-content-bazel-rule"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id12">Bazel rule</a></h3><a id="user-content-bazel-rule" class="anchor" aria-label="Permalink: Bazel rule" href="#bazel-rule"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle may be run via a rule. See <a href="#id19"><span id="user-content-id20">`Running Gazelle with Bazel`_</span></a> for setup
instructions. This rule builds Gazelle and generates a wrapper script that
executes Gazelle with baked-in set of arguments. You can run this script
with <code>bazel run</code>, or you can copy it into your workspace and run it directly.</p>
<p dir="auto">The following attributes are available on the <code>gazelle</code> rule.</p>
<markdown-accessiblity-table><table>





<thead valign="bottom">
<tr><th><strong>Name</strong></th>
<th><strong>Type</strong></th>
<th><strong>Default value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td><span>gazelle</span></td>
<td><em>label</em></td>
<td><code>@bazel_gazelle//cmd/gazelle</code></td>
</tr>
<tr><td colspan="3">The <a href="extend.md#gazelle_binary">gazelle_binary</a> rule that builds Gazelle. You can substitute a modified
version of Gazelle with this. See <a href="extend.md">Extending Gazelle</a>.</td>
</tr>
<tr><td><span>external</span></td>
<td><em>string</em></td>
<td><code>external</code></td>
</tr>
<tr><td colspan="3">The method for resolving unknown imports to Bazel dependencies. May be
<code>external</code>, <code>static</code> or <code>vendored</code>.
See <a href="#dependency-resolution">Dependency resolution</a>.</td>
</tr>
<tr><td><span>build_tags</span></td>
<td><em>string_list</em></td>
<td><code>[]</code></td>
</tr>
<tr><td colspan="3">The list of Go build tags that Gazelle should consider to always be true.</td>
</tr>
<tr><td><span>prefix</span></td>
<td><em>string</em></td>
<td><code>""</code></td>
</tr>
<tr><td colspan="3"><p dir="auto">The import path that corresponds to the repository root directory.</p>
<p dir="auto">Note: It's usually better to write a directive like
<code># gazelle:prefix example.com/repo</code> in your build file instead of setting
this attribute.</p>
</td>
</tr>
<tr><td><span>extra_args</span></td>
<td><em>string_list</em></td>
<td><code>[]</code></td>
</tr>
<tr><td colspan="3">A list of extra command line arguments passed to Gazelle.  Note that
<code>extra_args</code> are suppressed by extra command line args (e.g.
<code>bazel run //:gazelle -- subdir</code>).
See <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="448562916" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/bazel-gazelle/issues/536" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/bazel-gazelle/issues/536/hovercard" href="https://github.com/bazel-contrib/bazel-gazelle/issues/536">#536</a> for explanation.</td>
</tr>
<tr><td><span>command</span></td>
<td><em>string</em></td>
<td><code>update</code></td>
</tr>
<tr><td colspan="3">The Gazelle command to use. May be <code>fix</code>, <code>update</code> or
<code>update-repos</code>.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<a name="user-content-fix-and-update"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id13"><code>fix</code> and <code>update</code></a></h3><a id="user-content-fix-and-update" class="anchor" aria-label="Permalink: fix and update" href="#fix-and-update"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>update</code> command is the most common way of running Gazelle. Gazelle
scans sources in directories throughout the repository, then creates and updates
build files.</p>
<p dir="auto">The <code>fix</code> command does everything <code>update</code> does, but it also fixes
deprecated usage of rules, analogous to <code>go fix</code>. For example, <code>cgo_library</code>
will be consolidated with <code>go_library</code>. This command may delete or rename
rules, so it's not on by default. See <a href="#fix-command-transformations">Fix command transformations</a>
for details.</p>
<p dir="auto">Both commands accept a list of directories to process as positional arguments.
If no directories are specified, Gazelle will process the current directory.
Subdirectories will be processed recursively by default (unless <code>-r=false</code>).</p>
<p dir="auto">The following flags are accepted:</p>
<a name="user-content-update-repos"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id14"><code>update-repos</code></a></h3><a id="user-content-update-repos" class="anchor" aria-label="Permalink: update-repos" href="#update-repos"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>update-repos</code> command updates repository rules.  It can write the rules
to either the WORKSPACE (by default) or a .bzl file macro function.  It can be
used to add new repository rules or update existing rules to the specified
version. It can also import repository rules from a <code>go.mod</code> or a <code>go.work</code>
file.</p>
<p dir="auto">WARNING: This command is mainly used for managing external Go dependencies in Bazel's WORKSPACE mode.
For managing external Go dependencies in Bazel's BzlMod mode, please check: <a href="https://github.com/bazelbuild/rules_go/blob/master/docs/go/core/bzlmod.md#external-dependencies">https://github.com/bazelbuild/rules_go/blob/master/docs/go/core/bzlmod.md#external-dependencies</a></p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Add or update a repository to latest version by import path
$ gazelle update-repos example.com/new/repo

# Add or update a repository to specified version/commit by import path
$ gazelle update-repos example.com/new/repo@v1.3.1

# Import repositories from go.mod
$ gazelle update-repos -from_file=go.mod

# Import repositories from go.work
$ gazelle update-repos -from_file=go.work

# Import repositories from go.mod and update macro
$ gazelle update-repos -from_file=go.mod -to_macro=repositories.bzl%go_repositories

# Import repositories from go.work and update macro
$ gazelle update-repos -from_file=go.work -to_macro=repositories.bzl%go_repositories"><pre><span class="pl-c"><span class="pl-c">#</span> Add or update a repository to latest version by import path</span>
$ gazelle update-repos example.com/new/repo

<span class="pl-c"><span class="pl-c">#</span> Add or update a repository to specified version/commit by import path</span>
$ gazelle update-repos example.com/new/repo@v1.3.1

<span class="pl-c"><span class="pl-c">#</span> Import repositories from go.mod</span>
$ gazelle update-repos -from_file=go.mod

<span class="pl-c"><span class="pl-c">#</span> Import repositories from go.work</span>
$ gazelle update-repos -from_file=go.work

<span class="pl-c"><span class="pl-c">#</span> Import repositories from go.mod and update macro</span>
$ gazelle update-repos -from_file=go.mod -to_macro=repositories.bzl%go_repositories

<span class="pl-c"><span class="pl-c">#</span> Import repositories from go.work and update macro</span>
$ gazelle update-repos -from_file=go.work -to_macro=repositories.bzl%go_repositories</pre></div>
<p dir="auto">The following flags are accepted:</p>
<markdown-accessiblity-table><table>




<thead valign="bottom">
<tr><th><strong>Name</strong></th>
<th><strong>Default value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td><code>-from_file lock-file</code></td>
<td> </td>
</tr>
<tr><td colspan="2"><p dir="auto">Import repositories from a file as <a href="repository.md#go_repository">go_repository</a> rules. These rules will be added to the bottom of the WORKSPACE file or merged with existing rules.</p>
<p dir="auto">The lock file format is inferred from the file name. <code>go.mod</code> and <code>go.work</code> are all supported.</p>
</td>
</tr>
<tr><td><code>-repo_root dir</code></td>
<td> </td>
</tr>
<tr><td colspan="2"><p dir="auto">The root directory of the repository. Gazelle normally infers this to be the directory containing the WORKSPACE file.</p>
<p dir="auto">Gazelle will not process packages outside this directory.</p>
</td>
</tr>
<tr><td><code>-to_macro macroFile%defName</code></td>
<td> </td>
</tr>
<tr><td colspan="2"><p dir="auto">Tells Gazelle to write new repository rules into a .bzl macro function rather than the WORKSPACE file.</p>
<p dir="auto">The <code>repository_macro</code> directive should be added to the WORKSPACE in order for future Gazelle calls to recognize the repos defined in the macro file.</p>
</td>
</tr>
<tr><td><code>-prune true|false</code></td>
<td><code>false</code></td>
</tr>
<tr><td colspan="2"><p dir="auto">When true, Gazelle will remove <a href="repository.md#go_repository">go_repository</a> rules that no longer have equivalent repos in the <code>go.mod</code> file.</p>
<p dir="auto">This flag can only be used with <code>-from_file</code>.</p>
</td>
</tr>
<tr><td><code>-build_directives arg1,arg2,...</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_directives attribute</code> for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
<tr><td><code>-build_external external|vendored</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_external</code> attribute for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
<tr><td><code>-build_extra_args arg1,arg2,...</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_extra_args attribute</code> for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
<tr><td><code>-build_file_generation auto|on|off|clean</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_file_generation</code> attribute for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
<tr><td><code>-build_file_names file1,file2,...</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_file_name</code> attribute for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
<tr><td><code>-build_file_proto_mode default|package|legacy|disable|disable_global</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_file_proto_mode</code> attribute for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
<tr><td><code>-build_tags tag1,tag2,...</code></td>
<td> </td>
</tr>
<tr><td colspan="2">Sets the <code>build_tags</code> attribute for the generated <a href="repository.md#go_repository">go_repository</a> rule(s).</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<a name="user-content-directives"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id15">Directives</a></h3><a id="user-content-directives" class="anchor" aria-label="Permalink: Directives" href="#directives"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle can be configured with <em>directives</em>, which are written as top-level
comments in build files. Most options that can be set on the command line
can also be set using directives. Some options can only be set with
directives.</p>
<p dir="auto">Directive comments have the form <code># gazelle:key value</code>. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)

# gazelle:prefix github.com/example/project
# gazelle:build_file_name BUILD,BUILD.bazel

go_library(
    name = &quot;go_default_library&quot;,
    srcs = [&quot;example.go&quot;],
    importpath = &quot;github.com/example/project&quot;,
    visibility = [&quot;//visibility:public&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_go//go:def.bzl"</span>, <span class="pl-s">"go_library"</span>)

<span class="pl-c"># gazelle:prefix github.com/example/project</span>
<span class="pl-c"># gazelle:build_file_name BUILD,BUILD.bazel</span>

<span class="pl-en">go_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"go_default_library"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"example.go"</span>],
    <span class="pl-s1">importpath</span> <span class="pl-c1">=</span> <span class="pl-s">"github.com/example/project"</span>,
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:public"</span>],
)</pre></div>
<p dir="auto">Directives apply in the directory where they are set <em>and</em> in subdirectories.
This means, for example, if you set <code># gazelle:prefix</code> in the build file
in your project's root directory, it affects your whole project. If you
set it in a subdirectory, it only affects rules in that subtree.</p>
<p dir="auto">The following directives are recognized:</p>
<p dir="auto">Gazelle also reads directives from the WORKSPACE file. They may be used to
discover custom repository names and known prefixes. The <code>fix</code> and <code>update</code>
commands use these directives for dependency resolution. <code>update-repos</code> uses
them to learn about repository rules defined in alternate locations.</p>
<markdown-accessiblity-table><table>




<thead valign="bottom">
<tr><th><strong>WORKSPACE Directive</strong></th>
<th><strong>Default value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr><td><code># gazelle:repository_macro [+]macroFile%defName</code></td>
<td>n/a</td>
</tr>
<tr><td colspan="2"><p dir="auto">Tells Gazelle to look for repository rules in a macro in a .bzl file. The directive can be
repeated multiple times.
The macro can be generated by calling <code>update-repos</code> with the <code>to_macro</code> flag.</p>
<p dir="auto">The directive can be prepended with a "+", which will tell Gazelle to also look for repositories
within any macros called by the specified macro.</p>
</td>
</tr>
<tr><td><code># gazelle:repository rule_kind attr1_name=attr1_value ...</code></td>
<td>n/a</td>
</tr>
<tr><td colspan="2"><p dir="auto">Specifies a repository rule that Gazelle should know about. The directive can be repeated multiple times,
and can be declared from within a macro definition that Gazelle knows about. At the very least the
directive must define a rule kind and a name attribute, but it can define extra attributes after that.</p>
<p dir="auto">This is useful for teaching Gazelle about repos declared in external macros. The directive can also be used
to override an actual repository rule. For example, a <code>git_repository</code> rule for <code>org_golang_x_tools</code>
could be overriden with the directive:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:repository go_repository name=org_golang_x_tools importpath=golang.org/x/tools"><pre><span class="pl-c"># gazelle:repository go_repository name=org_golang_x_tools importpath=golang.org/x/tools</span></pre></div>
<p dir="auto">Gazelle would then proceed as if <code>org_golang_x_tools</code> was declared as a <code>go_repository</code> rule.</p>
</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<a name="user-content-keep-comments"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a href="#id16">Keep comments</a></h3><a id="user-content-keep-comments" class="anchor" aria-label="Permalink: Keep comments" href="#keep-comments"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In addition to directives, Gazelle supports <code># keep</code> comments that protect
parts of build files from being modified. <code># keep</code> may be written before
a rule, before an attribute, or after a string within a list.</p>
<p dir="auto"><code># keep</code> comments might take one of 2 forms; the <code># keep</code> literal or a
description prefixed by <code># keep:</code>.</p>
<a name="user-content-example"></a>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Example</h4><a id="user-content-example" class="anchor" aria-label="Permalink: Example" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Suppose you have a library that includes a generated .go file. Gazelle won't
know what imports to resolve, so you may need to add dependencies manually with
<code># keep</code> comments.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)
load(&quot;@com_github_example_gen//:gen.bzl&quot;, &quot;gen_go_file&quot;)

gen_go_file(
    name = &quot;magic&quot;,
    srcs = [&quot;magic.go.in&quot;],
    outs = [&quot;magic.go&quot;],
)

go_library(
    name = &quot;go_default_library&quot;,
    srcs = [&quot;magic.go&quot;],
    visibility = [&quot;//visibility:public&quot;],
    deps = [
        &quot;@com_github_example_gen//:go_default_library&quot;,  # keep
        &quot;@com_github_example_gen//a/b/c:go_default_library&quot;,  # keep: this is also important
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_go//go:def.bzl"</span>, <span class="pl-s">"go_library"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@com_github_example_gen//:gen.bzl"</span>, <span class="pl-s">"gen_go_file"</span>)

<span class="pl-en">gen_go_file</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"magic"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"magic.go.in"</span>],
    <span class="pl-s1">outs</span> <span class="pl-c1">=</span> [<span class="pl-s">"magic.go"</span>],
)

<span class="pl-en">go_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"go_default_library"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"magic.go"</span>],
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:public"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@com_github_example_gen//:go_default_library"</span>,  <span class="pl-c"># keep</span>
        <span class="pl-s">"@com_github_example_gen//a/b/c:go_default_library"</span>,  <span class="pl-c"># keep: this is also important</span>
    ],
)</pre></div>
<a name="user-content-dependency-resolution"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id17">Dependency resolution</a></h2><a id="user-content-dependency-resolution" class="anchor" aria-label="Permalink: Dependency resolution" href="#dependency-resolution"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">One of Gazelle's most important jobs is resolving library import strings
(like <code>import "golang.org/x/sys/unix"</code>) to Bazel labels (like
<code>@org_golang_x_sys//unix:go_default_library</code>). Gazelle follows the rules
below to resolve dependencies:</p>
<ol dir="auto">
<li>If the import to be resolved is part of a standard library, no explicit
dependency is written. For example, in Go, you don't need to declare
that you depend on <code>"fmt"</code>.</li>
<li>If a <code># gazelle:resolve</code> directive matches the import to be resolved,
the label at the end of the directive will be used.</li>
<li>If proto rule generation is enabled, special rules will be used when
importing certain libraries. These rules may be disabled by adding
<code># gazelle:proto disable_global</code> to a build file (this will affect
subdirectories, too) or by passing <code>-proto disable_global</code> on the
command line.<ol dir="auto">
<li>Imports of Well Known Types are mapped to rules in
<code>@io_bazel_rules_go//proto/wkt</code>.</li>
<li>Imports of <code>github.com/golang/protobuf/ptypes</code>, <code>descriptor</code>, and
<code>jsonpb</code> are mapped to special rules in <code>@com_github_golang_protobuf</code>.
See <a href="https://github.com/bazelbuild/rules_go/blob/master/proto/core.rst#avoiding-conflicts">Avoiding conflicts with proto rules</a>.</li>
</ol>
</li>
<li>If the import to be resolved is in the library index, the import will be resolved
to that library. If <code>-index=all</code>, Gazelle builds an index of library rules in
the current repository before starting dependency resolution. This can take a
while, since Gazelle visits every directory in the repository. If
<code>-index=lazy</code>, then language extensions may hint at specific directories
to visit, which can be much faster.<ol dir="auto">
<li>For Go, the match is based on the <code>importpath</code> attribute.</li>
<li>For proto, the match is based on the <code>srcs</code> attribute.</li>
</ol>
</li>
<li>If <code>-index=none</code> and a package is imported that has the current <code>go_prefix</code>
as a prefix, Gazelle generates a label following a convention. For example, if
the build file in <code>//src</code> set the prefix with
<code># gazelle:prefix example.com/repo/foo</code>, and you import the library
<code>"example.com/repo/foo/bar</code>, the dependency will be
<code>"//src/foo/bar:go_default_library"</code>.</li>
<li>Otherwise, Gazelle will use the current <code>external</code> mode to resolve
the dependency.<ol dir="auto">
<li>In <code>external</code> mode (the default), Gazelle will transform the import
string into an external repository label. For example,
<code>"golang.org/x/sys/unix"</code> would be resolved to
<code>"@org_golang_x_sys//unix:go_default_library"</code>. Gazelle does not confirm
whether the external repository is actually declared in WORKSPACE,
but if there <em>is</em> a <code>go_repository</code> in WORKSPACE with a matching
<code>importpath</code>, Gazelle will use its name. Gazelle does not index
rules in external repositories, so it's possible the resolved dependency
does not exist.</li>
<li>In <code>static</code> mode, Gazelle has the same behavior as <code>external</code> mode,
except that it will not call out to the network for resolution when no
matching import is found within WORKSPACE. Instead, it will skip the
unknown import. This is the default mode for <code>go_repository</code> rules.</li>
<li>In <code>vendored</code> mode, Gazelle will transform the import string into
a label in the vendor directory. For example, <code>"golang.org/x/sys/unix"</code>
would be resolved to
<code>"//vendor/golang.org/x/sys/unix:go_default_library"</code>. This mode is
usually not necessary, since vendored libraries will be indexed and
resolved using rule 4.</li>
</ol>
</li>
</ol>
<a name="user-content-fix-command-transformations"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto"><a href="#id18">Fix command transformations</a></h2><a id="user-content-fix-command-transformations" class="anchor" aria-label="Permalink: Fix command transformations" href="#fix-command-transformations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle will generate and update build files when invoked with either
<code>gazelle update</code> or <code>gazelle fix</code> (<code>update</code> is the default). Both commands
perform several transformations to fix deprecated usage of the Go rules.
<code>update</code> performs a safe set of tranformations, while <code>fix</code> performs some
additional transformations that may delete or rename rules.</p>
<p dir="auto">The following transformations are performed:</p>
<p dir="auto"><strong>Migrate library to embed (fix and update):</strong> Gazelle replaces <code>library</code>
attributes with <code>embed</code> attributes.</p>
<p dir="auto"><strong>Migrate gRPC compilers (fix and update):</strong> Gazelle converts
<code>go_grpc_library</code> rules to <code>go_proto_library</code> rules with
<code>compilers = ["@io_bazel_rules_go//proto:go_grpc_v2"]</code>.</p>
<p dir="auto"><strong>Flatten srcs (fix and update):</strong> Gazelle converts <code>srcs</code> attributes that
use OS and architecture-specific <code>select</code> expressions to flat lists.
rules_go filters these sources anyway.</p>
<p dir="auto"><strong>Squash cgo libraries (fix only)</strong>: Gazelle will remove cgo_library rules
named <code>cgo_default_library</code> and merge their attributes with a <code>go_library</code>
rule in the same package named <code>go_default_library</code>. If no such <code>go_library</code>
rule exists, a new one will be created. Other <code>cgo_library</code> rules will not be
removed.</p>
<p dir="auto"><strong>Squash external tests (fix only)</strong>: Gazelle will squash <code>go_test</code> rules
named <code>go_default_xtest</code> into <code>go_default_test</code>. Earlier versions of
rules_go required internal and external tests to be built separately, but
this is no longer needed.</p>
<p dir="auto"><strong>Remove legacy protos (fix only)</strong>: Gazelle will remove usage of
<code>go_proto_library</code> rules loaded from
<code>@io_bazel_rules_go//proto:go_proto_library.bzl</code> and <code>filegroup</code> rules named
<code>go_default_library_protos</code>. Newly generated proto rules will take their
place. Since <code>filegroup</code> isn't needed anymore and <code>go_proto_library</code> has
different attributes and was always written by hand, Gazelle will not attempt to
merge anything from these rules with the newly generated rules.</p>
<p dir="auto">This transformation is only applied in the default proto mode. Since Gazelle
will run in legacy proto mode if <code>go_proto_library.bzl</code> is loaded, this
transformation is not usually applied. You can set the proto mode explicitly
using the directive <code># gazelle:proto default</code>.</p>
<p dir="auto"><strong>Update loads of gazelle rule (fix and update)</strong>: Gazelle will remove loads
of <code>gazelle</code> from <code>@io_bazel_rules_go//go:def.bzl</code>. It will automatically
add a load from <code>@bazel_gazelle//:def.bzl</code> if <code>gazelle</code> is not loaded
from another location.</p>

</article></div>