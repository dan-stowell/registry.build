<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/bufbuild/protovalidate/main/.github/buf-logo.svg"><img src="https://raw.githubusercontent.com/bufbuild/protovalidate/main/.github/buf-logo.svg" alt="The Buf logo" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">protovalidate</h1><a id="user-content-protovalidate" class="anchor" aria-label="Permalink: protovalidate" href="#protovalidate"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/bufbuild/protovalidate/actions/workflows/ci.yaml"><img src="https://github.com/bufbuild/protovalidate/actions/workflows/ci.yaml/badge.svg?branch=main" alt="CI" style="max-width: 100%;"></a>
<a href="https://buf.build/links/slack" rel="nofollow"><img src="https://camo.githubusercontent.com/ace1e0787e928fcc7a4d2e2bacc44be3be9410532c23bd07df161c7ce89e755f/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f536c61636b2d4275662d253233653031353633" alt="Slack" data-canonical-src="https://img.shields.io/badge/Slack-Buf-%23e01563" style="max-width: 100%;"></a>
<a href="https://buf.build/bufbuild/protovalidate" rel="nofollow"><img src="https://camo.githubusercontent.com/9747f10f052cde2fbae556cdabe2f8333e644ed52570ce55296fd0861e06c099/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4253522d4d6f64756c652d304336354543" alt="BSR" data-canonical-src="https://img.shields.io/badge/BSR-Module-0C65EC" style="max-width: 100%;"></a></p>
<p dir="auto"><code>protovalidate</code> is a series of libraries designed to validate Protobuf messages at
runtime based on user-defined validation rules. Powered by Google's Common
Expression Language (<a href="https://github.com/google/cel-spec">CEL</a>), it provides a
flexible and efficient foundation for defining and evaluating custom validation
rules. The primary goal of <code>protovalidate</code> is to help developers ensure data
consistency and integrity across the network without requiring generated code.</p>
<div class="markdown-alert markdown-alert-note" dir="auto"><p class="markdown-alert-title" dir="auto"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">If you are migrating from <a href="https://github.com/bufbuild/protoc-gen-validate">protoc-gen-validate</a>, read our <a href="https://buf.build/docs/migration-guides/migrate-from-protoc-gen-validate/" rel="nofollow">migration guide</a>.</p>
</div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">What is this repository?</h2><a id="user-content-what-is-this-repository" class="anchor" aria-label="Permalink: What is this repository?" href="#what-is-this-repository"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This repository is the core of the <code>protovalidate</code> project. It contains:</p>
<ul dir="auto">
<li><a href="https://buf.build/bufbuild/protovalidate/docs/main:buf.validate" rel="nofollow">The API definition</a>: used to describe validation constraints</li>
<li><a href="https://github.com/bufbuild/protovalidate/blob/main/docs">Documentation</a>: how to apply <code>protovalidate</code> effectively</li>
<li><a href="https://buf.build/docs/migration-guides/migrate-from-protoc-gen-validate/" rel="nofollow">Migration tooling</a>: incrementally migrate from <code>protoc-gen-validate</code></li>
<li><a href="https://github.com/bufbuild/protovalidate/tree/main/examples">Examples</a>: example <code>.proto</code> files using <code>protovalidate</code></li>
<li><a href="https://github.com/bufbuild/protovalidate/blob/main/docs/conformance.md">Conformance testing utilities</a>: for acceptance testing of <code>protovalidate</code> implementations</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Implementations</h3><a id="user-content-implementations" class="anchor" aria-label="Permalink: Implementations" href="#implementations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Runtime implementations of <code>protovalidate</code> can be found in their own repositories:</p>
<ul dir="auto">
<li>Go: <a href="https://github.com/bufbuild/protovalidate-go"><code>protovalidate-go</code></a> (beta release)</li>
<li>C++: <a href="https://github.com/bufbuild/protovalidate-cc"><code>protovalidate-cc</code></a> (beta release)</li>
<li>Java: <a href="https://github.com/bufbuild/protovalidate-java"><code>protovalidate-java</code></a> (beta release)</li>
<li>Python: <a href="https://github.com/bufbuild/protovalidate-python"><code>protovalidate-python</code></a> (beta release)</li>
<li>TypeScript: <code>protovalidate-ts</code> (coming soon)</li>
</ul>
<p dir="auto">Interested in adding support for another language? Check out our
<a href="https://github.com/bufbuild/protovalidate/blob/main/.github/CONTRIBUTING.md">Contributing Guidelines</a>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Import protovalidate</h3><a id="user-content-import-protovalidate" class="anchor" aria-label="Permalink: Import protovalidate" href="#import-protovalidate"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To define constraints within your Protobuf messages,
import <code>buf/validate/validate.proto</code> into your <code>.proto</code> files:</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

package my.package;

import &quot;buf/validate/validate.proto&quot;;"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">package</span> <span class="pl-s">my.package</span>;

<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Build with <a href="https://buf.build" rel="nofollow"><code>buf</code></a></h4><a id="user-content-build-with-buf" class="anchor" aria-label="Permalink: Build with buf" href="#build-with-buf"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add a dependency on <a href="https://buf.build/bufbuild/protovalidate" rel="nofollow"><code>buf.build/bufbuild/protovalidate</code></a> to your
module's <a href="https://buf.build/docs/configuration/v1/buf-yaml/#deps" rel="nofollow"><code>buf.yaml</code></a>:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="version: v1
# &lt;snip&gt;
deps:
  - buf.build/bufbuild/protovalidate
# &lt;snip&gt;"><pre><span class="pl-ent">version</span>: <span class="pl-c1">v1</span>
<span class="pl-c"><span class="pl-c">#</span> &lt;snip&gt;</span>
<span class="pl-ent">deps</span>:
  - <span class="pl-s">buf.build/bufbuild/protovalidate</span>
<span class="pl-c"><span class="pl-c">#</span> &lt;snip&gt;</span></pre></div>
<p dir="auto">After modifying your <code>buf.yaml</code>, don't forget to run <code>buf mod update</code> to ensure
your dependencies are up-to-date.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Build with <code>protoc</code></h4><a id="user-content-build-with-protoc" class="anchor" aria-label="Permalink: Build with protoc" href="#build-with-protoc"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add an import path (<code>-I</code> flag) pointing to the contents of the <code>proto/protovalidate</code>
directory to your invocation of <code>protoc</code>:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="protoc \
  -I ./vendor/protovalidate/proto/protovalidate \
  # &lt;snip&gt;"><pre>protoc \
  -I ./vendor/protovalidate/proto/protovalidate \
  <span class="pl-c"><span class="pl-c">#</span> &lt;snip&gt;</span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Implementing validation constraints</h3><a id="user-content-implementing-validation-constraints" class="anchor" aria-label="Permalink: Implementing validation constraints" href="#implementing-validation-constraints"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Validation constraints can be enforced using the <code>buf.validate</code> Protobuf package. The rules are specified directly in the <code>.proto</code> files.</p>
<p dir="auto">Let's consider a few examples:</p>
<ol dir="auto">
<li>
<p dir="auto"><strong>Scalar field validation:</strong> For a basic <code>User</code> message, we can enforce constraints such as a minimum length for the user's name.</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

import &quot;buf/validate/validate.proto&quot;;

message User {
  // User's name, must be at least 1 character long.
  string name = 1 [(buf.validate.field).string.min_len = 1];
}"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;

<span class="pl-k">message</span> <span class="pl-en">User</span> {
  <span class="pl-c">// User's name, must be at least 1 character long.</span>
  <span class="pl-k">string</span> <span class="pl-smi">name</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> [<span class="pl-c1">(buf.validate<span class="pl-c1">.field</span>)</span>.string<span class="pl-c1">.min_len</span> = <span class="pl-c1">1</span>];
}</pre></div>
</li>
<li>
<p dir="auto"><strong>Map field validation:</strong> For a <code>Product</code> message with a map of item quantities, we can ensure that all quantities are positive.</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

import &quot;buf/validate/validate.proto&quot;;

message Product {
  // Map of item quantities, all quantities must be positive.
  map&lt;string, int32&gt; item_quantities = 1 [(buf.validate.field).map.values.int32.gt = 0];
}"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;

<span class="pl-k">message</span> <span class="pl-en">Product</span> {
  <span class="pl-c">// Map of item quantities, all quantities must be positive.</span>
  <span class="pl-k">map</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">int32</span>&gt; <span class="pl-smi">item_quantities</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> [<span class="pl-c1">(buf.validate<span class="pl-c1">.field</span>)</span>.map.values.int32<span class="pl-c1">.gt</span> = <span class="pl-c1">0</span>];
}</pre></div>
</li>
<li>
<p dir="auto"><strong>Well-known type (WKT) validation:</strong> For the <code>User</code> message, we can add a constraint to ensure the <code>created_at</code> timestamp is in the past.</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

import &quot;google/protobuf/timestamp.proto&quot;;
import &quot;buf/validate/validate.proto&quot;;

message User {
  // User's creation date must be in the past.
  google.protobuf.Timestamp created_at = 1 [(buf.validate.field).timestamp.lt_now = true];
}"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">import</span> <span class="pl-s">"google/protobuf/timestamp.proto"</span>;
<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;

<span class="pl-k">message</span> <span class="pl-en">User</span> {
  <span class="pl-c">// User's creation date must be in the past.</span>
  <span class="pl-k">google.protobuf.Timestamp</span> <span class="pl-smi">created_at</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> [<span class="pl-c1">(buf.validate<span class="pl-c1">.field</span>)</span>.timestamp<span class="pl-c1">.lt_now</span> = <span class="pl-c1">true</span>];
}</pre></div>
</li>
</ol>
<p dir="auto">For more advanced or custom constraints, <code>protovalidate</code> allows for CEL expressions that can incorporate information across fields.</p>
<ol dir="auto">
<li>
<p dir="auto"><strong>Field-level expressions:</strong> We can enforce that a products' <code>price</code>, sent as a string, includes a currency symbol like "$" or "£". We want to ensure that the price is positive and the currency symbol is valid.</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

import &quot;buf/validate/validate.proto&quot;;

message Product {
  string price = 1 [(buf.validate.field).cel = {
    id: &quot;product.price&quot;,
    message: &quot;Price must be positive and include a valid currency symbol ($ or £)&quot;,
    expression: &quot;(this.startsWith('$') || this.startsWith('£')) &amp;&amp; double(this.substring(1)) &gt; 0&quot;
  }];
}"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;

<span class="pl-k">message</span> <span class="pl-en">Product</span> {
  <span class="pl-k">string</span> <span class="pl-smi">price</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> [<span class="pl-c1">(buf.validate<span class="pl-c1">.field</span>).cel</span> = {
    <span class="pl-k">id</span>: <span class="pl-s">"product.price"</span>,
    <span class="pl-k">message</span>: <span class="pl-s">"Price must be positive and include a valid currency symbol ($ or £)"</span>,
    <span class="pl-k">expression</span>: <span class="pl-s">"(this.startsWith('$') || this.startsWith('£')) &amp;&amp; double(this.substring(1)) &gt; 0"</span>
  }];
}</pre></div>
</li>
<li>
<p dir="auto"><strong>Message-level expressions:</strong> For a <code>Transaction</code> message, we can use a message-level CEL expression to ensure that the <code>delivery_date</code> is always after the <code>purchase_date</code>.</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

import &quot;google/protobuf/timestamp.proto&quot;;
import &quot;buf/validate/validate.proto&quot;;

message Transaction {
  google.protobuf.Timestamp purchase_date = 1;
  google.protobuf.Timestamp delivery_date = 2;

  option (buf.validate.message).cel = {
    id: &quot;transaction.delivery_date&quot;,
    message: &quot;Delivery date must be after purchase date&quot;,
    expression: &quot;this.delivery_date &gt; this.purchase_date&quot;
  };
}"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">import</span> <span class="pl-s">"google/protobuf/timestamp.proto"</span>;
<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;

<span class="pl-k">message</span> <span class="pl-en">Transaction</span> {
  <span class="pl-k">google.protobuf.Timestamp</span> <span class="pl-smi">purchase_date</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>;
  <span class="pl-k">google.protobuf.Timestamp</span> <span class="pl-smi">delivery_date</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>;

  <span class="pl-k">option</span> <span class="pl-c1">(buf.validate<span class="pl-c1">.message</span>).cel</span> <span class="pl-k">=</span> {
    <span class="pl-k">id</span>: <span class="pl-s">"transaction.delivery_date"</span>,
    <span class="pl-k">message</span>: <span class="pl-s">"Delivery date must be after purchase date"</span>,
    <span class="pl-k">expression</span>: <span class="pl-s">"this.delivery_date &gt; this.purchase_date"</span>
  };
}</pre></div>
</li>
<li>
<p dir="auto"><strong>Producing an error message in the expression:</strong> We can produce custom error messages directly in the CEL expressions. In this example, if the <code>age</code> is less than 18, the CEL expression will evaluate to the error message string.</p>
<div class="highlight highlight-source-proto notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="syntax = &quot;proto3&quot;;

import &quot;buf/validate/validate.proto&quot;;

message User {
  int32 age = 1 [(buf.validate.field).cel = {
    id: &quot;user.age&quot;,
    expression: &quot;this &lt; 18 ? 'User must be at least 18 years old': ''&quot;
  }];
}"><pre><span class="pl-k">syntax</span> <span class="pl-k">=</span> <span class="pl-s">"proto3"</span>;

<span class="pl-k">import</span> <span class="pl-s">"buf/validate/validate.proto"</span>;

<span class="pl-k">message</span> <span class="pl-en">User</span> {
  <span class="pl-k">int32</span> <span class="pl-smi">age</span> <span class="pl-k">=</span> <span class="pl-c1">1</span> [<span class="pl-c1">(buf.validate<span class="pl-c1">.field</span>).cel</span> = {
    <span class="pl-k">id</span>: <span class="pl-s">"user.age"</span>,
    <span class="pl-k">expression</span>: <span class="pl-s">"this &lt; 18 ? 'User must be at least 18 years old': ''"</span>
  }];
}</pre></div>
</li>
</ol>
<p dir="auto">Check out <a href="https://github.com/bufbuild/protovalidate/tree/main/examples"><code>examples</code></a> for examples on both standard constraints and custom CEL constraints.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Validate Messages</h3><a id="user-content-validate-messages" class="anchor" aria-label="Permalink: Validate Messages" href="#validate-messages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Once the messages are annotated with constraints, use one of the <a href="#implementations">supported language libraries</a> to validate; no additional code generation necessary.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Documentation</h2><a id="user-content-documentation" class="anchor" aria-label="Permalink: Documentation" href="#documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>protovalidate</code> provides a robust framework for validating Protobuf messages by
enforcing standard and custom constraints on various data types, and offering
detailed error information when validation violations occur. For a detailed
overview of all its components, the supported constraints, and how to use them
effectively, please refer to our <a href="docs/README.md">comprehensive documentation</a>.
The key components include:</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://github.com/bufbuild/protovalidate/blob/main/docs/standard-constraints.md"><strong>Standard Constraints</strong></a>: <code>protovalidate</code>
supports a wide range of standard
constraints for all field types as well as special functionality for the
Protobuf Well-Known-Types. You can apply these constraints to your Protobuf
messages to ensure they meet certain common conditions.</p>
</li>
<li>
<p dir="auto"><a href="https://github.com/bufbuild/protovalidate/blob/main/docs/custom-constraints.md"><strong>Custom Constraints</strong></a>: With Google's Common
Expression Language (CEL),
<code>protovalidate</code> allows you to create complex, custom constraints to
handle unique validation scenarios that aren't covered by the standard
constraints at both the field and message level.</p>
</li>
<li>
<p dir="auto"><a href="https://github.com/bufbuild/protovalidate/blob/main/docs/README.md#errors"><strong>Error Handling</strong></a>: When a violation
occurs, <code>protovalidate</code>provides
detailed error information to help you quickly identify the source and fix for
an issue.</p>
</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">protoc-gen-validate</h3><a id="user-content-protoc-gen-validate" class="anchor" aria-label="Permalink: protoc-gen-validate" href="#protoc-gen-validate"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>protovalidate</code> is the spiritual successor to <a href="https://github.com/bufbuild/protoc-gen-validate"><code>protoc-gen-validate</code></a>, offering
all of the same functionality present in the original plugin, without the need
for custom code generation, and the new ability to describe complex constraints in CEL.</p>
<p dir="auto"><code>protovalidate</code>'s constraints very closely emulate those
in <code>protoc-gen-validate</code> to ensure an easy transition for developers. To
migrate from <code>protoc-gen-validate</code> to <code>protovalidate</code>, use the
provided <a href="https://github.com/bufbuild/protovalidate/blob/main/tools/protovalidate-migrate">migration tool</a> to
incrementally upgrade your <code>.proto</code> files.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Ecosystem</h2><a id="user-content-ecosystem" class="anchor" aria-label="Permalink: Ecosystem" href="#ecosystem"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="https://buf.build" rel="nofollow">Buf</a></li>
<li><a href="https://github.com/google/cel-spec">CEL Specification</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Legal</h2><a id="user-content-legal" class="anchor" aria-label="Permalink: Legal" href="#legal"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Offered under the <a href="https://github.com/bufbuild/protovalidate/blob/main/LICENSE">Apache 2 license</a>.</p>
</article></div>