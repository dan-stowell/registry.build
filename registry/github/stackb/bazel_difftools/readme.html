<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a href="https://github.com/stackb/bazel_difftools/actions/workflows/ci.yaml"><img src="https://github.com/stackb/bazel_difftools/actions/workflows/ci.yaml/badge.svg" alt="CI" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">bazel_difftools</h1><a id="user-content-bazel_difftools" class="anchor" aria-label="Permalink: bazel_difftools" href="#bazel_difftools"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A tool to compare Bazel action query outputs with an interactive HTML report.
This is a re-imagination of the <a href="https://github.com/bazelbuild/bazel/blob/master/tools/aquery_differ/aquery_differ.py">Bazel
aquery_differ.py</a>
in Go with enhanced visualization features.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Features</h2><a id="user-content-features" class="anchor" aria-label="Permalink: Features" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Compare Bazel action graphs between builds or git commits</li>
<li>Interactive HTML reports with GitHub-style diff visualization</li>
<li>Syntax-highlighted diffs (unified diff and go-cmp formats)</li>
<li>Built-in web server with auto-open browser support</li>
<li>Native Bazel rules for integration into your build</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">As a Bazel Module</h3><a id="user-content-as-a-bazel-module" class="anchor" aria-label="Permalink: As a Bazel Module" href="#as-a-bazel-module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add to your <code>MODULE.bazel</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;bazel_difftools&quot;, version = &quot;0.0.0&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_difftools"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.0.0"</span>)</pre></div>
<blockquote>
<p dir="auto"><strong>Note</strong>: This module is not yet published to the Bazel Central Registry. For
now, use an <code>archive_override</code> or <code>git_override</code> pointing to this repository.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">As a Standalone Binary</h3><a id="user-content-as-a-standalone-binary" class="anchor" aria-label="Permalink: As a Standalone Binary" href="#as-a-standalone-binary"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Download a release artifact, or build from source:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/stackb/bazel_difftools.git
cd bazel_difftools
bazel build //cmd/aquerydiff"><pre>git clone https://github.com/stackb/bazel_difftools.git
<span class="pl-c1">cd</span> bazel_difftools
bazel build //cmd/aquerydiff</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using Bazel Rules</h3><a id="user-content-using-bazel-rules" class="anchor" aria-label="Permalink: Using Bazel Rules" href="#using-bazel-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Load the rules in your <code>BUILD.bazel</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_difftools//rules:defs.bzl&quot;, &quot;aquery_diff&quot;, &quot;aquery_git_diff&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_difftools//rules:defs.bzl"</span>, <span class="pl-s">"aquery_diff"</span>, <span class="pl-s">"aquery_git_diff"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Rule: <code>aquery_diff</code></h4><a id="user-content-rule-aquery_diff" class="anchor" aria-label="Permalink: Rule: aquery_diff" href="#rule-aquery_diff"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Compare two aquery output files:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="aquery_diff(
    name = &quot;compare_actions&quot;,
    before = &quot;before.pb&quot;,
    after = &quot;after.pb&quot;,
)"><pre><span class="pl-en">aquery_diff</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"compare_actions"</span>,
    <span class="pl-s1">before</span> <span class="pl-c1">=</span> <span class="pl-s">"before.pb"</span>,
    <span class="pl-s1">after</span> <span class="pl-c1">=</span> <span class="pl-s">"after.pb"</span>,
)</pre></div>
<p dir="auto"><strong>Attributes:</strong></p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>before</code></td>
<td><code>label</code></td>
<td><strong>required</strong></td>
<td>Baseline aquery file (<code>.pb</code>, <code>.proto</code>, <code>.textproto</code>, <code>.json</code>, <code>.jsonproto</code>)</td>
</tr>
<tr>
<td><code>after</code></td>
<td><code>label</code></td>
<td><strong>required</strong></td>
<td>Comparison aquery file (same format options)</td>
</tr>
<tr>
<td><code>match</code></td>
<td><code>string</code></td>
<td><code>"output_files"</code></td>
<td>Strategy to match before and after actions: <code>"output_files"</code> or <code>"mnemonic"</code></td>
</tr>
<tr>
<td><code>serve</code></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Start web server to view report</td>
</tr>
<tr>
<td><code>open</code></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Automatically open browser to report</td>
</tr>
<tr>
<td><code>unidiff</code></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Generate unified diffs (can be slow for large actions)</td>
</tr>
<tr>
<td><code>cmpdiff</code></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Generate go-cmp diffs (fast, structural comparison)</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Run the comparison:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel run //path/to:compare_actions"><pre>bazel run //path/to:compare_actions</pre></div>
<blockquote>
<p dir="auto"><strong>Performance Note</strong>: The <code>unidiff</code> attribute defaults to <code>False</code> because generating unified diffs can be prohibitively slow for large actions with many inputs/outputs. The <code>cmpdiff</code> format (enabled by default) is much faster and provides good structural comparison for most use cases. Only enable <code>unidiff</code> if you need the traditional unified diff format and are willing to wait for the additional processing time.</p>
</blockquote>
<p dir="auto"><strong>Choosing a Match Strategy:</strong></p>
<p dir="auto">The <code>match</code> attribute determines how actions are paired between the before and
after builds:</p>
<ul dir="auto">
<li>
<p dir="auto"><strong><code>output_files</code></strong> (default): Actions are matched by their output file paths.
Use this when comparing the same target across different commits or
configurations. This is the most common use case and ensures you're comparing
the exact same action that produces the same outputs.</p>
</li>
<li>
<p dir="auto"><strong><code>mnemonic</code></strong>: Actions are matched by their mnemonic (action type, e.g.,
"GoCompile", "CppCompile"). Use this when comparing different targets that use
similar build rules. For example, comparing <code>//old/pkg:binary</code> vs
<code>//new/pkg:binary</code> where both are <code>go_binary</code> targets but produce different
output paths. This helps identify how the same type of action differs between
targets.</p>
</li>
</ul>
<p dir="auto">Example using mnemonic matching:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="aquery_diff(
    name = &quot;compare_go_binaries&quot;,
    before = &quot;old_binary.pb&quot;,
    after = &quot;new_binary.pb&quot;,
    match = &quot;mnemonic&quot;,  # Compare by action type instead of output path
)"><pre><span class="pl-en">aquery_diff</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"compare_go_binaries"</span>,
    <span class="pl-s1">before</span> <span class="pl-c1">=</span> <span class="pl-s">"old_binary.pb"</span>,
    <span class="pl-s1">after</span> <span class="pl-c1">=</span> <span class="pl-s">"new_binary.pb"</span>,
    <span class="pl-s1">match</span> <span class="pl-c1">=</span> <span class="pl-s">"mnemonic"</span>,  <span class="pl-c"># Compare by action type instead of output path</span>
)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Rule: <code>aquery_git_diff</code></h4><a id="user-content-rule-aquery_git_diff" class="anchor" aria-label="Permalink: Rule: aquery_git_diff" href="#rule-aquery_git_diff"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Compare aquery outputs between git commits:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="aquery_git_diff(
    name = &quot;git_compare&quot;,
    before = &quot;main&quot;,
    after = &quot;feature-branch&quot;,
    target = &quot;//my/package:target&quot;,
)"><pre><span class="pl-en">aquery_git_diff</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"git_compare"</span>,
    <span class="pl-s1">before</span> <span class="pl-c1">=</span> <span class="pl-s">"main"</span>,
    <span class="pl-s1">after</span> <span class="pl-c1">=</span> <span class="pl-s">"feature-branch"</span>,
    <span class="pl-s1">target</span> <span class="pl-c1">=</span> <span class="pl-s">"//my/package:target"</span>,
)</pre></div>
<p dir="auto"><strong>Attributes:</strong></p>
<p dir="auto">Same as <code>aquery_diff</code>, plus:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>target</code></td>
<td><code>string</code></td>
<td><strong>required</strong></td>
<td>Bazel target to aquery (e.g., <code>//pkg:binary</code>, <code>deps(...)</code>)</td>
</tr>
<tr>
<td><code>bazel</code></td>
<td><code>string</code></td>
<td><code>"bazel"</code></td>
<td>Path to bazel executable</td>
</tr>
<tr>
<td><code>before</code></td>
<td><code>string</code></td>
<td><strong>required</strong></td>
<td>Git commit/branch/tag for baseline</td>
</tr>
<tr>
<td><code>after</code></td>
<td><code>string</code></td>
<td><strong>required</strong></td>
<td>Git commit/branch/tag for comparison</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">This rule will:</p>
<ol dir="auto">
<li>Check for uncommitted changes (fails if found)</li>
<li>Checkout <code>before</code> commit and run <code>bazel aquery</code></li>
<li>Checkout <code>after</code> commit and run <code>bazel aquery</code></li>
<li>Restore original commit</li>
<li>Generate comparison report</li>
</ol>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using the CLI</h3><a id="user-content-using-the-cli" class="anchor" aria-label="Permalink: Using the CLI" href="#using-the-cli"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Generate aquery files using Bazel:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Binary proto format (recommended for large graphs)
bazel aquery //pkg:target --output=proto &gt; before.pb

# Text proto format (human-readable)
bazel aquery //pkg:target --output=textproto &gt; before.textproto

# JSON proto format
bazel aquery //pkg:target --output=jsonproto &gt; before.json"><pre><span class="pl-c"><span class="pl-c">#</span> Binary proto format (recommended for large graphs)</span>
bazel aquery //pkg:target --output=proto <span class="pl-k">&gt;</span> before.pb

<span class="pl-c"><span class="pl-c">#</span> Text proto format (human-readable)</span>
bazel aquery //pkg:target --output=textproto <span class="pl-k">&gt;</span> before.textproto

<span class="pl-c"><span class="pl-c">#</span> JSON proto format</span>
bazel aquery //pkg:target --output=jsonproto <span class="pl-k">&gt;</span> before.json</pre></div>
<blockquote>
<p dir="auto"><strong>Supported formats</strong>: The tool automatically detects format based on file extension:</p>
<ul dir="auto">
<li>Binary: <code>.pb</code>, <code>.proto</code></li>
<li>Text: <code>.textproto</code></li>
<li>JSON: <code>.json</code>, <code>.jsonproto</code></li>
</ul>
</blockquote>
<p dir="auto">Run the comparison:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="aquerydiff \
  --before before.pb \
  --after after.pb \
  --report_dir ./output \
  --serve \
  --open"><pre>aquerydiff \
  --before before.pb \
  --after after.pb \
  --report_dir ./output \
  --serve \
  --open</pre></div>
<p dir="auto"><strong>CLI Flags:</strong></p>
<ul dir="auto">
<li><code>--before</code> - Path to baseline aquery file</li>
<li><code>--after</code> - Path to comparison aquery file</li>
<li><code>--report_dir</code> - Directory to write HTML report</li>
<li><code>--match</code> - Matching strategy: <code>output_files</code> (default) or <code>mnemonic</code></li>
<li><code>--serve</code> - Start web server (default: true)</li>
<li><code>--open</code> - Open browser automatically (default: true)</li>
<li><code>--unidiff</code> - Generate unified diffs (default: false)</li>
<li><code>--cmpdiff</code> - Generate go-cmp diffs (default: true)</li>
</ul>
<blockquote>
<p dir="auto"><strong>Note</strong>: The report title is automatically derived from the most common target in the action graph.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Report Output</h3><a id="user-content-report-output" class="anchor" aria-label="Permalink: Report Output" href="#report-output"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The HTML report shows:</p>
<ul dir="auto">
<li><strong>Actions only in before</strong> - Removed actions</li>
<li><strong>Actions only in after</strong> - New actions</li>
<li><strong>Non-equal actions</strong> - Actions with changes</li>
<li><strong>Equal actions</strong> - Unchanged actions</li>
</ul>
<p dir="auto">Each action displays:</p>
<ul dir="auto">
<li>Mnemonic (action type)</li>
<li>Output files</li>
<li>Links to before/after JSON/textproto representations</li>
<li>Colorized diffs (unified and/or go-cmp format)</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/50580/209453563-064db4dd-4068-4d2f-8bb3-35c425bfb8b5.png"><img width="934" alt="Example report showing action comparison" src="https://user-images.githubusercontent.com/50580/209453563-064db4dd-4068-4d2f-8bb3-35c425bfb8b5.png" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Example</h2><a id="user-content-example" class="anchor" aria-label="Permalink: Example" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See the <a href="examples/simple">examples/simple</a> directory for working examples using both rules.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contributing</h2><a id="user-content-contributing" class="anchor" aria-label="Permalink: Contributing" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Contributions welcome! Please open an issue or pull request.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">License</h2><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Apache 2.0</p>
</article></div>