<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">rules_tsickle</h1><a id="user-content-rules_tsickle" class="anchor" aria-label="Permalink: rules_tsickle" href="#rules_tsickle"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">What?</h2><a id="user-content-what" class="anchor" aria-label="Permalink: What?" href="#what"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_tsickle</code> provides a <code>closure_ts_compile</code> rule that transforms <code>.ts</code> files
into closure-annotated <code>.js</code> files.  It contains a vendored copy of
<a href="https://github.com/angular/tsickle">https://github.com/angular/tsickle</a> (which was archived in May 2025).</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Why?</h2><a id="user-content-why" class="anchor" aria-label="Permalink: Why?" href="#why"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The primary reason <code>rules_tsickle</code> was created was to perform <code>.ts</code> to <code>.js</code>
translation of <a href="https://github.com/google/safevalues">https://github.com/google/safevalues</a> for
<a href="https://github.com/google/closure-templates/tree/master/javascript">https://github.com/google/closure-templates/tree/master/javascript</a>.  Several
of the <code>soyutils</code> files in that repo have closure dependencies like:</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="goog.require('google3.third_party.javascript.safevalues.index');"><pre><span class="pl-s1">goog</span><span class="pl-kos">.</span><span class="pl-en">require</span><span class="pl-kos">(</span><span class="pl-s">'google3.third_party.javascript.safevalues.index'</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<p dir="auto">No open-source copy of the translated <code>.js</code> files could be located, so
<code>rules_tsickle</code> was created to perform that translation.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">How?</h2><a id="user-content-how" class="anchor" aria-label="Permalink: How?" href="#how"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use <code>rules_tsickle</code> in your own bazel workspace (lookup most recent version):</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(&quot;rules_tsickle&quot;, version = &quot;0.0.0&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s">"rules_tsickle"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.0.0"</span>)</pre></div>
<p dir="auto">Then, in a package containing <code>.ts</code> and/or <code>.d.ts</code> files:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;//rules:defs.bzl&quot;, &quot;closure_ts_compile&quot;)

closure_ts_compile(
    name = &quot;index&quot;,
    srcs = [&quot;index.ts&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"//rules:defs.bzl"</span>, <span class="pl-s">"closure_ts_compile"</span>)

<span class="pl-en">closure_ts_compile</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"index"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"index.ts"</span>],
)</pre></div>
<p dir="auto"><code>bazel build :index</code> will:</p>
<ul dir="auto">
<li>download npm deps and prepare the <code>js_binary</code> tsickle runner
(<code>//tools/tsicklecompiler</code>).</li>
<li>run the tool, which roughly works as follows:
<ul dir="auto">
<li>prepare an internal/minimal <code>tsconfig.json</code> configuration.</li>
<li>runs <code>tsc</code> over the inputs to generate a <code>ts.Program</code></li>
<li>runs tsickle over the <code>ts.Program</code> to AST-rewrite/transform it.</li>
<li>emits the transformed <code>.js</code> files.</li>
</ul>
</li>
<li>output files:
<ul dir="auto">
<li>each <code>{basename}.ts</code> will produce an equivalent <code>{basename}.js</code> file</li>
<li>if any <code>.d.ts</code> files are present, a single <code>{name}-externs.js</code> file will be
produced.</li>
</ul>
</li>
</ul>
<p dir="auto"><code>closure_ts_compile</code> can take <code>deps</code> on other <code>closure_ts_compile</code> rules.  The
source <code>.ts</code> files will be made available to <code>tsc</code>.  Only direct <code>.ts</code> files in
the primary rule will emitted.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Versioning</h3><a id="user-content-versioning" class="anchor" aria-label="Permalink: Versioning" href="#versioning"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>rules_tsickle</code> initial version is <code>1.0.0</code> not because of a long history of
development, but because it is anticipated this repo will not see a large amount
of future development.</p>
</article></div>