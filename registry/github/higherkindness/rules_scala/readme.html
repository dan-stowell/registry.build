<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">higherkindness/rules_scala</h1><a id="user-content-higherkindnessrules_scala" class="anchor" aria-label="Permalink: higherkindness/rules_scala" href="#higherkindnessrules_scala"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/higherkindness/rules_scala/actions"><img src="https://github.com/higherkindness/rules_scala/workflows/CI/badge.svg" alt="Build Status" style="max-width: 100%;"></a></p>
<p dir="auto"><code>higherkindness/rules_scala</code> evolved, in part, from the need for Bazel adoption support for large, monorepo Scala projects.
Bazel is wonderful because it makes use of parallelism and caching to vastly improve build times. However, to see these benefits, a project must first be broken down into
tiny packages and make use of fine-grained dependencies. This is not always a realistic short-term goal for large, monorepo Scala projects.</p>
<p dir="auto"><code>higherkindness/rules_scala</code> allows for the optional use of Zinc incremental compilation to provide a stepping stone for these projects as they migrate to Bazel.</p>
<p dir="auto"><code>higherkindness/rules_scala</code> is written with maintainability and accessibility in mind. It aims to facilitate the transition to Bazel, and to satisfy use cases throughout the Scala ecosystem.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Principles</h2><a id="user-content-principles" class="anchor" aria-label="Permalink: Principles" href="#principles"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li>Support the breadth of the Scala ecosystem.</li>
<li>Follow Bazel best practices.</li>
<li>Be accessible and maintainable.</li>
<li>Have high-quality documentation.</li>
</ol>
<p dir="auto">If the right design principles are kept, implementing additional features should be simple and straightforward.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Features</h2><a id="user-content-features" class="anchor" aria-label="Permalink: Features" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Simple core API modeled after Bazel's Java APIs
<ul dir="auto">
<li><a href="docs/stardoc/scala.md#scala_library">scala_library</a></li>
<li><a href="docs/stardoc/scala.md#scala_binary">scala_binary</a></li>
<li><a href="docs/stardoc/scala.md#scala_test">scala_test</a></li>
<li><a href="docs/stardoc/scala.md#scala_import">scala_import</a></li>
<li><a href="docs/stardoc/scala.md#scala_repl">scala_repl</a></li>
</ul>
</li>
<li><a href="docs/scala.md#tests">Works with all sbt-compatible test frameworks</a></li>
<li><a href="docs/scala.md#strict--unused-deps">Advanced Dependency Detection</a>
<ul dir="auto">
<li>Errors on indirect and unused dependencies</li>
<li>Buildozer suggestions for dependency errors</li>
</ul>
</li>
<li><a href="docs/scala.md#workers">Optional Worker strategy</a></li>
<li><a href="docs/stateful.md#stateful-compilation">Optional Zinc-based stateful incremental compilation</a></li>
<li><a href="docs/scalafmt.md#scalafmt">Scalafmt</a> integration</li>
<li>Protobuf support with ScalaPB
<ul dir="auto">
<li><a href="docs/stardoc/scala_proto.md#scala_proto_library">scala_proto_library</a></li>
<li><a href="docs/stardoc/scala_proto.md#scala_proto_toolchain">scala_proto_toolchain</a></li>
</ul>
</li>
<li>Seamless integration with the <a href="https://github.com/bazelbuild/intellij">Bazel IntelliJ plugin</a></li>
<li><a href="docs/newdocs/phases.md#customizing-the-core-rules">Customizable rules</a></li>
<li><a href="docs/newdocs/scala_versions.md#specifying-the-scala-version-to-use">Multiple Scala versions in one build</a>, including Scala 3 (Dotty).</li>
<li><a href="docs/newdocs/macros.md#macros-and-ijars">Optimal handling of macros and ijars</a></li>
<li><a href="docs/newdocs/zinc_flags.md">Pass flags to Zinc compiler</a></li>
<li>Modern implementation using Bazel's most idiomatic APIs</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">WORKSPACE</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

# Load rules scala annex
rules_scala_annex_version = &quot;ae99fcb08bbddfc24fef00d7b13f6c065e1df8d5&quot;
rules_scala_annex_sha256 = &quot;1630fc7ecc7a4ffeabcdef73c7600eab9cf3fd2377db1f69b8ce1927560211ff&quot;
http_archive(
    name = &quot;rules_scala_annex&quot;,
    sha256 = rules_scala_annex_sha256,
    strip_prefix = &quot;rules_scala-{}&quot;.format(rules_scala_annex_version),
    url = &quot;https://github.com/higherkindness/rules_scala/archive/{}.zip&quot;.format(rules_scala_annex_version),
)

rules_jvm_external_tag = &quot;2.9&quot;
rules_jvm_external_sha256 = &quot;e5b97a31a3e8feed91636f42e19b11c49487b85e5de2f387c999ea14d77c7f45&quot;
http_archive(
    name = &quot;rules_jvm_external&quot;,
    sha256 = rules_jvm_external_sha256,
    strip_prefix = &quot;rules_jvm_external-{}&quot;.format(rules_jvm_external_tag),
    url = &quot;https://github.com/bazelbuild/rules_jvm_external/archive/{}.zip&quot;.format(rules_jvm_external_tag),
)

load(&quot;@rules_scala_annex//rules/scala:workspace.bzl&quot;, &quot;scala_register_toolchains&quot;, &quot;scala_repositories&quot;)
scala_repositories()
load(&quot;@annex//:defs.bzl&quot;, annex_pinned_maven_install = &quot;pinned_maven_install&quot;)
annex_pinned_maven_install()
scala_register_toolchains()

load(&quot;@rules_scala_annex//rules/scalafmt:workspace.bzl&quot;, &quot;scalafmt_default_config&quot;, &quot;scalafmt_repositories&quot;)
scalafmt_repositories()
load(&quot;@annex_scalafmt//:defs.bzl&quot;, annex_scalafmt_pinned_maven_install = &quot;pinned_maven_install&quot;)
annex_scalafmt_pinned_maven_install()
scalafmt_default_config()

load(&quot;@rules_scala_annex//rules/scala_proto:workspace.bzl&quot;, &quot;scala_proto_register_toolchains&quot;, &quot;scala_proto_repositories&quot;,)
scala_proto_repositories()
load(&quot;@annex_proto//:defs.bzl&quot;, annex_proto_pinned_maven_install = &quot;pinned_maven_install&quot;)
annex_proto_pinned_maven_install()
scala_proto_register_toolchains()

# Load bazel skylib and google protobuf
bazel_skylib_tag = &quot;1.0.2&quot;
bazel_skylib_sha256 = &quot;97e70364e9249702246c0e9444bccdc4b847bed1eb03c5a3ece4f83dfe6abc44&quot;
http_archive(
    name = &quot;bazel_skylib&quot;,
    sha256 = bazel_skylib_sha256,
    urls = [
        &quot;https://mirror.bazel.build/github.com/bazelbuild/bazel-skylib/releases/download/{tag}/bazel-skylib-{tag}.tar.gz&quot;.format(tag = bazel_skylib_tag),
        &quot;https://github.com/bazelbuild/bazel-skylib/releases/download/{tag}/bazel-skylib-{tag}.tar.gz&quot;.format(tag = bazel_skylib_tag),
    ],
)

protobuf_tag = &quot;3.10.1&quot;
protobuf_sha256 = &quot;678d91d8a939a1ef9cb268e1f20c14cd55e40361dc397bb5881e4e1e532679b1&quot;
http_archive(
    name = &quot;com_google_protobuf&quot;,
    sha256 = protobuf_sha256,
    strip_prefix = &quot;protobuf-{}&quot;.format(protobuf_tag),
    type = &quot;zip&quot;,
    url = &quot;https://github.com/protocolbuffers/protobuf/archive/v{}.zip&quot;.format(protobuf_tag),
)

load(&quot;@com_google_protobuf//:protobuf_deps.bzl&quot;, &quot;protobuf_deps&quot;)
protobuf_deps()

# Specify the scala compiler we wish to use; in this case, we'll use the default one specified in rules_scala_annex
bind(
    name = &quot;default_scala&quot;,
    actual = &quot;@rules_scala_annex//src/main/scala:zinc_2_12_10&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-c"># Load rules scala annex</span>
<span class="pl-s1">rules_scala_annex_version</span> <span class="pl-c1">=</span> <span class="pl-s">"ae99fcb08bbddfc24fef00d7b13f6c065e1df8d5"</span>
<span class="pl-s1">rules_scala_annex_sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"1630fc7ecc7a4ffeabcdef73c7600eab9cf3fd2377db1f69b8ce1927560211ff"</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala_annex"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s1">rules_scala_annex_sha256</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala-{}"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">rules_scala_annex_version</span>),
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/higherkindness/rules_scala/archive/{}.zip"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">rules_scala_annex_version</span>),
)

<span class="pl-s1">rules_jvm_external_tag</span> <span class="pl-c1">=</span> <span class="pl-s">"2.9"</span>
<span class="pl-s1">rules_jvm_external_sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"e5b97a31a3e8feed91636f42e19b11c49487b85e5de2f387c999ea14d77c7f45"</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_jvm_external"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s1">rules_jvm_external_sha256</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_jvm_external-{}"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">rules_jvm_external_tag</span>),
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/bazelbuild/rules_jvm_external/archive/{}.zip"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">rules_jvm_external_tag</span>),
)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala_annex//rules/scala:workspace.bzl"</span>, <span class="pl-s">"scala_register_toolchains"</span>, <span class="pl-s">"scala_repositories"</span>)
<span class="pl-en">scala_repositories</span>()
<span class="pl-en">load</span>(<span class="pl-s">"@annex//:defs.bzl"</span>, <span class="pl-s1">annex_pinned_maven_install</span> <span class="pl-c1">=</span> <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">annex_pinned_maven_install</span>()
<span class="pl-en">scala_register_toolchains</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala_annex//rules/scalafmt:workspace.bzl"</span>, <span class="pl-s">"scalafmt_default_config"</span>, <span class="pl-s">"scalafmt_repositories"</span>)
<span class="pl-en">scalafmt_repositories</span>()
<span class="pl-en">load</span>(<span class="pl-s">"@annex_scalafmt//:defs.bzl"</span>, <span class="pl-s1">annex_scalafmt_pinned_maven_install</span> <span class="pl-c1">=</span> <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">annex_scalafmt_pinned_maven_install</span>()
<span class="pl-en">scalafmt_default_config</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala_annex//rules/scala_proto:workspace.bzl"</span>, <span class="pl-s">"scala_proto_register_toolchains"</span>, <span class="pl-s">"scala_proto_repositories"</span>,)
<span class="pl-en">scala_proto_repositories</span>()
<span class="pl-en">load</span>(<span class="pl-s">"@annex_proto//:defs.bzl"</span>, <span class="pl-s1">annex_proto_pinned_maven_install</span> <span class="pl-c1">=</span> <span class="pl-s">"pinned_maven_install"</span>)
<span class="pl-en">annex_proto_pinned_maven_install</span>()
<span class="pl-en">scala_proto_register_toolchains</span>()

<span class="pl-c"># Load bazel skylib and google protobuf</span>
<span class="pl-s1">bazel_skylib_tag</span> <span class="pl-c1">=</span> <span class="pl-s">"1.0.2"</span>
<span class="pl-s1">bazel_skylib_sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"97e70364e9249702246c0e9444bccdc4b847bed1eb03c5a3ece4f83dfe6abc44"</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_skylib"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s1">bazel_skylib_sha256</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://mirror.bazel.build/github.com/bazelbuild/bazel-skylib/releases/download/{tag}/bazel-skylib-{tag}.tar.gz"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">tag</span> <span class="pl-c1">=</span> <span class="pl-s1">bazel_skylib_tag</span>),
        <span class="pl-s">"https://github.com/bazelbuild/bazel-skylib/releases/download/{tag}/bazel-skylib-{tag}.tar.gz"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">tag</span> <span class="pl-c1">=</span> <span class="pl-s1">bazel_skylib_tag</span>),
    ],
)

<span class="pl-s1">protobuf_tag</span> <span class="pl-c1">=</span> <span class="pl-s">"3.10.1"</span>
<span class="pl-s1">protobuf_sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"678d91d8a939a1ef9cb268e1f20c14cd55e40361dc397bb5881e4e1e532679b1"</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"com_google_protobuf"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s1">protobuf_sha256</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf-{}"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">protobuf_tag</span>),
    <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-s">"zip"</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/protocolbuffers/protobuf/archive/v{}.zip"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">protobuf_tag</span>),
)

<span class="pl-en">load</span>(<span class="pl-s">"@com_google_protobuf//:protobuf_deps.bzl"</span>, <span class="pl-s">"protobuf_deps"</span>)
<span class="pl-en">protobuf_deps</span>()

<span class="pl-c"># Specify the scala compiler we wish to use; in this case, we'll use the default one specified in rules_scala_annex</span>
<span class="pl-en">bind</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"default_scala"</span>,
    <span class="pl-s1">actual</span> <span class="pl-c1">=</span> <span class="pl-s">"@rules_scala_annex//src/main/scala:zinc_2_12_10"</span>,
)</pre></div>
<p dir="auto">BUILD</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_scala_annex//rules:scala.bzl&quot;, &quot;scala_library&quot;)

scala_library(
  name = &quot;example&quot;,
  srcs = glob([&quot;**/*.scala&quot;])
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_scala_annex//rules:scala.bzl"</span>, <span class="pl-s">"scala_library"</span>)

<span class="pl-en">scala_library</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"example"</span>,
  <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"**/*.scala"</span>])
)</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Further Documentation</h2><a id="user-content-further-documentation" class="anchor" aria-label="Permalink: Further Documentation" href="#further-documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="CONTRIBUTING.md">contributing guidlines</a> for help on contributing to this project.</p>
<p dir="auto">For all rules and attributes, see the <a href="docs/stardoc">Stardoc</a>.</p>
</article></div>