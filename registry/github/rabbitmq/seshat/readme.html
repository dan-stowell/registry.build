<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Seshat</h1><a id="user-content-seshat" class="anchor" aria-label="Permalink: Seshat" href="#seshat"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Seshat is a counters registry that maintains counter references with associated
meta data about what each counter refers to. Makes it easy to export counters
in a format suitable for external export to, e.g. <a href="https://prometheus.io/" rel="nofollow">prometheus</a>.</p>
<p dir="auto">Seshat is a foundation for the future metrics subsystem in RabbitMQ.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Project Maturity</h2><a id="user-content-project-maturity" class="anchor" aria-label="Permalink: Project Maturity" href="#project-maturity"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Maturing.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Documentation</h2><a id="user-content-documentation" class="anchor" aria-label="Permalink: Documentation" href="#documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">First create a new seshat group</h3><a id="user-content-first-create-a-new-seshat-group" class="anchor" aria-label="Permalink: First create a new seshat group" href="#first-create-a-new-seshat-group"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A group in seshat is some logical partitioning of counters. E.g. you may have
a group per erlang application, or some subcomponent of your system.</p>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="GroupRef = seshat:new_group(pets),"><pre><span class="pl-smi">GroupRef</span> <span class="pl-k">=</span> <span class="pl-en">seshat</span>:<span class="pl-en">new_group</span>(<span class="pl-c1">pets</span>),</pre></div>
<p dir="auto">A group is essentially en ETS table where counters and their meta data will be
stored. The <code>GroupRef</code> is an opaque type (but really it is an <code>ets:tid()</code>. The
group can be any <code>term()</code> but it makes sense to just use atoms. Keep stuff tidy folks.</p>
<p dir="auto">Now we're ready to register some counters.</p>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="-define(C_CARROTS_EATEN, 1).
-define(C_HOLES_DUG, 2)."><pre>-<span class="pl-k">define</span>(<span class="pl-en">C_CARROTS_EATEN</span>, <span class="pl-c1">1</span>).
-<span class="pl-k">define</span>(<span class="pl-en">C_HOLES_DUG</span>, <span class="pl-c1">2</span>).</pre></div>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="Fields = [{carrots_eaten_total, ?C_CARROTS_EATEN, counter,
            &quot;Total number of carrots eaten on a meal&quot;},
          {holes_dug_total, ?C_HOLES_DUG, counter,
           &quot;Total number of holes dug in an afternoon&quot;}],
Name = rabbit,
CountersRef = seshat:new(pets, Name, Fields),"><pre><span class="pl-smi">Fields</span> <span class="pl-k">=</span> [{<span class="pl-c1">carrots_eaten_total</span>, <span class="pl-k">?</span><span class="pl-en">C_CARROTS_EATEN</span>, <span class="pl-c1">counter</span>,
            <span class="pl-s"><span class="pl-pds">"</span>Total number of carrots eaten on a meal<span class="pl-pds">"</span></span>},
          {<span class="pl-c1">holes_dug_total</span>, <span class="pl-k">?</span><span class="pl-en">C_HOLES_DUG</span>, <span class="pl-c1">counter</span>,
           <span class="pl-s"><span class="pl-pds">"</span>Total number of holes dug in an afternoon<span class="pl-pds">"</span></span>}],
<span class="pl-smi">Name</span> <span class="pl-k">=</span> <span class="pl-c1">rabbit</span>,
<span class="pl-smi">CountersRef</span> <span class="pl-k">=</span> <span class="pl-en">seshat</span>:<span class="pl-en">new</span>(<span class="pl-c1">pets</span>, <span class="pl-smi">Name</span>, <span class="pl-smi">Fields</span>),</pre></div>
<p dir="auto">The <code>CountersRef</code> is a <code>counters:counters_ref()</code> type and can use used as usual
with the counters module. The <code>CountersRef</code> can be stored in the state of a
stateful erlang module or be retrieved using <code>sesaht:fetch(Group, Name)</code></p>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="counters:add(CountersRef, ?C_CARROTS_EATEN, 3),"><pre><span class="pl-en">counters</span>:<span class="pl-en">add</span>(<span class="pl-smi">CountersRef</span>, <span class="pl-k">?</span><span class="pl-en">C_CARROTS_EATEN</span>, <span class="pl-c1">3</span>),</pre></div>
<p dir="auto">To inspect the counters on the system for a given group do:</p>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="Counters = seshat:counters(pets),"><pre><span class="pl-smi">Counters</span> <span class="pl-k">=</span> <span class="pl-en">seshat</span>:<span class="pl-en">counters</span>(<span class="pl-c1">pets</span>),</pre></div>
<p dir="auto">Counters is a map of <code>#{Name =&gt; #{FieldName, Count}}</code>. E.g. for the above
it would look like:</p>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#{rabbit =&gt; #{carrots_eaten_total =&gt; 3, holes_dug_total =&gt; 0}}"><pre>#{<span class="pl-c1">rabbit</span> <span class="pl-k">=&gt;</span> #{<span class="pl-c1">carrots_eaten_total</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">3</span>, <span class="pl-c1">holes_dug_total</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>}}</pre></div>
<p dir="auto">There is also <code>seshat:format(Groups)</code> which for the above case will return:</p>
<div class="highlight highlight-source-erlang notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#{carrots_eaten_total =&gt;
    #{help =&gt; &quot;Total number of carrots eaten on a meal&quot;,
      type =&gt; counter,
      values =&gt; #{rabbit =&gt; 3}},
  holes_dug_total =&gt;
    #{help =&gt; &quot;Total number of holes dug in an afternoon&quot;,
      type =&gt; counter,
      values =&gt; #{rabbit =&gt; 0}}}"><pre>#{<span class="pl-c1">carrots_eaten_total</span> <span class="pl-k">=&gt;</span>
    #{<span class="pl-c1">help</span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Total number of carrots eaten on a meal<span class="pl-pds">"</span></span>,
      <span class="pl-c1">type</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">counter</span>,
      <span class="pl-c1">values</span> <span class="pl-k">=&gt;</span> #{<span class="pl-c1">rabbit</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">3</span>}},
  <span class="pl-c1">holes_dug_total</span> <span class="pl-k">=&gt;</span>
    #{<span class="pl-c1">help</span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Total number of holes dug in an afternoon<span class="pl-pds">"</span></span>,
      <span class="pl-c1">type</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">counter</span>,
      <span class="pl-c1">values</span> <span class="pl-k">=&gt;</span> #{<span class="pl-c1">rabbit</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>}}}</pre></div>
<p dir="auto">This format uses the counter <code>Name</code> as a unique value label for the metrics.
This formatting is more suitable for e.g. prometheus export. The counter name
doesn't have to be an atom. It can also be a list of two-tuples or
a pre-formatted binary.</p>
<p dir="auto"><code>seshat:format/2</code> allows additional formatting options.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Copyright and License</h2><a id="user-content-copyright-and-license" class="anchor" aria-label="Permalink: Copyright and License" href="#copyright-and-license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">(c) 2007-2025 Broadcom. All Rights Reserved. The term Broadcom refers to Broadcom Inc. and/or its subsidiaries.</p>
<p dir="auto">Double licensed under the ASL2 and MPL2.0.
See <a href="./LICENSE">LICENSE</a> for details.</p>
</article></div>