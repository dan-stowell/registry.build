<div id="readme" class="rst" data-path="README.rst"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Go rules for <a href="https://bazel.build/" rel="nofollow">Bazel</a></h1><a id="user-content-go-rules-for-bazel" class="anchor" aria-label="Permalink: Go rules for Bazel" href="#go-rules-for-bazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Mailing list: <a href="https://groups.google.com/forum/#!forum/bazel-go-discuss" rel="nofollow">bazel-go-discuss</a></p>
<p dir="auto">Slack: <a href="https://bazelbuild.slack.com/archives/CDBP88Z0D" rel="nofollow">#go on Bazel Slack</a>, <a href="https://gophers.slack.com/archives/C1SCQE54N" rel="nofollow">#bazel on Go Slack</a></p>
<a name="user-content-contents"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contents</h2><a id="user-content-contents" class="anchor" aria-label="Permalink: Contents" href="#contents"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="#overview">Overview</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#faq">FAQ</a></li>
</ul>
<a name="user-content-documentation"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Documentation</h3><a id="user-content-documentation" class="anchor" aria-label="Permalink: Documentation" href="#documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="docs/go/core/rules.md">Core rules</a><ul dir="auto">
<li><a href="docs/go/core/rules.md#go_binary">go_binary</a></li>
<li><a href="docs/go/core/rules.md#go_library">go_library</a></li>
<li><a href="docs/go/core/rules.md#go_test">go_test</a></li>
<li><a href="docs/go/core/rules.md#go_source">go_source</a></li>
<li><a href="docs/go/core/rules.md#go_path">go_path</a></li>
<li><a href="docs/go/core/rules.md#go_cross_binary">go_cross_binary</a></li>
</ul>
</li>
<li><a href="proto/core.rst">Proto rules</a><ul dir="auto">
<li><a href="proto/core.rst#go_proto_library">go_proto_library</a></li>
<li><a href="proto/core.rst#go_proto_compiler">go_proto_compiler</a></li>
</ul>
</li>
<li><a href="go/dependencies.rst">Dependencies</a><ul dir="auto">
<li><a href="go/dependencies.rst#go_rules_dependencies">go_rules_dependencies</a></li>
<li><a href="https://github.com/bazelbuild/bazel-gazelle/blob/master/reference.md#go_repository">go_repository</a> (Gazelle)</li>
</ul>
</li>
<li><a href="go/toolchains.rst">Toolchains</a><ul dir="auto">
<li><a href="go/toolchains.rst#go_register_toolchains">go_register_toolchains</a></li>
<li><a href="go/toolchains.rst#go_download_sdk">go_download_sdk</a></li>
<li><a href="go/toolchains.rst#go_host_sdk">go_host_sdk</a></li>
<li><a href="go/toolchains.rst#go_local_sdk">go_local_sdk</a></li>
<li><a href="go/toolchains.rst#go_wrap_sdk">go_wrap_sdk</a></li>
<li><a href="go/toolchains.rst#go_toolchain">go_toolchain</a></li>
<li><a href="go/toolchains.rst#go_context">go_context</a></li>
</ul>
</li>
<li><a href="docs/go/extras/extras.md">Extra rules</a><ul dir="auto">
<li><a href="docs/go/extras/extras.md#gomock">gomock</a></li>
</ul>
</li>
<li><a href="go/nogo.rst">nogo build-time static analysis</a></li>
<li><a href="go/modes.rst">Build modes</a></li>
</ul>
<a name="user-content-quick-links"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Quick links</h3><a id="user-content-quick-links" class="anchor" aria-label="Permalink: Quick links" href="#quick-links"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="https://github.com/bazelbuild/rules_go/wiki/Roadmap">rules_go and Gazelle roadmap</a></li>
<li><a href="https://github.com/bazelbuild/rules_go/wiki/Deprecation-schedule">Deprecation schedule</a></li>
<li><a href="windows.rst">Using rules_go on Windows</a></li>
</ul>
<a name="user-content-overview"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Overview</h2><a id="user-content-overview" class="anchor" aria-label="Permalink: Overview" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">These rules support:</p>
<ul dir="auto">
<li>Building libraries, binaries, and tests (<a href="docs/go/core/rules.md#go_library">go_library</a>, <a href="docs/go/core/rules.md#go_binary">go_binary</a>,
<a href="docs/go/core/rules.md#go_test">go_test</a>)</li>
<li>Go modules via <a href="https://github.com/bazel-contrib/bazel-gazelle/blob/master/extensions.md#go_deps">go_deps</a>.</li>
<li>Vendoring</li>
<li>cgo</li>
<li>Cross-compilation</li>
<li>Generating BUILD files via <a href="https://github.com/bazelbuild/bazel-gazelle">gazelle</a></li>
<li>Build-time static code analysis via <a href="go/nogo.rst">nogo</a></li>
<li><a href="proto/core.rst">Protocol buffers</a></li>
<li>Remote execution</li>
<li><a href="https://bazel.google.cn/docs/coverage" rel="nofollow">Coverage</a></li>
<li><a href="https://github.com/bazelbuild/rules_go/wiki/Editor-setup">gopls integration</a> for editor support</li>
<li>Debugging</li>
</ul>
<p dir="auto">They currently do not support or have limited support for:</p>
<ul dir="auto">
<li>C/C++ integration other than cgo (SWIG)</li>
</ul>
<p dir="auto">The Go rules are tested and supported on the following host platforms:</p>
<ul dir="auto">
<li>Linux, macOS, Windows</li>
<li>amd64, arm64</li>
</ul>
<p dir="auto">Users have reported success on several other platforms, but the rules are
only tested on those listed above.</p>
<p dir="auto">Note: Since version v0.51.0, rules_go requires Bazel â‰¥ 6.5.0 to work.</p>
<p dir="auto">The <code>master</code> branch is only guaranteed to work with the latest version of Bazel.</p>
<a name="user-content-setup"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Setup</h2><a id="user-content-setup" class="anchor" aria-label="Permalink: Setup" href="#setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To build Go code with Bazel, you will need:</p>
<ul dir="auto">
<li>A recent version of Bazel.</li>
<li>A C/C++ toolchain (if using cgo). Bazel will attempt to configure the
toolchain automatically.</li>
<li>Bash, <code>patch</code>, <code>cat</code>, and a handful of other Unix tools in <code>PATH</code>.</li>
</ul>
<p dir="auto">You normally won't need a Go toolchain installed. Bazel will download one.</p>
<p dir="auto">See <a href="windows.rst">Using rules_go on Windows</a> for Windows-specific setup instructions.
Several additional tools need to be installed and configured.</p>
<p dir="auto">If you're new to Bazel, read <a href="https://bazel.build/start/go" rel="nofollow">Bazel Tutorial: Build a Go Project</a>, which
introduces Bazel concepts and shows you how to set up a small Go workspace to
be built with Bazel.</p>
<p dir="auto">For a quicker "hello world" example, see <a href="examples/hello">examples/hello</a>.</p>
<p dir="auto">For an example that generates build files and retrieves external dependencies
using Gazelle, see <a href="examples/basic_gazelle">examples/basic_gazelle</a>.</p>
<p dir="auto">For more detailed <a href="https://bazel.build/external/overview#bzlmod" rel="nofollow">Bzlmod</a> documentation, see <a href="docs/go/core/bzlmod.md">Go with Bzlmod</a>.</p>
<p dir="auto">For legacy <code>WORKSPACE</code> instructions, see <a href="docs/go/core/workspace.md">Go with WORKSPACE</a>.</p>
<a name="user-content-faq"></a>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">FAQ</h2><a id="user-content-faq" class="anchor" aria-label="Permalink: FAQ" href="#faq"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong>Go</strong></p>
<ul dir="auto">
<li><a href="#can-i-still-use-the-go-command">Can I still use the go command?</a></li>
<li><a href="#does-this-work-with-go-modules">Does this work with Go modules?</a></li>
<li><a href="#what-s-up-with-the-go-default-library-name">What's up with the go_default_library name?</a></li>
<li><a href="#how-do-i-cross-compile">How do I cross-compile?</a></li>
<li><a href="#how-do-i-access-testdata">How do I access testdata?</a></li>
<li><a href="#how-do-i-access-go-binary-executables-from-go-test">How do I access go_binary executables from go_test?</a></li>
</ul>
<p dir="auto"><strong>Protocol buffers</strong></p>
<ul dir="auto">
<li><a href="#how-do-i-avoid-conflicts-with-protocol-buffers">How do I avoid conflicts with protocol buffers?</a></li>
<li><a href="#can-i-use-a-vendored-grpc-with-go-proto-library">Can I use a vendored gRPC with go_proto_library?</a></li>
</ul>
<p dir="auto"><strong>Dependencies and testing</strong></p>
<ul dir="auto">
<li><a href="#how-do-i-use-different-versions-of-dependencies">How do I use different versions of dependencies?</a></li>
<li><a href="#how-do-i-test-a-beta-version-of-the-go-sdk">How do I test a beta version of the Go SDK?</a></li>
</ul>
<a name="user-content-can-i-still-use-the-go-command"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Can I still use the go command?</h3><a id="user-content-can-i-still-use-the-go-command" class="anchor" aria-label="Permalink: Can I still use the go command?" href="#can-i-still-use-the-go-command"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Yes, but not directly.</p>
<p dir="auto">rules_go invokes the Go compiler and linker directly, based on the targets
described with <a href="docs/go/core/rules.md#go_binary">go_binary</a> and other rules. Bazel and rules_go together
fill the same role as the <code>go</code> command, so it's not necessary to use the
<code>go</code> command in a Bazel workspace.</p>
<p dir="auto">That said, it's usually still a good idea to follow conventions required by
the <code>go</code> command (e.g., one package per directory, package paths match
directory paths). Tools that aren't compatible with Bazel will still work,
and your project can be depended on by non-Bazel projects.</p>
<p dir="auto">If you need to use the <code>go</code> command to perform tasks that Bazel doesn't cover
(such as adding a new dependency to <code>go.mod</code>), you can use the following Bazel
invocation to run the <code>go</code> binary of the Bazel-configured Go SDK:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel run @io_bazel_rules_go//go -- &lt;args&gt;"><pre>bazel run @io_bazel_rules_go//go -- <span class="pl-k">&lt;</span>args<span class="pl-k">&gt;</span></pre></div>
<p dir="auto">Prefer this to running <code>go</code> directly since it ensures that the version of Go
is identical to the one used by rules_go.</p>
<a name="user-content-does-this-work-with-go-modules"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Does this work with Go modules?</h3><a id="user-content-does-this-work-with-go-modules" class="anchor" aria-label="Permalink: Does this work with Go modules?" href="#does-this-work-with-go-modules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Yes, but not directly. Bazel ignores <code>go.mod</code> files, and all package
dependencies must be expressed through <code>deps</code> attributes in targets
described with <a href="docs/go/core/rules.md#go_library">go_library</a> and other rules.</p>
<p dir="auto">You can download a Go module at a specific version as an external repository
using <a href="https://github.com/bazelbuild/bazel-gazelle/blob/master/reference.md#go_repository">go_repository</a>, a workspace rule provided by <a href="https://github.com/bazelbuild/bazel-gazelle">gazelle</a>. This will also
generate build files using <a href="https://github.com/bazelbuild/bazel-gazelle">gazelle</a>.</p>
<p dir="auto">You can import <a href="https://github.com/bazelbuild/bazel-gazelle/blob/master/reference.md#go_repository">go_repository</a> rules from a <code>go.mod</code> file using
<a href="https://github.com/bazelbuild/bazel-gazelle#update-repos">gazelle update-repos</a>.</p>
<a name="user-content-what-s-up-with-the-go-default-library-name"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">What's up with the go_default_library name?</h3><a id="user-content-whats-up-with-the-go_default_library-name" class="anchor" aria-label="Permalink: What's up with the go_default_library name?" href="#whats-up-with-the-go_default_library-name"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This was used to keep import paths consistent in libraries that can be built
with <code>go build</code> before the <code>importpath</code> attribute was available.</p>
<p dir="auto">In order to compile and link correctly, rules_go must know the Go import path
(the string by which a package can be imported) for each library. This is now
set explicitly with the <code>importpath</code> attribute. Before that attribute existed,
the import path was inferred by concatenating a string from a special
<code>go_prefix</code> rule and the library's package and label name. For example, if
<code>go_prefix</code> was <code>github.com/example/project</code>, for a library
<code>//foo/bar:bar</code>, rules_go would infer the import path as
<code>github.com/example/project/foo/bar/bar</code>. The stutter at the end is
incompatible with <code>go build</code>, so if the label name was <code>go_default_library</code>,
the import path would not include it. So for the library
<code>//foo/bar:go_default_library</code>, the import path would be
<code>github.com/example/project/foo/bar</code>.</p>
<p dir="auto">Since <code>go_prefix</code> was removed and the <code>importpath</code> attribute became
mandatory (see <a href="https://github.com/bazelbuild/rules_go/issues/721" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_go/issues/721/hovercard">#721</a>), the <code>go_default_library</code> name no longer serves any
purpose. We may decide to stop using it in the future (see <a href="https://github.com/bazelbuild/rules_go/issues/265" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_go/issues/265/hovercard">#265</a>).</p>
<a name="user-content-how-do-i-cross-compile"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How do I cross-compile?</h3><a id="user-content-how-do-i-cross-compile" class="anchor" aria-label="Permalink: How do I cross-compile?" href="#how-do-i-cross-compile"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can cross-compile by setting the <code>--platforms</code> flag on the command line.
For example:</p>
<pre>$ bazel build --platforms=@io_bazel_rules_go//go/toolchain:linux_amd64 //cmd
</pre>
<p dir="auto">By default, cgo is disabled when cross-compiling. To cross-compile with cgo,
add a <code>_cgo</code> suffix to the target platform. You must register a
cross-compiling C/C++ toolchain with Bazel for this to work.</p>
<pre>$ bazel build --platforms=@io_bazel_rules_go//go/toolchain:linux_amd64_cgo //cmd
</pre>
<p dir="auto">Platform-specific sources with build tags or filename suffixes are filtered
automatically at compile time. You can selectively include platform-specific
dependencies with <code>select</code> expressions (Gazelle does this automatically).</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="go_library(
    name = &quot;foo&quot;,
    srcs = [
        &quot;foo_linux.go&quot;,
        &quot;foo_windows.go&quot;,
    ],
    deps = select({
        &quot;@io_bazel_rules_go//go/platform:linux_amd64&quot;: [
            &quot;//bar_linux&quot;,
        ],
        &quot;@io_bazel_rules_go//go/platform:windows_amd64&quot;: [
            &quot;//bar_windows&quot;,
        ],
        &quot;//conditions:default&quot;: [],
    }),
)"><pre><span class="pl-en">go_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"foo_linux.go"</span>,
        <span class="pl-s">"foo_windows.go"</span>,
    ],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> <span class="pl-en">select</span>({
        <span class="pl-s">"@io_bazel_rules_go//go/platform:linux_amd64"</span>: [
            <span class="pl-s">"//bar_linux"</span>,
        ],
        <span class="pl-s">"@io_bazel_rules_go//go/platform:windows_amd64"</span>: [
            <span class="pl-s">"//bar_windows"</span>,
        ],
        <span class="pl-s">"//conditions:default"</span>: [],
    }),
)</pre></div>
<p dir="auto">To build a specific <a href="docs/go/core/rules.md#go_binary">go_binary</a> target for a target platform or using a
specific golang SDK version, use the <a href="docs/go/core/rules.md#go_cross_binary">go_cross_binary</a> rule. This is useful
for producing multiple binaries for different platforms in a single build.</p>
<p dir="auto">To build a specific <a href="docs/go/core/rules.md#go_test">go_test</a> target for a target platform, set the
<code>goos</code> and <code>goarch</code> attributes on that rule.</p>
<p dir="auto">You can equivalently depend on a <a href="docs/go/core/rules.md#go_binary">go_binary</a> or <a href="docs/go/core/rules.md#go_test">go_test</a> rule through
a Bazel <a href="https://docs.bazel.build/versions/master/skylark/lib/transition.html" rel="nofollow">configuration transition</a> on <code>//command_line_option:platforms</code>
(there are problems with this approach prior to rules_go 0.23.0).</p>
<a name="user-content-how-do-i-access-testdata"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How do I access testdata?</h3><a id="user-content-how-do-i-access-testdata" class="anchor" aria-label="Permalink: How do I access testdata?" href="#how-do-i-access-testdata"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel executes tests in a sandbox, which means tests don't automatically have
access to files. You must include test files using the <code>data</code> attribute.
For example, if you want to include everything in the <code>testdata</code> directory:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="go_test(
    name = &quot;foo_test&quot;,
    srcs = [&quot;foo_test.go&quot;],
    data = glob([&quot;testdata/**&quot;]),
    importpath = &quot;github.com/example/project/foo&quot;,
)"><pre><span class="pl-en">go_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo_test"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"foo_test.go"</span>],
    <span class="pl-s1">data</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"testdata/**"</span>]),
    <span class="pl-s1">importpath</span> <span class="pl-c1">=</span> <span class="pl-s">"github.com/example/project/foo"</span>,
)</pre></div>
<p dir="auto">By default, tests are run in the directory of the build file that defined them.
Note that this follows the Go testing convention, not the Bazel convention
followed by other languages, which run in the repository root. This means
that you can access test files using relative paths. You can change the test
directory using the <code>rundir</code> attribute. See <a href="docs/go/core/rules.md#go_test">go_test</a>.</p>
<p dir="auto">Gazelle will automatically add a <code>data</code> attribute like the one above if you
have a <code>testdata</code> directory <em>unless</em> it contains buildable .go files or
build files, in which case, <code>testdata</code> is treated as a normal package.</p>
<p dir="auto">Note that on Windows, data files are not directly available to tests, since test
data files rely on symbolic links, and by default, Windows doesn't let
unprivileged users create symbolic links. You can use the
<a href="https://pkg.go.dev/github.com/bazelbuild/rules_go/go/tools/bazel?tab=doc" rel="nofollow">github.com/bazelbuild/rules_go/go/tools/bazel</a> library to access data files.</p>
<a name="user-content-how-do-i-access-go-binary-executables-from-go-test"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How do I access go_binary executables from go_test?</h3><a id="user-content-how-do-i-access-go_binary-executables-from-go_test" class="anchor" aria-label="Permalink: How do I access go_binary executables from go_test?" href="#how-do-i-access-go_binary-executables-from-go_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The location where <code>go_binary</code> writes its executable file is not stable across
rules_go versions and should not be depended upon. The parent directory includes
some configuration data in its name. This prevents Bazel's cache from being
poisoned when the same binary is built in different configurations. The binary
basename may also be platform-dependent: on Windows, we add an .exe extension.</p>
<p dir="auto">To depend on an executable in a <code>go_test</code> rule, reference the executable
in the <code>data</code> attribute (to make it visible), then expand the location
in <code>args</code>. The real location will be passed to the test on the command line.
For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="go_binary(
    name = &quot;cmd&quot;,
    srcs = [&quot;cmd.go&quot;],
)

go_test(
    name = &quot;cmd_test&quot;,
    srcs = [&quot;cmd_test.go&quot;],
    args = [&quot;$(location :cmd)&quot;],
    data = [&quot;:cmd&quot;],
)"><pre><span class="pl-en">go_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"cmd"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"cmd.go"</span>],
)

<span class="pl-en">go_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"cmd_test"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"cmd_test.go"</span>],
    <span class="pl-s1">args</span> <span class="pl-c1">=</span> [<span class="pl-s">"$(location :cmd)"</span>],
    <span class="pl-s1">data</span> <span class="pl-c1">=</span> [<span class="pl-s">":cmd"</span>],
)</pre></div>
<p dir="auto">See <a href="https://github.com/bazelbuild/rules_go/blob/master/tests/core/cross/BUILD.bazel">//tests/core/cross</a> for a full example of a test that
accesses a binary.</p>
<p dir="auto">Alternatively, you can set the <code>out</code> attribute of <a href="docs/go/core/rules.md#go_binary">go_binary</a> to a specific
filename. Note that when <code>out</code> is set, the binary won't be cached when
changing configurations.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="go_binary(
    name = &quot;cmd&quot;,
    srcs = [&quot;cmd.go&quot;],
    out = &quot;cmd&quot;,
)

go_test(
    name = &quot;cmd_test&quot;,
    srcs = [&quot;cmd_test.go&quot;],
    data = [&quot;:cmd&quot;],
)"><pre><span class="pl-en">go_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"cmd"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"cmd.go"</span>],
    <span class="pl-s1">out</span> <span class="pl-c1">=</span> <span class="pl-s">"cmd"</span>,
)

<span class="pl-en">go_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"cmd_test"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"cmd_test.go"</span>],
    <span class="pl-s1">data</span> <span class="pl-c1">=</span> [<span class="pl-s">":cmd"</span>],
)</pre></div>
<a name="user-content-how-do-i-avoid-conflicts-with-protocol-buffers"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How do I avoid conflicts with protocol buffers?</h3><a id="user-content-how-do-i-avoid-conflicts-with-protocol-buffers" class="anchor" aria-label="Permalink: How do I avoid conflicts with protocol buffers?" href="#how-do-i-avoid-conflicts-with-protocol-buffers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="proto/core.rst#avoiding-conflicts">Avoiding conflicts</a> in the proto documentation.</p>
<a name="user-content-can-i-use-a-vendored-grpc-with-go-proto-library"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Can I use a vendored gRPC with go_proto_library?</h3><a id="user-content-can-i-use-a-vendored-grpc-with-go_proto_library" class="anchor" aria-label="Permalink: Can I use a vendored gRPC with go_proto_library?" href="#can-i-use-a-vendored-grpc-with-go_proto_library"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This is not supported. When using <a href="proto/core.rst#go_proto_library">go_proto_library</a> with the
<code>@io_bazel_rules_go//proto:go_grpc</code> compiler, an implicit dependency is added
on <code>@org_golang_google_grpc//:go_default_library</code>. If you link another copy of
the same package from <code>//vendor/google.golang.org/grpc:go_default_library</code>
or anywhere else, you may experience conflicts at compile or run-time.</p>
<p dir="auto">If you're using Gazelle with proto rule generation enabled, imports of
<code>google.golang.org/grpc</code> will be automatically resolved to
<code>@org_golang_google_grpc//:go_default_library</code> to avoid conflicts. The
vendored gRPC should be ignored in this case.</p>
<p dir="auto">If you specifically need to use a vendored gRPC package, it's best to avoid
using <code>go_proto_library</code> altogether. You can check in pre-generated .pb.go
files and build them with <code>go_library</code> rules. Gazelle will generate these
rules when proto rule generation is disabled (add <code># gazelle:proto
disable_global</code> to your root build file).</p>
<a name="user-content-how-do-i-use-different-versions-of-dependencies"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How do I use different versions of dependencies?</h3><a id="user-content-how-do-i-use-different-versions-of-dependencies" class="anchor" aria-label="Permalink: How do I use different versions of dependencies?" href="#how-do-i-use-different-versions-of-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="go/dependencies.rst#overriding-dependencies">Overriding dependencies</a> for instructions on overriding repositories
declared in <a href="go/dependencies.rst#go_rules_dependencies">go_rules_dependencies</a>.</p>
<a name="user-content-how-do-i-test-a-beta-version-of-the-go-sdk"></a>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How do I test a beta version of the Go SDK?</h3><a id="user-content-how-do-i-test-a-beta-version-of-the-go-sdk" class="anchor" aria-label="Permalink: How do I test a beta version of the Go SDK?" href="#how-do-i-test-a-beta-version-of-the-go-sdk"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">rules_go only supports official releases of the Go SDK. However, you can still
test beta and RC versions by passing a <code>version</code> like <code>"1.16beta1"</code> to
<a href="go/toolchains.rst#go_register_toolchains">go_register_toolchains</a>. See also <a href="go/toolchains.rst#go_download_sdk">go_download_sdk</a>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_go//go:deps.bzl&quot;, &quot;go_register_toolchains&quot;, &quot;go_rules_dependencies&quot;)

go_rules_dependencies()

go_register_toolchains(version = &quot;1.17beta1&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_go//go:deps.bzl"</span>, <span class="pl-s">"go_register_toolchains"</span>, <span class="pl-s">"go_rules_dependencies"</span>)

<span class="pl-en">go_rules_dependencies</span>()

<span class="pl-en">go_register_toolchains</span>(<span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.17beta1"</span>)</pre></div>

</article></div>