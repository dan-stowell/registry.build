<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Bazel rules for running docker-compose tests</h1><a id="user-content-bazel-rules-for-running-docker-compose-tests" class="anchor" aria-label="Permalink: Bazel rules for running docker-compose tests" href="#bazel-rules-for-running-docker-compose-tests"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This bazel ruleset provides a macro so you can run docker-compose tests as bazel test rules. See the <a href="./examples">examples</a> directory for full usage of the <code>docker_compose_test</code> rule.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Bringing the rule into your Bazel repository</h2><a id="user-content-bringing-the-rule-into-your-bazel-repository" class="anchor" aria-label="Permalink: Bringing the rule into your Bazel repository" href="#bringing-the-rule-into-your-bazel-repository"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Check the <a href="https://github.com/salesforce/rules_docker_compose_test/releases">latest release</a> for instructions.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">How does it work?</h2><a id="user-content-how-does-it-work" class="anchor" aria-label="Permalink: How does it work?" href="#how-does-it-work"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The rule brings up the docker-compose file and validates that the exit code of the test container is <code>0</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Constraints</h2><a id="user-content-constraints" class="anchor" aria-label="Permalink: Constraints" href="#constraints"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This rule only provides a pass/fail result . It doesn't gather coverage information.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Pre-requisites</h2><a id="user-content-pre-requisites" class="anchor" aria-label="Permalink: Pre-requisites" href="#pre-requisites"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You need to have a supported version of <code>docker</code> installed for the rule to work. Your version should support <code>-f</code> and <code>wait</code>. You can check if these options are present by running <code>docker-compose help</code>.</p>
<p dir="auto">*If the compose test fails with the following error: <code>unknown shorthand flag: 'f' in -f</code>, there is a <a href="https://github.com/docker/for-mac/issues/6876" data-hovercard-type="issue" data-hovercard-url="/docker/for-mac/issues/6876/hovercard">known issue</a> with compose installed through docker-desktop. Try running <code>brew install docker-compose</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Example Usage</h2><a id="user-content-example-usage" class="anchor" aria-label="Permalink: Example Usage" href="#example-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Externally Built Image</h3><a id="user-content-externally-built-image" class="anchor" aria-label="Permalink: Externally Built Image" href="#externally-built-image"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In this example, the <code>docker_compose_test</code> does not actually depend on an image built in the repository. The exit code from the <code>entrypoint</code> of <code>test_container</code> is used to determine pass/fail.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="docker_compose_test(
    name = &quot;junit-image-test&quot;,
    docker_compose_file = &quot;:docker-compose.yml&quot;,
    docker_compose_test_container = &quot;test_container&quot;,
)"><pre><span class="pl-en">docker_compose_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"junit-image-test"</span>,
    <span class="pl-s1">docker_compose_file</span> <span class="pl-c1">=</span> <span class="pl-s">":docker-compose.yml"</span>,
    <span class="pl-s1">docker_compose_test_container</span> <span class="pl-c1">=</span> <span class="pl-s">"test_container"</span>,
)</pre></div>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="services:
  test_container:
    image: ubuntu:25.04
    entrypoint: [&quot;echo&quot;, &quot;Hello World!&quot;]"><pre><span class="pl-ent">services</span>:
  <span class="pl-ent">test_container</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">ubuntu:25.04</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["echo", "Hello World!"]</span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Locally Built Image</h3><a id="user-content-locally-built-image" class="anchor" aria-label="Permalink: Locally Built Image" href="#locally-built-image"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In this example, <code>rules_oci</code> is used to build and tag an image (<code>locally-built-image:1</code>). The <code>docker_compose_test</code> depends on this image.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="
...

oci_load(
    name = &quot;tarball&quot;,
    image = &quot;:java_image&quot;,
    repo_tags = [&quot;locally-built-image:1&quot;],
)

sh_binary(
    name = &quot;docker_image_fixture&quot;,
    srcs = [&quot;:tarball&quot;],
)

docker_compose_test(
    name = &quot;locally-built-image-test&quot;,
    docker_compose_file = &quot;:docker-compose.yml&quot;,
    docker_compose_test_container = &quot;test_container&quot;,
    local_image_targets = &quot;locally-built-image-test:tarball&quot;,
    data = [&quot;:docker_image_fixture&quot;],
)"><pre>...

<span class="pl-en">oci_load</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"tarball"</span>,
    <span class="pl-s1">image</span> <span class="pl-c1">=</span> <span class="pl-s">":java_image"</span>,
    <span class="pl-s1">repo_tags</span> <span class="pl-c1">=</span> [<span class="pl-s">"locally-built-image:1"</span>],
)

<span class="pl-en">sh_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"docker_image_fixture"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">":tarball"</span>],
)

<span class="pl-en">docker_compose_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"locally-built-image-test"</span>,
    <span class="pl-s1">docker_compose_file</span> <span class="pl-c1">=</span> <span class="pl-s">":docker-compose.yml"</span>,
    <span class="pl-s1">docker_compose_test_container</span> <span class="pl-c1">=</span> <span class="pl-s">"test_container"</span>,
    <span class="pl-s1">local_image_targets</span> <span class="pl-c1">=</span> <span class="pl-s">"locally-built-image-test:tarball"</span>,
    <span class="pl-s1">data</span> <span class="pl-c1">=</span> [<span class="pl-s">":docker_image_fixture"</span>],
)</pre></div>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="services:
  test_container:
    image: locally-built-image:2
    entrypoint: [&quot;cat&quot;, &quot;/files/hello.txt&quot;]"><pre><span class="pl-ent">services</span>:
  <span class="pl-ent">test_container</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">locally-built-image:2</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["cat", "/files/hello.txt"]</span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">junit_docker_compose_test</h3><a id="user-content-junit_docker_compose_test" class="anchor" aria-label="Permalink: junit_docker_compose_test" href="#junit_docker_compose_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="(cd examples &amp;&amp; bazel test junit-image-test)"><pre class="notranslate"><code>(cd examples &amp;&amp; bazel test junit-image-test)
</code></pre></div>
<p dir="auto">In this example, the test source files, dependencies, classpath jars and test image base are passed into the macro. The macro builds a docker image with all of these and then uses the junit standalone jar to execute the tests. You can use some magic customization environment variables in the docker-compose file.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_docker_compose_test//docker_compose_test:docker_compose_test.bzl&quot;, &quot;junit_docker_compose_test&quot;)

junit_docker_compose_test(
    name = &quot;junit-image-test&quot;,
    docker_compose_file = &quot;:docker-compose.yml&quot;,
    docker_compose_test_container = &quot;test_container&quot;,
    test_srcs = glob([&quot;**/*Test.java&quot;]),
    test_deps = [&quot;@maven//:org_junit_jupiter_junit_jupiter_api&quot;],
    classpath_jars = [&quot;@maven//:org_junit_platform_junit_platform_console_standalone&quot;],
    test_image_base = &quot;@openjdk&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_docker_compose_test//docker_compose_test:docker_compose_test.bzl"</span>, <span class="pl-s">"junit_docker_compose_test"</span>)

<span class="pl-en">junit_docker_compose_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"junit-image-test"</span>,
    <span class="pl-s1">docker_compose_file</span> <span class="pl-c1">=</span> <span class="pl-s">":docker-compose.yml"</span>,
    <span class="pl-s1">docker_compose_test_container</span> <span class="pl-c1">=</span> <span class="pl-s">"test_container"</span>,
    <span class="pl-s1">test_srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"**/*Test.java"</span>]),
    <span class="pl-s1">test_deps</span> <span class="pl-c1">=</span> [<span class="pl-s">"@maven//:org_junit_jupiter_junit_jupiter_api"</span>],
    <span class="pl-s1">classpath_jars</span> <span class="pl-c1">=</span> [<span class="pl-s">"@maven//:org_junit_platform_junit_platform_console_standalone"</span>],
    <span class="pl-s1">test_image_base</span> <span class="pl-c1">=</span> <span class="pl-s">"@openjdk"</span>,
)</pre></div>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="services:
  test_container:
    image: junit-image-test:test_container
    entrypoint: [&quot;/busybox/sh&quot;, &quot;./test_container_entrypoint.sh&quot;]
    environment:
      - JAVA_HOME=/path/to/jdk/in/custom/image/bin/java
      - JUNIT_PARAMS=--include-classname com.something.integration.*
      - JVM_ARGS=-Dfoo.bar=true"><pre><span class="pl-ent">services</span>:
  <span class="pl-ent">test_container</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">junit-image-test:test_container</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["/busybox/sh", "./test_container_entrypoint.sh"]</span>
    <span class="pl-ent">environment</span>:
      - <span class="pl-s">JAVA_HOME=/path/to/jdk/in/custom/image/bin/java</span>
      - <span class="pl-s">JUNIT_PARAMS=--include-classname com.something.integration.*</span>
      - <span class="pl-s">JVM_ARGS=-Dfoo.bar=true</span></pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">javacopts</h4><a id="user-content-javacopts" class="anchor" aria-label="Permalink: javacopts" href="#javacopts"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can pass <code>javacopts</code> when building the uber junit test binary using <code>uber_jar_javacopts</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">go_docker_compose_test</h3><a id="user-content-go_docker_compose_test" class="anchor" aria-label="Permalink: go_docker_compose_test" href="#go_docker_compose_test"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="(cd examples &amp;&amp; bazel test --platforms=@rules_go//go/toolchain:linux_amd64 go-test-image-test)"><pre class="notranslate"><code>(cd examples &amp;&amp; bazel test --platforms=@rules_go//go/toolchain:linux_amd64 go-test-image-test)
</code></pre></div>
<p dir="auto">In this example, the test source files, dependencies and test image base are passed into the macro. The macro builds a binary containing the test source files and dependencies which are executed as part of the docker-compose test.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_docker_compose_test//docker_compose_test:docker_compose_test.bzl&quot;, &quot;go_docker_compose_test&quot;)

go_docker_compose_test(
    name = &quot;go-test-image-test&quot;,
    docker_compose_file = &quot;:docker-compose.yml&quot;,
    docker_compose_test_container = &quot;test_container&quot;,
    test_srcs = glob([&quot;**/*_test.go&quot;]),
    test_deps = [],
    test_image_base = &quot;@ubuntu&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_docker_compose_test//docker_compose_test:docker_compose_test.bzl"</span>, <span class="pl-s">"go_docker_compose_test"</span>)

<span class="pl-en">go_docker_compose_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"go-test-image-test"</span>,
    <span class="pl-s1">docker_compose_file</span> <span class="pl-c1">=</span> <span class="pl-s">":docker-compose.yml"</span>,
    <span class="pl-s1">docker_compose_test_container</span> <span class="pl-c1">=</span> <span class="pl-s">"test_container"</span>,
    <span class="pl-s1">test_srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"**/*_test.go"</span>]),
    <span class="pl-s1">test_deps</span> <span class="pl-c1">=</span> [],
    <span class="pl-s1">test_image_base</span> <span class="pl-c1">=</span> <span class="pl-s">"@ubuntu"</span>,
)</pre></div>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="services:
  test_container:
    image: go-test-image-test:test_container
    entrypoint: [&quot;tests/go-test-image-test.go_test&quot;]"><pre><span class="pl-ent">services</span>:
  <span class="pl-ent">test_container</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">go-test-image-test:test_container</span>
    <span class="pl-ent">entrypoint</span>: <span class="pl-s">["tests/go-test-image-test.go_test"]</span></pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">pre_compose_up_script</h2><a id="user-content-pre_compose_up_script" class="anchor" aria-label="Permalink: pre_compose_up_script" href="#pre_compose_up_script"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Sometimes, you may need some logic to run before the compose test containers come up. You can use <code>pre_compose_up_script</code> for that purpose. See <a href="examples/pre-compose-up-script-test">examples/pre-compose-up-script-test</a> for an example.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">extra_docker_compose_up_args</h2><a id="user-content-extra_docker_compose_up_args" class="anchor" aria-label="Permalink: extra_docker_compose_up_args" href="#extra_docker_compose_up_args"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can append extra arguments to the <code>docker compose up</code> command using <code>extra_docker_compose_up_args</code>. See <a href="examples/pre-compose-up-script-test">examples/pre-compose-up-script-test</a> for an example.</p>
</article></div>