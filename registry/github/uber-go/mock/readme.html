<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">gomock</h1><a id="user-content-gomock" class="anchor" aria-label="Permalink: gomock" href="#gomock"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/uber-go/mock/actions"><img src="https://github.com/uber-go/mock/actions/workflows/test.yaml/badge.svg" alt="Build Status" style="max-width: 100%;"></a> <a href="https://pkg.go.dev/go.uber.org/mock" rel="nofollow"><img src="https://camo.githubusercontent.com/ec7670c8e67d9166d8b5f1b534726cfc753c9daf107f280ad91e7797f2e9c6f9/68747470733a2f2f706b672e676f2e6465762f62616467652f676f2e756265722e6f72672f6d6f636b2e737667" alt="Go Reference" data-canonical-src="https://pkg.go.dev/badge/go.uber.org/mock.svg" style="max-width: 100%;"></a></p>
<p dir="auto">gomock is a mocking framework for the <a href="http://go.dev/" rel="nofollow">Go programming language</a>. It
integrates well with Go's built-in <code>testing</code> package, but can be used in other
contexts too.</p>
<p dir="auto">This project originates from Google's <code>golang/mock</code> repo. Unfortunately, Google
no longer maintains this project, and given the heavy usage of gomock project
within Uber, we've decided to fork and maintain this going forward at Uber.</p>
<p dir="auto"><a href="./CONTRIBUTING.md">Contributions</a> are welcome in the form of GitHub issue or PR!</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Supported Go Versions</h2><a id="user-content-supported-go-versions" class="anchor" aria-label="Permalink: Supported Go Versions" href="#supported-go-versions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">go.uber.org/mock supports all Go versions supported by the official
<a href="https://go.dev/doc/devel/release#policy" rel="nofollow">Go Release Policy</a>. That is,
the two most recent releases of Go.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Install the <code>mockgen</code> tool.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="go install go.uber.org/mock/mockgen@latest"><pre class="notranslate"><code>go install go.uber.org/mock/mockgen@latest
</code></pre></div>
<p dir="auto">To ensure it was installed correctly, use:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="mockgen -version"><pre class="notranslate"><code>mockgen -version
</code></pre></div>
<p dir="auto">If that fails, make sure your GOPATH/bin is in your PATH. You can add it with:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="export PATH=$PATH:$(go env GOPATH)/bin"><pre class="notranslate"><code>export PATH=$PATH:$(go env GOPATH)/bin
</code></pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Running mockgen</h2><a id="user-content-running-mockgen" class="anchor" aria-label="Permalink: Running mockgen" href="#running-mockgen"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>mockgen</code> has three modes of operation: archive, source and package.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Archive mode</h3><a id="user-content-archive-mode" class="anchor" aria-label="Permalink: Archive mode" href="#archive-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Archive mode generates mock interfaces from a package archive
file (.a). It is enabled by using the -archive flag. An import
path and a comma-separated list of symbols should be provided
as a non-flag argument to the command.</p>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Build the package to a archive.
go build -o pkg.a database/sql/driver

mockgen -archive=pkg.a database/sql/driver Conn,Driver"><pre><span class="pl-c"><span class="pl-c">#</span> Build the package to a archive.</span>
go build -o pkg.a database/sql/driver

mockgen -archive=pkg.a database/sql/driver Conn,Driver</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Source mode</h3><a id="user-content-source-mode" class="anchor" aria-label="Permalink: Source mode" href="#source-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Source mode generates mock interfaces from a source file.
It is enabled by using the -source flag. Other flags that
may be useful in this mode are -imports and -aux_files.</p>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mockgen -source=foo.go [other options]"><pre>mockgen -source=foo.go [other options]</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Package mode</h3><a id="user-content-package-mode" class="anchor" aria-label="Permalink: Package mode" href="#package-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Package mode works by specifying the package and interface names.
It is enabled by passing two non-flag arguments: an import path, and a
comma-separated list of symbols.</p>
<p dir="auto">You can use "." to refer to the current path's package.</p>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mockgen database/sql/driver Conn,Driver

# Convenient for `go:generate`.
mockgen . Conn,Driver"><pre>mockgen database/sql/driver Conn,Driver

<span class="pl-c"><span class="pl-c">#</span> Convenient for `go:generate`.</span>
mockgen <span class="pl-c1">.</span> Conn,Driver</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Flags</h3><a id="user-content-flags" class="anchor" aria-label="Permalink: Flags" href="#flags"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>mockgen</code> command is used to generate source code for a mock
class given a Go source file containing interfaces to be mocked.
It supports the following flags:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>-archive</code>: A package archive file containing interfaces to be mocked.</p>
</li>
<li>
<p dir="auto"><code>-source</code>: A file containing interfaces to be mocked.</p>
</li>
<li>
<p dir="auto"><code>-destination</code>: A file to which to write the resulting source code. If you
don't set this, the code is printed to standard output.</p>
</li>
<li>
<p dir="auto"><code>-package</code>: The package to use for the resulting mock class
source code. If you don't set this, the package name is <code>mock_</code> concatenated
with the package of the input file.</p>
</li>
<li>
<p dir="auto"><code>-imports</code>: A list of explicit imports that should be used in the resulting
source code, specified as a comma-separated list of elements of the form
<code>foo=bar/baz</code>, where <code>bar/baz</code> is the package being imported and <code>foo</code> is
the identifier to use for the package in the generated source code.</p>
</li>
<li>
<p dir="auto"><code>-aux_files</code>: A list of additional files that should be consulted to
resolve e.g. embedded interfaces defined in a different file. This is
specified as a comma-separated list of elements of the form
<code>foo=bar/baz.go</code>, where <code>bar/baz.go</code> is the source file and <code>foo</code> is the
package name of that file used by the -source file.</p>
</li>
<li>
<p dir="auto"><code>-build_flags</code>: (package mode only) Flags passed verbatim to <code>go list</code>.</p>
</li>
<li>
<p dir="auto"><code>-mock_names</code>: A list of custom names for generated mocks. This is specified
as a comma-separated list of elements of the form
<code>Repository=MockSensorRepository,Endpoint=MockSensorEndpoint</code>, where
<code>Repository</code> is the interface name and <code>MockSensorRepository</code> is the desired
mock name (mock factory method and mock recorder will be named after the mock).
If one of the interfaces has no custom name specified, then default naming
convention will be used.</p>
</li>
<li>
<p dir="auto"><code>-self_package</code>: The full package import path for the generated code. The
purpose of this flag is to prevent import cycles in the generated code by
trying to include its own package. This can happen if the mock's package is
set to one of its inputs (usually the main one) and the output is stdio so
mockgen cannot detect the final output package. Setting this flag will then
tell mockgen which import to exclude.</p>
</li>
<li>
<p dir="auto"><code>-copyright_file</code>: Copyright file used to add copyright header to the resulting source code.</p>
</li>
<li>
<p dir="auto"><code>-debug_parser</code>: Print out parser results only.</p>
</li>
<li>
<p dir="auto"><code>-write_package_comment</code>: Writes package documentation comment (godoc) if true. (default true)</p>
</li>
<li>
<p dir="auto"><code>-write_generate_directive</code>: Add //go:generate directive to regenerate the mock. (default false)</p>
</li>
<li>
<p dir="auto"><code>-write_source_comment</code>: Writes original file (source mode) or interface names (package mode) comment if true. (default true)</p>
</li>
<li>
<p dir="auto"><code>-typed</code>: Generate Type-safe 'Return', 'Do', 'DoAndReturn' function. (default false)</p>
</li>
<li>
<p dir="auto"><code>-exclude_interfaces</code>: Comma-separated names of interfaces to be excluded</p>
</li>
</ul>
<p dir="auto">For an example of the use of <code>mockgen</code>, see the <code>sample/</code> directory. In simple
cases, you will need only the <code>-source</code> flag.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Building Mocks</h2><a id="user-content-building-mocks" class="anchor" aria-label="Permalink: Building Mocks" href="#building-mocks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-go notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="type Foo interface {
  Bar(x int) int
}

func SUT(f Foo) {
 // ...
}
"><pre><span class="pl-k">type</span> <span class="pl-smi">Foo</span> <span class="pl-k">interface</span> {
  <span class="pl-c1">Bar</span>(<span class="pl-s1">x</span> <span class="pl-smi">int</span>) <span class="pl-smi">int</span>
}

<span class="pl-k">func</span> <span class="pl-s1">SUT</span>(<span class="pl-s1">f</span> <span class="pl-smi">Foo</span>) {
 <span class="pl-c">// ...</span>
}</pre></div>
<div class="highlight highlight-source-go notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="func TestFoo(t *testing.T) {
  ctrl := gomock.NewController(t)

  m := NewMockFoo(ctrl)

  // Asserts that the first and only call to Bar() is passed 99.
  // Anything else will fail.
  m.
    EXPECT().
    Bar(gomock.Eq(99)).
    Return(101)

  SUT(m)
}"><pre><span class="pl-k">func</span> <span class="pl-s1">TestFoo</span>(<span class="pl-s1">t</span> <span class="pl-c1">*</span>testing.<span class="pl-smi">T</span>) {
  <span class="pl-s1">ctrl</span> <span class="pl-c1">:=</span> <span class="pl-s1">gomock</span>.<span class="pl-c1">NewController</span>(<span class="pl-s1">t</span>)

  <span class="pl-s1">m</span> <span class="pl-c1">:=</span> <span class="pl-s1">NewMockFoo</span>(<span class="pl-s1">ctrl</span>)

  <span class="pl-c">// Asserts that the first and only call to Bar() is passed 99.</span>
  <span class="pl-c">// Anything else will fail.</span>
  <span class="pl-s1">m</span>.
    <span class="pl-c1">EXPECT</span>().
    <span class="pl-c1">Bar</span>(<span class="pl-s1">gomock</span>.<span class="pl-c1">Eq</span>(<span class="pl-c1">99</span>)).
    <span class="pl-c1">Return</span>(<span class="pl-c1">101</span>)

  <span class="pl-s1">SUT</span>(<span class="pl-s1">m</span>)
}</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Building Stubs</h2><a id="user-content-building-stubs" class="anchor" aria-label="Permalink: Building Stubs" href="#building-stubs"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-go notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="type Foo interface {
  Bar(x int) int
}

func SUT(f Foo) {
 // ...
}
"><pre><span class="pl-k">type</span> <span class="pl-smi">Foo</span> <span class="pl-k">interface</span> {
  <span class="pl-c1">Bar</span>(<span class="pl-s1">x</span> <span class="pl-smi">int</span>) <span class="pl-smi">int</span>
}

<span class="pl-k">func</span> <span class="pl-s1">SUT</span>(<span class="pl-s1">f</span> <span class="pl-smi">Foo</span>) {
 <span class="pl-c">// ...</span>
}</pre></div>
<div class="highlight highlight-source-go notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="func TestFoo(t *testing.T) {
  ctrl := gomock.NewController(t)

  m := NewMockFoo(ctrl)

  // Does not make any assertions. Executes the anonymous functions and returns
  // its result when Bar is invoked with 99.
  m.
    EXPECT().
    Bar(gomock.Eq(99)).
    DoAndReturn(func(_ int) int {
      time.Sleep(1*time.Second)
      return 101
    }).
    AnyTimes()

  // Does not make any assertions. Returns 103 when Bar is invoked with 101.
  m.
    EXPECT().
    Bar(gomock.Eq(101)).
    Return(103).
    AnyTimes()

  SUT(m)
}"><pre><span class="pl-k">func</span> <span class="pl-s1">TestFoo</span>(<span class="pl-s1">t</span> <span class="pl-c1">*</span>testing.<span class="pl-smi">T</span>) {
  <span class="pl-s1">ctrl</span> <span class="pl-c1">:=</span> <span class="pl-s1">gomock</span>.<span class="pl-c1">NewController</span>(<span class="pl-s1">t</span>)

  <span class="pl-s1">m</span> <span class="pl-c1">:=</span> <span class="pl-s1">NewMockFoo</span>(<span class="pl-s1">ctrl</span>)

  <span class="pl-c">// Does not make any assertions. Executes the anonymous functions and returns</span>
  <span class="pl-c">// its result when Bar is invoked with 99.</span>
  <span class="pl-s1">m</span>.
    <span class="pl-c1">EXPECT</span>().
    <span class="pl-c1">Bar</span>(<span class="pl-s1">gomock</span>.<span class="pl-c1">Eq</span>(<span class="pl-c1">99</span>)).
    <span class="pl-c1">DoAndReturn</span>(<span class="pl-k">func</span>(<span class="pl-s1">_</span> <span class="pl-smi">int</span>) <span class="pl-smi">int</span> {
      <span class="pl-s1">time</span>.<span class="pl-c1">Sleep</span>(<span class="pl-c1">1</span><span class="pl-c1">*</span><span class="pl-s1">time</span>.<span class="pl-c1">Second</span>)
      <span class="pl-k">return</span> <span class="pl-c1">101</span>
    }).
    <span class="pl-c1">AnyTimes</span>()

  <span class="pl-c">// Does not make any assertions. Returns 103 when Bar is invoked with 101.</span>
  <span class="pl-s1">m</span>.
    <span class="pl-c1">EXPECT</span>().
    <span class="pl-c1">Bar</span>(<span class="pl-s1">gomock</span>.<span class="pl-c1">Eq</span>(<span class="pl-c1">101</span>)).
    <span class="pl-c1">Return</span>(<span class="pl-c1">103</span>).
    <span class="pl-c1">AnyTimes</span>()

  <span class="pl-s1">SUT</span>(<span class="pl-s1">m</span>)
}</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Modifying Failure Messages</h2><a id="user-content-modifying-failure-messages" class="anchor" aria-label="Permalink: Modifying Failure Messages" href="#modifying-failure-messages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">When a matcher reports a failure, it prints the received (<code>Got</code>) vs the
expected (<code>Want</code>) value.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="Got: [3]
Want: is equal to 2
Expected call at user_test.go:33 doesn't match the argument at index 1.
Got: [0 1 1 2 3]
Want: is equal to 1"><pre>Got: [3]
Want: is equal to 2
Expected call at user_test.go:33 doesn<span class="pl-s"><span class="pl-pds">'</span>t match the argument at index 1.</span>
<span class="pl-s">Got: [0 1 1 2 3]</span>
<span class="pl-s">Want: is equal to 1</span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Modifying <code>Want</code></h3><a id="user-content-modifying-want" class="anchor" aria-label="Permalink: Modifying Want" href="#modifying-want"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>Want</code> value comes from the matcher's <code>String()</code> method. If the matcher's
default output doesn't meet your needs, then it can be modified as follows:</p>
<div class="highlight highlight-source-go notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gomock.WantFormatter(
  gomock.StringerFunc(func() string { return &quot;is equal to fifteen&quot; }),
  gomock.Eq(15),
)"><pre><span class="pl-s1">gomock</span>.<span class="pl-c1">WantFormatter</span>(
  <span class="pl-s1">gomock</span>.<span class="pl-c1">StringerFunc</span>(<span class="pl-k">func</span>() <span class="pl-smi">string</span> { <span class="pl-k">return</span> <span class="pl-s">"is equal to fifteen"</span> }),
  <span class="pl-s1">gomock</span>.<span class="pl-c1">Eq</span>(<span class="pl-c1">15</span>),
)</pre></div>
<p dir="auto">This modifies the <code>gomock.Eq(15)</code> matcher's output for <code>Want:</code> from <code>is equal to 15</code> to <code>is equal to fifteen</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Modifying <code>Got</code></h3><a id="user-content-modifying-got" class="anchor" aria-label="Permalink: Modifying Got" href="#modifying-got"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>Got</code> value comes from the object's <code>String()</code> method if it is available.
In some cases the output of an object is difficult to read (e.g., <code>[]byte</code>) and
it would be helpful for the test to print it differently. The following
modifies how the <code>Got</code> value is formatted:</p>
<div class="highlight highlight-source-go notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gomock.GotFormatterAdapter(
  gomock.GotFormatterFunc(func(i any) string {
    // Leading 0s
    return fmt.Sprintf(&quot;%02d&quot;, i)
  }),
  gomock.Eq(15),
)"><pre><span class="pl-s1">gomock</span>.<span class="pl-c1">GotFormatterAdapter</span>(
  <span class="pl-s1">gomock</span>.<span class="pl-c1">GotFormatterFunc</span>(<span class="pl-k">func</span>(<span class="pl-s1">i</span> <span class="pl-smi">any</span>) <span class="pl-smi">string</span> {
    <span class="pl-c">// Leading 0s</span>
    <span class="pl-k">return</span> <span class="pl-s1">fmt</span>.<span class="pl-c1">Sprintf</span>(<span class="pl-s">"%02d"</span>, <span class="pl-s1">i</span>)
  }),
  <span class="pl-s1">gomock</span>.<span class="pl-c1">Eq</span>(<span class="pl-c1">15</span>),
)</pre></div>
<p dir="auto">If the received value is <code>3</code>, then it will be printed as <code>03</code>.</p>
</article></div>