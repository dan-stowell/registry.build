<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/logo.png"><img src="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/logo.png" alt="nanoflann" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">nanoflann</h1><a id="user-content-nanoflann" class="anchor" aria-label="Permalink: nanoflann" href="#nanoflann"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/jlblancoc/nanoflann/actions/workflows/ci-linux.yml"><img src="https://github.com/jlblancoc/nanoflann/actions/workflows/ci-linux.yml/badge.svg" alt="CI Linux" style="max-width: 100%;"></a>
<a href="https://github.com/jlblancoc/nanoflann/actions/workflows/check-clang-format.yml"><img src="https://github.com/jlblancoc/nanoflann/actions/workflows/check-clang-format.yml/badge.svg" alt="CI Check clang-format" style="max-width: 100%;"></a>
<a href="https://circleci.com/gh/jlblancoc/nanoflann/tree/master" rel="nofollow"><img src="https://camo.githubusercontent.com/3a1a1c24c6758471ca5a477f3a25c818cbc0cc28c2ed9abb2f5c6ea1c84d338f/68747470733a2f2f636972636c6563692e636f6d2f67682f6a6c626c616e636f632f6e616e6f666c616e6e2f747265652f6d61737465722e7376673f7374796c653d737667" alt="CircleCI" data-canonical-src="https://circleci.com/gh/jlblancoc/nanoflann/tree/master.svg?style=svg" style="max-width: 100%;"></a>
<a href="https://ci.appveyor.com/project/jlblancoc/nanoflann/branch/master" rel="nofollow"><img src="https://camo.githubusercontent.com/99632bfa8aaa0a0484ead1f45e702ee462b57f6e4f67bd748735a8bb89c90ce7/68747470733a2f2f63692e6170707665796f722e636f6d2f6170692f70726f6a656374732f7374617475732f68386b316170666f6778797168736b642f6272616e63682f6d61737465723f7376673d74727565" alt="Windows build status" data-canonical-src="https://ci.appveyor.com/api/projects/status/h8k1apfogxyqhskd/branch/master?svg=true" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">1. About</h2><a id="user-content-1-about" class="anchor" aria-label="Permalink: 1. About" href="#1-about"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><em>nanoflann</em> is a <strong>C++11 <a href="http://en.wikipedia.org/wiki/Header-only" rel="nofollow">header-only</a> library</strong> for building KD-Trees of datasets with different topologies: R<sup>2</sup>, R<sup>3</sup> (point clouds), SO(2) and SO(3) (2D and 3D rotation groups). No support for approximate NN is provided. <em>nanoflann</em> does not require compiling or installing. You just need to <code>#include &lt;nanoflann.hpp&gt;</code> in your code.</p>
<p dir="auto">This library is a <em>fork</em> of the <a href="https://github.com/flann-lib/flann">flann library</a> by Marius Muja and David G. Lowe, and born as a child project of <a href="https://www.mrpt.org/" rel="nofollow">MRPT</a>. Following the original license terms, <em>nanoflann</em> is distributed under the BSD license. Please, for bugs use the issues button or fork and open a pull request.</p>
<p dir="auto">Cite as:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="@misc{blanco2014nanoflann,
  title        = {nanoflann: a {C}++ header-only fork of {FLANN}, a library for Nearest Neighbor ({NN}) with KD-trees},
  author       = {Blanco, Jose Luis and Rai, Pranjal Kumar},
  howpublished = {\url{https://github.com/jlblancoc/nanoflann}},
  year         = {2014}
}"><pre class="notranslate"><code>@misc{blanco2014nanoflann,
  title        = {nanoflann: a {C}++ header-only fork of {FLANN}, a library for Nearest Neighbor ({NN}) with KD-trees},
  author       = {Blanco, Jose Luis and Rai, Pranjal Kumar},
  howpublished = {\url{https://github.com/jlblancoc/nanoflann}},
  year         = {2014}
}
</code></pre></div>
<p dir="auto">See the release <a href="CHANGELOG.md">CHANGELOG</a> for a list of project changes.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.1. Obtaining the code</h3><a id="user-content-11-obtaining-the-code" class="anchor" aria-label="Permalink: 1.1. Obtaining the code" href="#11-obtaining-the-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Easiest way: clone this GIT repository and take the <code>include/nanoflann.hpp</code> file for use where you need it.</li>
<li>Debian or Ubuntu (<a href="https://packages.ubuntu.com/source/hirsute/nanoflann" rel="nofollow">21.04 or newer</a>) users can install it simply with:
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ sudo apt install libnanoflann-dev"><pre>$ sudo apt install libnanoflann-dev</pre></div>
</li>
<li>macOS users can install <code>nanoflann</code> with <a href="https://brew.sh" rel="nofollow">Homebrew</a> with:
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ brew install brewsci/science/nanoflann"><pre>$ brew install brewsci/science/nanoflann</pre></div>
or
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ brew tap brewsci/science
$ brew install nanoflann"><pre>$ brew tap brewsci/science
$ brew install nanoflann</pre></div>
MacPorts users can use:
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ sudo port install nanoflann"><pre>$ sudo port install nanoflann</pre></div>
</li>
<li>Linux users can also install it with <a href="https://docs.brew.sh/Homebrew-on-Linux" rel="nofollow">Linuxbrew</a> with: <code>brew install homebrew/science/nanoflann</code></li>
<li>List of <a href="https://github.com/jlblancoc/nanoflann/releases"><strong>stable releases</strong></a>. Check out the <a href="https://github.com/jlblancoc/nanoflann/blob/master/CHANGELOG.md">CHANGELOG</a></li>
</ul>
<p dir="auto">Although nanoflann itself doesn't have to be compiled, you can build some examples and tests with:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ sudo apt-get install build-essential cmake libgtest-dev libeigen3-dev
$ mkdir build &amp;&amp; cd build &amp;&amp; cmake ..
$ make &amp;&amp; make test"><pre>$ sudo apt-get install build-essential cmake libgtest-dev libeigen3-dev
$ mkdir build <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">cd</span> build <span class="pl-k">&amp;&amp;</span> cmake ..
$ make <span class="pl-k">&amp;&amp;</span> make <span class="pl-c1">test</span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.2. C++ API reference</h3><a id="user-content-12-c-api-reference" class="anchor" aria-label="Permalink: 1.2. C++ API reference" href="#12-c-api-reference"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>
<p dir="auto">Browse the <a href="https://jlblancoc.github.io/nanoflann/" rel="nofollow">Doxygen documentation</a>.</p>
</li>
<li>
<p dir="auto"><strong>Important note:</strong> If L2 norms are used, notice that search radius and all passed and returned distances are actually <em>squared distances</em>.</p>
</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.3. Code examples</h3><a id="user-content-13-code-examples" class="anchor" aria-label="Permalink: 1.3. Code examples" href="#13-code-examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>KD-tree look-up with <code>knnSearch()</code> and <code>radiusSearch()</code>: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/pointcloud_kdd_radius.cpp">pointcloud_kdd_radius.cpp</a></li>
<li>KD-tree look-up on a point cloud dataset: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/pointcloud_example.cpp">pointcloud_example.cpp</a></li>
<li>KD-tree look-up on a dynamic point cloud dataset: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/dynamic_pointcloud_example.cpp">dynamic_pointcloud_example.cpp</a></li>
<li>KD-tree look-up on a rotation group (SO2): <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/SO2_adaptor_example.cpp">SO2_example.cpp</a></li>
<li>KD-tree look-up on a rotation group (SO3): <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/SO3_adaptor_example.cpp">SO3_example.cpp</a></li>
<li>KD-tree look-up on a point cloud dataset with an external adaptor class: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/pointcloud_adaptor_example.cpp">pointcloud_adaptor_example.cpp</a></li>
<li>KD-tree look-up directly on an <code>Eigen::Matrix&lt;&gt;</code>: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/matrix_example.cpp">matrix_example.cpp</a></li>
<li>KD-tree look-up directly on <code>std::vector&lt;std::vector&lt;T&gt; &gt;</code> or <code>std::vector&lt;Eigen::VectorXd&gt;</code>: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/vector_of_vectors_example.cpp">vector_of_vectors_example.cpp</a></li>
<li>Example with a <code>Makefile</code> for usage through <code>pkg-config</code> (for example, after doing a "make install" or after installing from Ubuntu repositories): <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/example_with_pkgconfig/">example_with_pkgconfig/</a></li>
<li>Example of how to build an index and save it to disk for later usage: <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/saveload_example.cpp">saveload_example.cpp</a></li>
<li>GUI examples (requires <code>mrpt-gui</code>, e.g. <code>sudo apt install libmrpt-gui-dev</code>):
<ul dir="auto">
<li><a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/examples_gui/nanoflann_gui_example_R3/nanoflann_gui_example_R3.cpp">nanoflann_gui_example_R3</a></li>
</ul>
</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/5497818/201550433-d561c5a9-4e87-453d-9cf8-8202d7876235.gif"><img src="https://user-images.githubusercontent.com/5497818/201550433-d561c5a9-4e87-453d-9cf8-8202d7876235.gif" alt="nanoflann-demo-1" data-animated-image="" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.4. Why a fork?</h3><a id="user-content-14-why-a-fork" class="anchor" aria-label="Permalink: 1.4. Why a fork?" href="#14-why-a-fork"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>
<p dir="auto"><strong>Execution time efficiency</strong>:</p>
<ul dir="auto">
<li>The power of the original <code>flann</code> library comes from the possibility of choosing between different ANN algorithms. The cost of this flexibility is the declaration of pure virtual methods which (in some circumstances) impose <a href="http://www.cs.cmu.edu/~gilpin/c%2B%2B/performance.html#virtualfunctions" rel="nofollow">run-time penalties</a>. In <code>nanoflann</code> all those virtual methods have been replaced by a combination of the <a href="http://en.wikipedia.org/wiki/Curiously_recurring_template_pattern" rel="nofollow">Curiously Recurring Template Pattern</a> (CRTP) and inlined methods, which are much faster.</li>
<li>For <code>radiusSearch()</code>, there is no need to make a call to determine the number of points within the radius and then call it again to get the data. By using STL containers for the output data, containers are automatically resized.</li>
<li>Users can (optionally) set the problem dimensionality at compile-time via a template argument, thus allowing the compiler to fully unroll loops.</li>
<li><code>nanoflann</code> allows users to provide a precomputed bounding box of the data, if available, to avoid recomputation.</li>
<li>Indices of data points have been converted from <code>int</code> to <code>size_t</code>, which removes a limit when handling very large data sets.</li>
</ul>
</li>
<li>
<p dir="auto"><strong>Memory efficiency</strong>: Instead of making a copy of the entire dataset into a custom <code>flann</code>-like matrix before building a KD-tree index, <code>nanoflann</code> allows direct access to your data via an <strong>adaptor interface</strong> which must be implemented in your class.</p>
</li>
</ul>
<p dir="auto">Refer to the examples below or to the C++ API of <a href="https://jlblancoc.github.io/nanoflann/classnanoflann_1_1KDTreeSingleIndexAdaptor.html" rel="nofollow">nanoflann::KDTreeSingleIndexAdaptor&lt;&gt;</a> for more info.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.5. What can <em>nanoflann</em> do?</h3><a id="user-content-15-what-can-nanoflann-do" class="anchor" aria-label="Permalink: 1.5. What can nanoflann do?" href="#15-what-can-nanoflann-do"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Building KD-trees with a single index (no randomized KD-trees, no approximate searches).</li>
<li>Fast, thread-safe querying for closest neighbors on KD-trees. The entry points are:
<ul dir="auto">
<li><a href="https://jlblancoc.github.io/nanoflann/classnanoflann_1_1KDTreeSingleIndexAdaptor.html" rel="nofollow">nanoflann::KDTreeSingleIndexAdaptor&lt;&gt;</a><code>::knnSearch()</code>
<ul dir="auto">
<li>Finds the <code>num_closest</code> nearest neighbors to <code>query_point[0:dim-1]</code>. Their indices are stored inside the result object. See an <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/pointcloud_kdd_radius.cpp#L119">example usage code</a>.</li>
</ul>
</li>
<li><a href="https://jlblancoc.github.io/nanoflann/classnanoflann_1_1KDTreeSingleIndexAdaptor.html" rel="nofollow">nanoflann::KDTreeSingleIndexAdaptor&lt;&gt;</a><code>::radiusSearch()</code>
<ul dir="auto">
<li>Finds all the neighbors to <code>query_point[0:dim-1]</code> within a maximum radius. The output is given as a vector of pairs, of which the first element is a point index and the second the corresponding distance. See an <a href="https://github.com/jlblancoc/nanoflann/blob/master/examples/pointcloud_kdd_radius.cpp#L141">example usage code</a>.</li>
</ul>
</li>
<li><a href="https://jlblancoc.github.io/nanoflann/classnanoflann_1_1KDTreeSingleIndexAdaptor.html" rel="nofollow">nanoflann::KDTreeSingleIndexAdaptor&lt;&gt;</a><code>::radiusSearchCustomCallback()</code>
<ul dir="auto">
<li>Can be used to receive a callback for each point found in range. This may be more efficient in some situations instead of building a huge vector of pairs with the results.</li>
</ul>
</li>
</ul>
</li>
<li>Working with 2D and 3D point clouds or N-dimensional data sets.</li>
<li>Working directly with <code>Eigen::Matrix&lt;&gt;</code> classes (matrices and vectors-of-vectors).</li>
<li>Working with dynamic point clouds without a need to rebuild entire kd-tree index.</li>
<li>Working with the distance metrics:
<ul dir="auto">
<li><code>R^N</code>: Euclidean spaces:
<ul dir="auto">
<li><code>L1</code> (Manhattan)</li>
<li><code>L2</code> (<strong>squared</strong> Euclidean norm, favoring SSE2 optimization).</li>
<li><code>L2_Simple</code> (<strong>squared</strong> Euclidean norm, for low-dimensionality data sets like point clouds).</li>
</ul>
</li>
<li><code>SO(2)</code>: 2D rotational group
<ul dir="auto">
<li><code>metric_SO2</code>: Absolute angular diference.</li>
</ul>
</li>
<li><code>SO(3)</code>: 3D rotational group (better suppport to be provided in future releases)
<ul dir="auto">
<li><code>metric_SO3</code>: Inner product between quaternions.</li>
</ul>
</li>
</ul>
</li>
<li>Saves and load the built indices to disk.</li>
<li>GUI based support for benchmarking multiple kd-tree libraries namely nanoflann, flann, fastann and libkdtree.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.6. What can't <em>nanoflann</em> do?</h3><a id="user-content-16-what-cant-nanoflann-do" class="anchor" aria-label="Permalink: 1.6. What can't nanoflann do?" href="#16-what-cant-nanoflann-do"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Use other distance metrics apart from L1, L2, SO2 and SO3.</li>
<li>Support for SE(3) groups.</li>
<li>Only the C++ interface exists: there is no support for C, MATLAB or Python.</li>
<li>There is no automatic algorithm configuration (as described in the original Muja &amp; Lowe's paper).</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.7. Use in your project via CMake</h3><a id="user-content-17-use-in-your-project-via-cmake" class="anchor" aria-label="Permalink: 1.7. Use in your project via CMake" href="#17-use-in-your-project-via-cmake"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can directly drop the <code>nanoflann.hpp</code> file in your project. Alternatively,
the CMake standard method is also available:</p>
<ul dir="auto">
<li>Build and "install" nanoflann. Set <code>CMAKE_INSTALL_PREFIX</code> to a proper path
and then execute <code>make install</code> (Linux, OSX) or build the <code>INSTALL</code>
target (Visual Studio).</li>
<li>Then, add something like this to the CMake script of your project:</li>
</ul>
<div class="highlight highlight-source-cmake notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Find nanoflannConfig.cmake:
find_package(nanoflann)

add_executable(my_project test.cpp)

# Make sure the include path is used:
target_link_libraries(my_project nanoflann::nanoflann)"><pre><span class="pl-c">#<span class="pl-c"> Find nanoflannConfig.cmake:</span></span>
<span class="pl-c1">find_package</span>(<span class="pl-s">nanoflann</span>)

<span class="pl-c1">add_executable</span>(<span class="pl-s">my_project</span> <span class="pl-c1">test</span><span class="pl-s">.cpp</span>)

<span class="pl-c">#<span class="pl-c"> Make sure the include path is used:</span></span>
<span class="pl-c1">target_link_libraries</span>(<span class="pl-s">my_project</span> <span class="pl-s">nanoflann::nanoflann</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.8. Package Managers</h3><a id="user-content-18-package-managers" class="anchor" aria-label="Permalink: 1.8. Package Managers" href="#18-package-managers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Using <code>conan</code></h4><a id="user-content-using-conan" class="anchor" aria-label="Permalink: Using conan" href="#using-conan"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can install pre-built binaries for <code>nanoflann</code> or build it from source using <a href="https://conan.io/" rel="nofollow">Conan</a>. Use the following command to install latest version:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ conan install --requires=&quot;nanoflann/[*]&quot; --build=missing"><pre>$ conan install --requires=<span class="pl-s"><span class="pl-pds">"</span>nanoflann/[*]<span class="pl-pds">"</span></span> --build=missing</pre></div>
<p dir="auto">For detailed instructions on how to use Conan, please refer to the <a href="https://docs.conan.io/2/" rel="nofollow">Conan documentation</a>.</p>
<p dir="auto">The <code>nanoflann</code> Conan recipe is kept up to date by Conan maintainers and community contributors.
If the version is out of date, please <a href="https://github.com/conan-io/conan-center-index">create an issue or pull request</a> on the ConanCenterIndex repository.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Using <code>vcpkg</code></h4><a id="user-content-using-vcpkg" class="anchor" aria-label="Permalink: Using vcpkg" href="#using-vcpkg"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can download and install nanoflann using the <a href="https://github.com/Microsoft/vcpkg">vcpkg</a> dependency manager:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ git clone https://github.com/Microsoft/vcpkg.git
$ cd vcpkg
$ ./bootstrap-vcpkg.sh
$ ./vcpkg integrate install
$ ./vcpkg install nanoflann"><pre>$ git clone https://github.com/Microsoft/vcpkg.git
$ <span class="pl-c1">cd</span> vcpkg
$ ./bootstrap-vcpkg.sh
$ ./vcpkg integrate install
$ ./vcpkg install nanoflann</pre></div>
<p dir="auto">The nanoflann port in vcpkg is kept up to date by Microsoft team members and community contributors. If the version is out of date, please <a href="https://github.com/Microsoft/vcpkg">create an issue or pull request</a> on the vcpkg repository.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">1.9. Compile time definitions</h3><a id="user-content-19-compile-time-definitions" class="anchor" aria-label="Permalink: 1.9. Compile time definitions" href="#19-compile-time-definitions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><code>NANOFLANN_FIRST_MATCH</code>: If defined and two points have the same distance, the one with the lowest-index will be returned first. Otherwise there is no particular order.</li>
<li><code>NANOFLANN_NO_THREADS</code>: If defined, multithreading capabilities will be disabled, so that the library can be used without linking with pthreads. If one tries to use multiple threads, an exception will be thrown.</li>
</ul>
<hr>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">2. Any help choosing the KD-tree parameters?</h2><a id="user-content-2-any-help-choosing-the-kd-tree-parameters" class="anchor" aria-label="Permalink: 2. Any help choosing the KD-tree parameters?" href="#2-any-help-choosing-the-kd-tree-parameters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">2.1. <code>KDTreeSingleIndexAdaptorParams::leaf_max_size</code></h3><a id="user-content-21-kdtreesingleindexadaptorparamsleaf_max_size" class="anchor" aria-label="Permalink: 2.1. KDTreeSingleIndexAdaptorParams::leaf_max_size" href="#21-kdtreesingleindexadaptorparamsleaf_max_size"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A KD-tree is... well, a tree :-). And as such it has a root node, a set of intermediary nodes and finally, "leaf" nodes which are those without children.</p>
<p dir="auto">Points (or, properly, point indices) are only stored in leaf nodes. Each leaf contains a list of which points fall within its range.</p>
<p dir="auto">While building the tree, nodes are recursively divided until the number of points inside is equal or below some threshold. <strong>That is <code>leaf_max_size</code></strong>. While doing queries, the  "tree algorithm" ends by selecting leaf nodes, then performing linear search (one-by-one) for the closest point to the query within all those in the leaf.</p>
<p dir="auto">So, <code>leaf_max_size</code> must be set as a <strong>tradeoff</strong>:</p>
<ul dir="auto">
<li>Large values mean that the tree will be built faster (since the tree will be smaller), but each query will be slower (since the linear search in the leaf is to be done over more points).</li>
<li>Small values will build the tree much slower (there will be many tree nodes), but queries will be faster... up to some point, since the "tree-part" of the search (logarithmic complexity) still has a significant cost.</li>
</ul>
<p dir="auto">What number to select really depends on the application and even on the size of the processor cache memory, so ideally you should do some benchmarking for maximizing efficiency.</p>
<p dir="auto">But to help choosing a good value as a rule of thumb, I provide the following two benchmarks. Each graph represents the tree build (horizontal) and query (vertical) times for different <code>leaf_max_size</code> values between 1 and 10K (as 95% uncertainty ellipses, deformed due to the logarithmic scale).</p>
<ul dir="auto">
<li>A 100K point cloud, uniformly distributed (each point has (x,y,z) <code>float</code> coordinates):</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf5_1e5pts_time_vs_maxleaf.png"><img src="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf5_1e5pts_time_vs_maxleaf.png" alt="perf5_1e5pts_time_vs_maxleaf" style="max-width: 100%;"></a></p>
<ul dir="auto">
<li>A ~150K point cloud from a real dataset (<code>scan_071_points.dat</code> from the <a href="http://ais.informatik.uni-freiburg.de/projects/datasets/fr360/" rel="nofollow">Freiburg Campus 360 dataset</a>, each point has (x,y,z) <code>float</code> coordinates):</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf5_1e5pts_time_vs_maxleaf_real_dataset.png"><img src="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf5_1e5pts_time_vs_maxleaf_real_dataset.png" alt="perf5_1e5pts_time_vs_maxleaf_real_dataset" style="max-width: 100%;"></a></p>
<p dir="auto">So, it seems that a <code>leaf_max_size</code> <strong>between 10 and 50</strong> would be optimum in applications where the cost of queries dominates (e.g. <a href="http://en.wikipedia.org/wiki/Iterative_closest_point%5D" rel="nofollow">ICP</a>). At present, its default value is 10.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">2.2. <code>KDTreeSingleIndexAdaptorParams::checks</code></h3><a id="user-content-22-kdtreesingleindexadaptorparamschecks" class="anchor" aria-label="Permalink: 2.2. KDTreeSingleIndexAdaptorParams::checks" href="#22-kdtreesingleindexadaptorparamschecks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This parameter is really ignored in <code>nanoflann</code>, but was kept for backward compatibility with the original FLANN interface. Just ignore it.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">2.3. <code>KDTreeSingleIndexAdaptorParams::n_thread_build</code></h3><a id="user-content-23-kdtreesingleindexadaptorparamsn_thread_build" class="anchor" aria-label="Permalink: 2.3. KDTreeSingleIndexAdaptorParams::n_thread_build" href="#23-kdtreesingleindexadaptorparamsn_thread_build"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This parameter determines the maximum number of threads that can be called concurrently during the construction of the KD tree. The default value is 1. When the parameter is set to 0, <code>nanoflann</code> automatically determines the number of threads to use.</p>
<p dir="auto">See <a href="https://github.com/jlblancoc/nanoflann/pull/236" data-hovercard-type="pull_request" data-hovercard-url="/jlblancoc/nanoflann/pull/236/hovercard">this pull request</a> for some benchmarking showing that using the maximum number of threads is not always the most efficient approach. Do benchmarking on your data!</p>
<hr>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">3. Performance</h2><a id="user-content-3-performance" class="anchor" aria-label="Permalink: 3. Performance" href="#3-performance"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">3.1. <code>nanoflann</code>: faster and less memory usage</h3><a id="user-content-31-nanoflann-faster-and-less-memory-usage" class="anchor" aria-label="Permalink: 3.1. nanoflann: faster and less memory usage" href="#31-nanoflann-faster-and-less-memory-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Refer to the "Why a fork?" section above for the main optimization ideas behind <code>nanoflann</code>.</p>
<p dir="auto">Notice that there are no explicit SSE2/SSE3 optimizations in <code>nanoflann</code>, but the intensive usage of <code>inline</code> and templates in practice turns into automatically SSE-optimized code generated by the compiler.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">3.2. Benchmark: original <code>flann</code> vs <code>nanoflann</code></h3><a id="user-content-32-benchmark-original-flann-vs-nanoflann" class="anchor" aria-label="Permalink: 3.2. Benchmark: original flann vs nanoflann" href="#32-benchmark-original-flann-vs-nanoflann"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The most time-consuming part of many point cloud algorithms (like ICP) is querying a KD-Tree for nearest neighbors. This operation is therefore the most time critical.</p>
<p dir="auto"><code>nanoflann</code> provides a ~50% time saving with respect to the original <code>flann</code> implementation (times in this chart are in microseconds for each query):</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf3_query.small.png"><img src="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf3_query.small.png" alt="perf3_query" style="max-width: 100%;"></a></p>
<p dir="auto">Although most of the gain comes from the queries (due to the large number of them in any typical operation with point clouds), there is also some time saved while building the KD-tree index, due to the templatized-code but also for the avoidance of duplicating the data in an auxiliary matrix (times in the next chart are in milliseconds):</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf4_time_saved.small.png"><img src="https://raw.githubusercontent.com/jlblancoc/nanoflann/master/doc/perf4_time_saved.small.png" alt="perf4_time_saved" style="max-width: 100%;"></a></p>
<p dir="auto">These performance tests are only representative of our testing. If you want to repeat them, read the instructions in <a href="https://github.com/jlblancoc/nanoflann/tree/master/perf-tests">perf-tests</a></p>
<hr>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">4. Other KD-tree projects</h2><a id="user-content-4-other-kd-tree-projects" class="anchor" aria-label="Permalink: 4. Other KD-tree projects" href="#4-other-kd-tree-projects"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="http://www.cs.ubc.ca/research/flann/" rel="nofollow">FLANN</a> - Marius Muja and David G. Lowe (University of British Columbia).</li>
<li><a href="http://www.robots.ox.ac.uk/~vgg/software/fastann/" rel="nofollow">FASTANN</a> - James Philbin (VGG, University of Oxford).</li>
<li><a href="http://www.cs.umd.edu/~mount/ANN/" rel="nofollow">ANN</a> - David M. Mount and Sunil Arya (University of Maryland).</li>
<li><a href="https://packages.debian.org/source/sid/libkdtree++" rel="nofollow">libkdtree++</a> - Martin F. Krafft &amp; others.</li>
</ul>
<br>
<p dir="auto"><em>Note: The project logo is due to <a href="http://www.iconarchive.com/show/patisserie-icons-by-cedarseed/Flan-icon.html" rel="nofollow">CedarSeed</a></em></p>
<p dir="auto"><strong>Contributors</strong></p>
<a href="https://github.com/jlblancoc/nanoflann/graphs/contributors">
  <img src="https://camo.githubusercontent.com/25aa6b57fb6873bcdd80a0fdf427396089f04d212b4a78f2c1467f7709501654/68747470733a2f2f636f6e747269622e726f636b732f696d6167653f7265706f3d6a6c626c616e636f632f6e616e6f666c616e6e" data-canonical-src="https://contrib.rocks/image?repo=jlblancoc/nanoflann" style="max-width: 100%;">
</a>
</article></div>