<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Bazel rules for python_pytest</h1><a id="user-content-bazel-rules-for-python_pytest" class="anchor" aria-label="Permalink: Bazel rules for python_pytest" href="#bazel-rules-for-python_pytest"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel rules to run your Python unit tests with <a href="https://docs.pytest.org/en/6.2.x/index.html" rel="nofollow">pytest</a>.</p>
<p dir="auto"><code>pytest</code> support in <a href="https://github.com/bazelbuild/rules_python">rules_python</a> is not provided out of the box,
see <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="505523902" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_python/issues/240" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_python/issues/240/hovercard" href="https://github.com/bazel-contrib/rules_python/issues/240">bazel-contrib/rules_python#240</a> and <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="866081262" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_python/issues/464" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_python/pull/464/hovercard" href="https://github.com/bazel-contrib/rules_python/pull/464">bazel-contrib/rules_python#464</a>.
Progress on the feature request seems to have stagnated so I've gone ahead and put at least something in
the public domain until <code>rules_python</code> offers it.</p>
<p dir="auto">Features:</p>
<ul dir="auto">
<li>Run unit tests with <code>pytest</code></li>
<li>Supports test filtering with Bazel's <code>--test_filter=</code> option</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">From the release you wish to use:
<a href="https://github.com/caseyduquettesc/rules_python_pytest/releases">https://github.com/caseyduquettesc/rules_python_pytest/releases</a>
copy the WORKSPACE snippet into your <code>WORKSPACE</code> file or the <code>bazel_dep</code> if you use bzlmod.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_python_pytest//python_pytest:defs.bzl&quot;, &quot;py_pytest_test&quot;)

py_pytest_test(
    name = &quot;test_w_pytest&quot;,
    size = &quot;small&quot;,
    srcs = [&quot;test.py&quot;],
    deps = [
      # TODO Add this for the user
      requirement(&quot;pytest&quot;),
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_python_pytest//python_pytest:defs.bzl"</span>, <span class="pl-s">"py_pytest_test"</span>)

<span class="pl-en">py_pytest_test</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"test_w_pytest"</span>,
    <span class="pl-s1">size</span> <span class="pl-c1">=</span> <span class="pl-s">"small"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"test.py"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
      <span class="pl-c"># TODO Add this for the user</span>
      <span class="pl-en">requirement</span>(<span class="pl-s">"pytest"</span>),
    ],
)</pre></div>
<p dir="auto">To use <a href="https://bazel.build/reference/test-encyclopedia#test-sharding" rel="nofollow">test sharding</a>, also add <code>requirement("pytest-shard")</code>
to <code>deps</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Disclaimer</h2><a id="user-content-disclaimer" class="anchor" aria-label="Permalink: Disclaimer" href="#disclaimer"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">I rely on this myself and will accept issue reports and contributions, however this only has a simple smoke test and isn't
documented terribly well. I will maintain this, however the expectation is that this will eventually be rolled into
<code>rules_python</code> and at that point these rules will be deprecated.</p>
</article></div>